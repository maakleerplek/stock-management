import{r as u,ab as a,j as e,ao as f,an as k,aq as T,bX as h,az as B,ak as d,bc as C,S as F,aj as D,N as O,a7 as w,d as L}from"./index-DjOBj_Ai.js";import{d as Q,b as M,R as g}from"./PluginUIFeature-DWPwHUQS.js";import{c as y,ag as E,f as V,h as j,ah as P,g as U}from"./Filter-CpWhllKn.js";import{P as b}from"./index-_kfXKtfq.js";import{l as q}from"./ColumnRenderers-BCeqgJNS.js";import{y as N,M as G,L as W,t as z,ap as R,q as X,ar as $,aq as K}from"./ThemeContext-BjJu0IKI.js";function ne({create:t,modalId:i}){const[n,r]=u.useState(null),[l,o]=u.useState(""),s=M({modalId:i,onGenerate:m=>{o(_=>_||m)}}),c=B();return u.useMemo(()=>{const m={reference:{},part:{disabled:!t,filters:{assembly:!0,virtual:!1,active:c.isSet("BUILDORDER_REQUIRE_ACTIVE_PART")?!0:void 0,locked:c.isSet("BUILDORDER_REQUIRE_LOCKED_PART")?!0:void 0},onValueChange(_,p){p&&r(p.default_location||p.category_default_location),s.update({part:_})}},title:{},quantity:{},project_code:{icon:e.jsx(K,{})},priority:{},parent:{icon:e.jsx($,{}),filters:{part_detail:!0}},sales_order:{icon:e.jsx(X,{})},batch:{placeholder:s.result,placeholderAutofill:!0,value:l,onValueChange:_=>o(_)},start_date:{icon:e.jsx(R,{})},target_date:{icon:e.jsx(R,{})},take_from:{},destination:{filters:{structural:!1},value:n},link:{icon:e.jsx(z,{})},issued_by:{icon:e.jsx(W,{}),filters:{is_active:!0}},responsible:{icon:e.jsx(G,{}),filters:{is_active:!0}},external:{}};return c.isSet("PROJECT_CODES_ENABLED",!0)||delete m.project_code,c.isSet("BUILDORDER_EXTERNAL_BUILDS",!0)||delete m.external,m},[t,n,l,s.result,c])}function se({build:t,modalId:i}){const n=u.useMemo(()=>t.part_detail?.trackable??!1,[t.part_detail]),[r,l]=u.useState(null);u.useEffect(()=>{l(t.location||t.part_detail?.default_location||null)},[t.location,t.part_detail]);const[o,s]=u.useState(0);u.useEffect(()=>{const _=t.quantity??0,p=t.completed??0;s(Math.max(0,_-p))},[t]);const c=Q({modalId:i,initialQuery:{part:t.part||t.part_detail?.pk}}),m=M({modalId:i,initialQuery:{part:t.part||t.part_detail?.pk,quantity:t.quantity}});return u.useMemo(()=>({quantity:{value:o,onValueChange:_=>{s(_)}},serial_numbers:{hidden:!n,placeholder:c.result&&`${c.result}+`,placeholderAutofill:!0},batch_code:{placeholder:m.result,placeholderAutofill:!0},location:{value:r,onValueChange:_=>{l(_)}},auto_allocate:{hidden:!n}}),[o,m.result,c.result,n])}function S({props:t,record:i}){const n=u.useMemo(()=>i.serial?`# ${i.serial}`:`${a._({id:"VbWX2u"})}: ${i.quantity}`,[i]),r=u.useMemo(()=>i.serial?"1":e.jsx(j,{fieldName:"quantity",fieldDefinition:{field_type:"number",required:!0,value:t.item.quantity,onValueChange:l=>{t.changeFn(t.idx,"quantity",l)}},error:t.rowErrors?.quantity?.message}),[t,i]);return e.jsx(e.Fragment,{children:e.jsxs(d.Tr,{children:[e.jsx(d.Td,{children:e.jsx(q,{part:i.part_detail})}),e.jsx(d.Td,{children:n}),e.jsx(d.Td,{children:e.jsx(P,{props:t,errorKey:"output",children:r})}),e.jsx(d.Td,{children:i.batch}),e.jsxs(d.Td,{children:[e.jsx(U,{status:i.status,type:C.stockitem})," "]}),e.jsx(d.Td,{style:{width:"1%",whiteSpace:"nowrap"},children:e.jsx(g,{onClick:()=>t.removeFn(t.idx)})})]})})}function re({build:t,outputs:i,onFormSuccess:n}){const[r,l]=u.useState(null);u.useEffect(()=>{r||l(t.destination||t.part_detail?.default_location||null)},[r,t.destination,t.part_detail]);const o=u.useMemo(()=>({outputs:{field_type:"table",value:i.map(s=>({output:s.pk,quantity:s.quantity})),modelRenderer:s=>{const c=i.find(m=>m.pk==s.item.output);return e.jsx(S,{props:s,record:c},c.pk)},headers:[{title:a._({id:"vgP+9p"})},{title:a._({id:"gILim+"})},{title:a._({id:"h9GdVS"}),style:{width:"200px"}},{title:a._({id:"rsx3xA"})},{title:a._({id:"uAQUqI"})},{title:"",style:{width:"50px"}}]},status_custom_key:{},location:{filters:{structural:!1},value:r,onValueChange:s=>{l(s)}},notes:{},accept_incomplete_allocation:{}}),[r,i]);return y({url:k(f.build_output_complete,t.pk),method:"POST",title:a._({id:"0iR9fu"}),fields:o,onFormSuccess:n,successMessage:a._({id:"N3avUJ"}),size:"80%"})}function ue({build:t,outputs:i,onFormSuccess:n}){const[r,l]=u.useState(null);u.useEffect(()=>{r||l(t.destination||t.part_detail?.default_location||null)},[r,t.destination,t.part_detail]);const o=u.useMemo(()=>({outputs:{field_type:"table",value:i.map(s=>({output:s.pk,quantity:s.quantity})),modelRenderer:s=>{const c=i.find(m=>m.pk==s.item.output);return e.jsx(S,{props:s,record:c},c.pk)},headers:[{title:a._({id:"vgP+9p"})},{title:a._({id:"gILim+"})},{title:a._({id:"1th0FY"}),style:{width:"200px"}},{title:a._({id:"rsx3xA"})},{title:a._({id:"uAQUqI"})},{title:"",style:{width:"50px"}}]},location:{value:r,onValueChange:s=>{l(s)}},notes:{},discard_allocations:{}}),[r,i]);return y({url:k(f.build_output_scrap,t.pk),method:"POST",title:a._({id:"69qbY/"}),preFormContent:e.jsx(T,{title:a._({id:"69qbY/"}),color:"yellow",children:e.jsxs(h,{children:[e.jsx(h.Item,{children:a._({id:"zHVfrv"})}),e.jsx(h.Item,{children:a._({id:"SUX6xX"})})]})}),fields:o,onFormSuccess:n,successMessage:a._({id:"C+tSd4"}),size:"80%"})}function oe({build:t,outputs:i,onFormSuccess:n}){const r=u.useMemo(()=>({outputs:{field_type:"table",value:i.map(l=>({output:l.pk})),modelRenderer:l=>{const o=i.find(s=>s.pk==l.item.output);return e.jsx(S,{props:l,record:o},o.pk)},headers:[{title:a._({id:"vgP+9p"})},{title:a._({id:"igx8Og"})},{title:a._({id:"rsx3xA"})},{title:a._({id:"uAQUqI"})},{title:"",style:{width:"50px"}}]}}),[i]);return y({url:k(f.build_output_delete,t.pk),method:"POST",title:a._({id:"xS5DxW"}),preFormContent:e.jsx(T,{title:a._({id:"xS5DxW"}),color:"yellow",children:e.jsxs(h,{children:[e.jsx(h.Item,{children:a._({id:"yFxIv1"})}),e.jsx(h.Item,{children:a._({id:"SSAZQG"})})]})}),fields:r,onFormSuccess:n,successMessage:a._({id:"cdFWk4"}),size:"80%"})}function H({props:t,output:i,record:n,sourceLocation:r}){const l=u.useMemo(()=>({field_type:"related field",api_url:k(f.stock_item_list),model:C.stockitem,autoFill:!!i?.serial,autoFillFilters:{serial:i?.serial},filters:{available:!0,part_detail:!0,location_detail:!0,bom_item:n.bom_item,location:r,cascade:r?!0:void 0},value:t.item.stock_item,name:"stock_item",onValueChange:(s,c)=>{if(t.changeFn(t.idx,"stock_item",s),c){const m=c.quantity-c.allocated;m<t.item.quantity&&t.changeFn(t.idx,"quantity",Math.min(t.item.quantity,m))}}}),[n,t]),o=u.useMemo(()=>({field_type:"number",name:"quantity",required:!0,value:t.item.quantity,onValueChange:s=>{t.changeFn(t.idx,"quantity",s)}}),[t]);return e.jsxs(d.Tr,{children:[e.jsx(d.Td,{children:e.jsx(q,{part:n.part_detail})}),e.jsx(d.Td,{children:e.jsx(L,{size:"sm",children:n.part_detail?.IPN})}),e.jsx(d.Td,{children:e.jsx(b,{value:n.allocatedQuantity,maximum:n.requiredQuantity-n.consumed,progressLabel:!0,units:n.part_detail?.units})}),e.jsx(d.Td,{children:e.jsx(j,{fieldName:"stock_item",fieldDefinition:l,error:t.rowErrors?.stock_item?.message})}),e.jsx(d.Td,{children:e.jsx(j,{fieldName:"quantity",fieldDefinition:o,error:t.rowErrors?.quantity?.message})}),e.jsx(d.Td,{children:e.jsx(g,{onClick:()=>t.removeFn(t.idx)})})]},`table-row-${n.pk}`)}function de({buildId:t,output:i,outputId:n,build:r,lineItems:l,onFormSuccess:o}){const[s,c]=u.useState(void 0),m=u.useMemo(()=>({items:{field_type:"table",value:[],headers:[{title:a._({id:"vgP+9p"}),style:{minWidth:"175px"}},{title:a._({id:"3wXEsN"}),style:{minWidth:"50px"}},{title:a._({id:"A/ybx7"}),style:{minWidth:"175px"}},{title:a._({id:"igx8Og"}),style:{width:"100%"}},{title:a._({id:"VbWX2u"}),style:{minWidth:"175px"}},{title:"",style:{width:"50px"}}],modelRenderer:v=>{const I=l.find(A=>A.pk==v.item.build_line)??{};return e.jsx(H,{output:i,props:v,record:I,sourceLocation:s},v.idx)}}}),[i,l,s]);u.useEffect(()=>{c(r?.take_from)},[r?.take_from]);const _=u.useMemo(()=>({field_type:"related field",api_url:k(f.stock_location_list),model:C.stocklocation,required:!1,label:a._({id:"/00Ond"}),description:a._({id:"IArqwk"}),name:"source_location",value:r?.take_from,onValueChange:x=>{c(x)}}),[r?.take_from]),p=u.useMemo(()=>e.jsxs(F,{gap:"xs",children:[i?.pk&&e.jsxs(F,{gap:"xs",children:[e.jsx(T,{color:"blue",icon:e.jsx(N,{}),title:a._({id:"gILim+"}),children:e.jsx(E,{instance:i})}),e.jsx(D,{})]}),e.jsx(j,{fieldDefinition:_})]}),[i,_]);return y({url:f.build_order_allocate,pk:t,title:a._({id:"L1LMmH"}),fields:m,preFormContent:p,successMessage:a._({id:"23SrHL"}),onFormSuccess:o,initialData:{items:l.filter(x=>n?!0:x.requiredQuantity>x.allocatedQuantity+x.consumed).map(x=>({build_line:x.pk,stock_item:void 0,quantity:Math.max(0,x.requiredQuantity-x.allocatedQuantity-x.consumed),output:n}))},size:"80%"})}function J({props:t,record:i}){return e.jsxs(d.Tr,{children:[e.jsx(d.Td,{children:e.jsx(q,{part:i.part_detail})}),e.jsx(d.Td,{children:e.jsx(E,{instance:i.stock_item_detail})}),e.jsx(d.Td,{children:i.location_detail&&e.jsx(V,{instance:i.location_detail})}),e.jsx(d.Td,{children:i.quantity}),e.jsx(d.Td,{children:e.jsx(j,{fieldName:"quantity",fieldDefinition:{field_type:"number",required:!0,value:t.item.quantity,onValueChange:n=>{t.changeFn(t.idx,"quantity",n)}},error:t.rowErrors?.quantity?.message})}),e.jsx(d.Td,{children:e.jsx(g,{onClick:()=>t.removeFn(t.idx)})})]},`table-row-${i.pk}`)}function ce({buildId:t,allocatedItems:i,onFormSuccess:n}){const r=u.useMemo(()=>({items:{field_type:"table",value:[],headers:[{title:a._({id:"vgP+9p"})},{title:a._({id:"igx8Og"})},{title:a._({id:"wJijgU"})},{title:a._({id:"A/ybx7"})},{title:a._({id:"VbWX2u"})}],modelRenderer:l=>{const o=i.find(s=>s.pk==l.item.build_item);return e.jsx(J,{props:l,record:o},l.idx)}},notes:{}}),[i]);return y({url:f.build_order_consume,pk:t,title:a._({id:"8nBqTf"}),successMessage:a._({id:"lxxoKL"}),onFormSuccess:n,size:"80%",fields:r,initialData:{items:i.map(l=>({build_item:l.pk,quantity:l.quantity}))}})}function Y({props:t,record:i}){const n=i.allocatedQuantity??i.allocated,r=i.requiredQuantity??i.required,l=Math.max(0,r-i.consumed);return e.jsxs(d.Tr,{children:[e.jsx(d.Td,{children:e.jsx(q,{part:i.part_detail})}),e.jsx(d.Td,{children:l<=0?e.jsxs(O,{gap:"xs",children:[e.jsx(w,{size:16,color:"green"}),e.jsx(L,{size:"sm",style:{fontStyle:"italic"},children:a._({id:"e02p4q"})})]}):e.jsx(b,{value:n,maximum:l,progressLabel:!0})}),e.jsx(d.Td,{children:e.jsx(b,{value:i.consumed,maximum:i.quantity,progressLabel:!0})}),e.jsx(d.Td,{children:e.jsx(g,{onClick:()=>t.removeFn(t.idx)})})]},`table-row-${i.pk}`)}function me({buildId:t,buildLines:i,onFormSuccess:n}){const r=u.useMemo(()=>i.filter(o=>!o.part_detail?.trackable),[i]),l=u.useMemo(()=>({lines:{field_type:"table",value:[],headers:[{title:a._({id:"vgP+9p"})},{title:a._({id:"A/ybx7"})},{title:a._({id:"XNITBt"})}],modelRenderer:o=>{const s=r.find(c=>c.pk==o.item.build_line);return e.jsx(Y,{props:o,record:s},o.idx)}},notes:{}}),[r]);return y({url:f.build_order_consume,pk:t,title:a._({id:"8nBqTf"}),successMessage:a._({id:"lxxoKL"}),onFormSuccess:n,fields:l,initialData:{lines:r.map(o=>({build_line:o.pk}))}})}export{de as a,me as b,ce as c,se as d,re as e,ue as f,oe as g,ne as u};
//# sourceMappingURL=BuildForms-BNnXhzVm.js.map
