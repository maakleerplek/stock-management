import{r as a,ab as o,az as v,j as r,bc as q,an as S,ao as h,ak as f}from"./index-DjOBj_Ai.js";import{R as F}from"./PluginUIFeature-DWPwHUQS.js";import{c as C,h as b}from"./Filter-CpWhllKn.js";import{P as M}from"./index-_kfXKtfq.js";import{l as E}from"./ColumnRenderers-BCeqgJNS.js";import{I as A}from"./IconUsers-DgSduCbv.js";import{I as P}from"./IconAddressBook-0_3zwfXJ.js";import{L as T,ap as k}from"./ThemeContext-BjJu0IKI.js";function W({duplicateOrderId:e}){const t=v();return a.useMemo(()=>{const i={reference:{},description:{},customer:{disabled:e!=null,filters:{is_customer:!0,active:!0}},customer_reference:{},project_code:{},order_currency:{},start_date:{icon:r.jsx(k,{})},target_date:{icon:r.jsx(k,{})},link:{},contact:{icon:r.jsx(T,{}),adjustFilters:s=>({...s.filters,company:s.data.customer})},address:{icon:r.jsx(P,{}),adjustFilters:s=>({...s.filters,company:s.data.customer})},responsible:{icon:r.jsx(A,{})}};return e&&(i.duplicate={children:{order_id:{hidden:!0,value:e},copy_lines:{},copy_extra_lines:{}}}),t.isSet("PROJECT_CODES_ENABLED",!0)||delete i.project_code,i},[e,t])}function $({customerId:e,orderId:t,create:i,currency:s}){const[m,c]=a.useState("0"),[l,n]=a.useState(s??""),[d,u]=a.useState({}),[p,g]=a.useState("");return a.useEffect(()=>{if(!i||!d||!d.price_breaks)return;const x=p?Number.parseInt(p,10):0,y=d.price_breaks.filter(_=>_.price_currency==l&&x<=_.quantity).sort((_,j)=>_.quantity-j.quantity);y.length&&c(y[0].price)},[d,p,l,i]),a.useMemo(()=>({order:{filters:{customer_detail:!0},disabled:!0,value:i?t:void 0},part:{filters:{active:!0,salable:!0,price_breaks:!0},onValueChange:(y,_)=>u(_)},reference:{},quantity:{onValueChange:g},sale_price:{value:m},sale_price_currency:{value:l,onValueChange:n},project_code:{description:o._({id:"XruckR"})},target_date:{},notes:{},link:{}}),[m,l,t,i])}function L({props:e,record:t,sourceLocation:i}){const s=a.useMemo(()=>({field_type:"related field",api_url:S(h.stock_item_list),model:q.stockitem,filters:{available:!0,part_detail:!0,location_detail:!0,location:i,cascade:i?!0:void 0,part:t.part},value:e.item.stock_item,name:"stock_item",onValueChange:(c,l)=>{if(e.changeFn(e.idx,"stock_item",c),l){const n=l.quantity-l.allocated,d=t.quantity-t.allocated;let u=e.item?.quantity??0;u=Math.max(u,d),u=Math.min(u,n),u!=e.item.quantity&&e.changeFn(e.idx,"quantity",u)}}}),[i,t,e]),m=a.useMemo(()=>({field_type:"number",name:"quantity",required:!0,value:e.item.quantity,onValueChange:c=>{e.changeFn(e.idx,"quantity",c)}}),[e]);return r.jsxs(f.Tr,{children:[r.jsx(f.Td,{children:r.jsx(E,{part:t.part_detail})}),r.jsx(f.Td,{children:r.jsx(M,{value:t.allocated,maximum:t.quantity,progressLabel:!0})}),r.jsx(f.Td,{children:r.jsx(b,{fieldName:"stock_item",fieldDefinition:s,error:e.rowErrors?.stock_item?.message})}),r.jsx(f.Td,{children:r.jsx(b,{fieldName:"quantity",fieldDefinition:m,error:e.rowErrors?.quantity?.message})}),r.jsx(f.Td,{children:r.jsx(F,{onClick:()=>e.removeFn(e.idx)})})]},`table-row-${e.idx}-${t.pk}`)}function U({orderId:e,shipmentId:t,lineItems:i,onFormSuccess:s}){const[m,c]=a.useState(null);a.useEffect(()=>{c(null)},[e,t,i]);const l=a.useMemo(()=>({source_location:{exclude:!0,required:!1,field_type:"related field",api_url:S(h.stock_location_list),model:q.stocklocation,label:o._({id:"/00Ond"}),description:o._({id:"IArqwk"}),onValueChange:n=>{c(n)}},items:{field_type:"table",value:[],headers:[{title:o._({id:"vgP+9p"}),style:{minWidth:"200px"}},{title:o._({id:"A/ybx7"}),style:{minWidth:"200px"}},{title:o._({id:"igx8Og"}),style:{width:"100%"}},{title:o._({id:"VbWX2u"}),style:{minWidth:"200px"}},{title:"",style:{width:"50px"}}],modelRenderer:n=>{const d=i.find(u=>u.pk==n.item.line_item)??{};return r.jsx(L,{props:n,record:d,sourceLocation:m},`table-row-${n.idx}-${d.pk}`)}},shipment:{filters:{shipped:!1,order_detail:!0,order:e}}}),[e,t,i,m]);return C({title:o._({id:"L1LMmH"}),url:h.sales_order_allocate,pk:e,fields:l,onFormSuccess:s,successMessage:o._({id:"23SrHL"}),size:"80%",initialData:{items:i.map(n=>({line_item:n.pk,quantity:0,stock_item:null}))}})}function H({itemId:e,orderId:t}){return a.useMemo(()=>({line_item:{value:e,hidden:!0},quantity:{},serial_numbers:{},shipment:{filters:{order_detail:!0,order:t,shipped:!1}}}),[e,t])}function X({customerId:e,pending:t}){return a.useMemo(()=>({order:{disabled:!0},reference:{},shipment_date:{hidden:t??!0},delivery_date:{hidden:t??!0},shipment_address:{placeholder:o._({id:"nzzuLr"}),filters:{company:e,ordering:"-primary"}},tracking_number:{},invoice_number:{},link:{}}),[e,t])}function G({shipmentId:e}){return a.useMemo(()=>({shipment_date:{},tracking_number:{},invoice_number:{},link:{}}),[e])}function J({orderId:e,shipment:t}){return a.useMemo(()=>({item:{disabled:!0},quantity:{},shipment:{disabled:!!t?.shipment_date,hidden:!e,filters:{order:e,shipped:!1}}}),[e,t])}export{J as a,X as b,G as c,$ as d,H as e,U as f,W as u};
//# sourceMappingURL=SalesOrderForms-EpMC8M0_.js.map
