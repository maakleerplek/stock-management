import{az as se,ag as re,r as a,bc as i,ab as e,ao as d,j as s,d as H,aO as _,an as R,b5 as de,c8 as Q,as as f,S as ue}from"./index-DjOBj_Ai.js";import{A as pe}from"./AdminButton-B8c0S9L9.js";import{P as X}from"./PrimaryActionButton-BAA_Awc0.js";import{u as me,d as _e,R as he,c as be,a as ye,I as fe,B as xe,P as ke,O as ge,E as Ce,b as je,H as Pe,C as Se}from"./InvenTreeTable-C-s5lvnS.js";import{I as Ae,D as w,a as De}from"./InstanceDetail-DPGTPy9_.js";import{D as Ie,A as Re,N as ve}from"./NotesPanel-Gq5AAnCV.js";import{a as Fe,ax as Ee,a1 as Le,y as Te,S as Y,aq as Me,k as Oe}from"./ThemeContext-BjJu0IKI.js";import{P as qe}from"./PageDetail-1HLwiKVO.js";import{P as Ne}from"./PanelGroup-_Eigw1UV.js";import{c as x,R as we,q as Z,Q as We,j as ae,e as Ke,m as Ue,g as Ve}from"./Filter-CpWhllKn.js";import{a as ie}from"./formatters-Dkpc25sQ.js";import{b as Be,c as J,u as z}from"./OrderPartsWizard-CtcPC0ec.js";import{u as Ge}from"./UseInstance-BYH4ds5B.js";import{u as oe}from"./UseStatusCodes-BH1R2YPA.js";import{I as $,E as He}from"./ExtraLineItemTable-Cr0OVPmZ.js";import{A as ee}from"./ActionButton-D4nRdKaB.js";import{P as Qe}from"./index-_kfXKtfq.js";import{d as Xe,I as Ye}from"./ImporterForms-bhuZRzA9.js";import{P as Ze,D as Je,R as ze,b as $e,L as te,o as et,T as tt,j as st,N as rt}from"./ColumnRenderers-BCeqgJNS.js";import{S as at}from"./StockItemTable-D_Czm6nE.js";import"./DesktopAppView-D6tHFi_e.js";import"./IconChevronDown-I6OOyduR.js";import"./QRCode-BL-P7mX-.js";import"./browser-JUP5PmmS.js";import"./IconDotsVertical-CGvw5eIR.js";import"./IconTags-Bukq1non.js";import"./YesNoButton-CYsvXLSb.js";import"./ModelType-BxY4rynO.js";import"./GenericErrorPage-BWQWzpn2.js";import"./NotFound-BksZ8Fp_.js";import"./PermissionDenied-CPiNkqvu.js";import"./use-hover-CbuFBCOT.js";import"./index-Chjiymov.js";import"./AttachmentLink-EwW6behJ.js";import"./PageTitle-CaObz4lR.js";import"./PluginUIFeature-DWPwHUQS.js";import"./RemoteComponent-CrOPmrx3.js";import"./CompanyForms-BrBn0vUb.js";import"./IconAt-B6wo_srX.js";import"./IconUsers-DgSduCbv.js";import"./IconAddressBook-0_3zwfXJ.js";import"./CommonForms-B8LSJp62.js";import"./IconCircleDashedCheck-FiF_1OHY.js";import"./UseStockAdjustActions-B7uQUwuU.js";function it({order:u,orderDetailRefresh:b,orderId:n,currency:t,supplierId:h,editable:l,params:k}){const m=me("purchase-order-line-item");se();const W=Fe(),p=re(),[c,P]=a.useState(!1),[S,v]=a.useState(void 0),F=a.useMemo(()=>{const r=Xe({modelType:i.purchaseorderlineitem});return r.field_overrides.value={order:n},r.field_defaults.value={purchase_price_currency:u?.order_currency||u?.supplier_detail?.currency||void 0},r.field_filters.value={part:{supplier:h,active:!0}},r},[u,n,h]),E=x({url:d.import_session_list,title:e._({id:"yWWRAr"}),fields:F,onFormSuccess:r=>{v(r.pk),P(!0)}}),[L,A]=a.useState(null),g=Be({items:L?[L]:m.selectedRecords,orderPk:n,destinationPk:u.destination,formProps:{onClose:()=>{m.clearSelectedRecords(),m.refreshTable(),setTimeout(()=>A(null),500)}}}),T=a.useMemo(()=>[Ze({part:"part_detail",ordering:"part_name"}),{accessor:"part_detail.IPN",sortable:!0,ordering:"IPN"},Je({accessor:"part_detail.description"}),ze({}),$e({}),{accessor:"build_order",title:e._({id:"YxwWvi"}),sortable:!0,defaultVisible:!1,render:r=>r.build_order_detail?s.jsx(we,{instance:r.build_order_detail,model:i.build}):"-"},{accessor:"quantity",title:e._({id:"VbWX2u"}),sortable:!0,switchable:!1,render:r=>{const y=r?.supplier_part_detail??{},I=r?.part_detail??y?.part_detail??{},V=[];if(y?.pack_quantity_native!=null&&y.pack_quantity_native!=1){const ce=r.quantity*y.pack_quantity_native;V.push(s.jsxs(H,{children:[e._({id:"J9LTXQ"}),": ",y.pack_quantity]},"pack-quantity")),V.push(s.jsxs(H,{children:[e._({id:"GbI1d2"}),": ",Z(ce)," ",I?.units]},"total-quantity"))}return s.jsx(We,{value:Z(r.quantity),extra:V,title:e._({id:"VbWX2u"})})}},{accessor:"received",title:e._({id:"fZ5Vnu"}),sortable:!1,render:r=>s.jsx(Qe,{progressLabel:!0,value:r.received,maximum:r.quantity})},{accessor:"supplier_part_detail.packaging",sortable:!1,title:e._({id:"pD/Ew0"}),defaultVisible:!1},{accessor:"supplier_part_detail.pack_quantity",sortable:!1,title:e._({id:"J9LTXQ"})},{accessor:"sku",title:e._({id:"PeuqsI"}),switchable:!1,sortable:!0,ordering:"SKU"},te({accessor:"supplier_part_detail.link",title:e._({id:"h3/Rpt"}),sortable:!1,defaultVisible:!1}),{accessor:"mpn",ordering:"MPN",title:e._({id:"u7qly3"}),sortable:!0,defaultVisible:!1},et({accessor:"purchase_price",title:e._({id:"vWelsN"})}),{accessor:"total_price",title:e._({id:"KyZVKD"}),render:r=>ie(r.purchase_price,{currency:r.purchase_price_currency,multiplier:r.quantity})},tt({}),st({accessor:"destination_detail",sortable:!1,title:e._({id:"Enslfm"})}),rt({}),te({})],[n,p]),M=a.useMemo(()=>[{name:"received",label:e._({id:"fZ5Vnu"}),description:e._({id:"8Dmqxr"})}],[]),K=J({create:!0,orderId:n,supplierId:h}),[U,O]=a.useState({}),o=x({url:d.purchase_order_line_list,title:e._({id:"pwb7Yo"}),fields:K,initialData:{...U,purchase_price_currency:t},onFormSuccess:b,table:m}),[C,j]=a.useState(0),D=J({create:!1,orderId:n,supplierId:h}),q=ae({url:d.purchase_order_line_list,pk:C,title:e._({id:"vgosWS"}),fields:D,onFormSuccess:b,table:m}),B=Ke({url:d.purchase_order_line_list,pk:C,title:e._({id:"tpKh8C"}),onFormSuccess:b,table:m}),G=oe({modelType:i.purchaseorder}),N=a.useMemo(()=>u.status==G.PLACED,[u,G]),ne=a.useCallback(r=>{const y=(r?.received??0)>=(r?.quantity??0),I=l&&p.hasChangeRole(_.purchase_order);return[{hidden:y||!N,title:e._({id:"ul9IpB"}),icon:s.jsx($,{}),color:"green",onClick:()=>{A(r),g.open()}},_e({hidden:!r.build_order,title:e._({id:"bjYQWK"}),modelType:i.build,modelId:r.build_order,navigate:W}),he({hidden:!I,onClick:()=>{j(r.pk),q.open()}}),be({hidden:!I||!p.hasAddRole(_.purchase_order),onClick:()=>{O({...r}),o.open()}}),ye({hidden:!I||!p.hasDeleteRole(_.purchase_order),onClick:()=>{j(r.pk),B.open()}})]},[n,p,l,N]),le=a.useMemo(()=>[s.jsx(ee,{hidden:!l||!p.hasAddRole(_.purchase_order),tooltip:e._({id:"yWWRAr"}),icon:s.jsx(Ee,{}),onClick:()=>E.open()},"import-line-items"),s.jsx(Ue,{tooltip:e._({id:"pwb7Yo"}),onClick:()=>{O({order:n}),o.open()},hidden:!l||!p?.hasAddRole(_.purchase_order)},"add-line-item"),s.jsx(ee,{text:e._({id:"gyK1dv"}),icon:s.jsx($,{}),onClick:()=>g.open(),disabled:m.selectedRecords.length===0,hidden:!N||!p.hasChangeRole(_.purchase_order)},"receive-items")],[n,p,m,l,N]);return s.jsxs(s.Fragment,{children:[E.modal,g.modal,o.modal,q.modal,B.modal,s.jsx(fe,{url:R(d.purchase_order_line_list),tableState:m,columns:T,props:{enableSelection:!0,enableDownload:!0,params:{...k,order:n,part_detail:!0},rowActions:ne,tableActions:le,tableFilters:M,modelType:i.supplierpart,modelField:"part"}}),s.jsx(Ye,{sessionId:S??-1,opened:S!=null&&c,onClose:()=>{v(void 0),P(!1),m.refreshTable()}})]})}function Zt(){const{id:u}=Le(),b=re(),n=se(),{instance:t,instanceQuery:h,refreshInstance:l}=Ge({endpoint:d.purchase_order_list,pk:u,params:{supplier_detail:!0},refetchOnMount:!0}),k=a.useMemo(()=>t.order_currency||t.supplier_detail?.currency||n.getSetting("INVENTREE_DEFAULT_CURRENCY"),[t,n]),m=z({}),W=z({duplicateOrderId:t.pk}),p=ae({url:d.purchase_order_list,pk:u,title:e._({id:"lAF9Uk"}),fields:m,onFormSuccess:()=>{l()}}),c=oe({modelType:i.purchaseorder}),P=a.useMemo(()=>t.status==c.PENDING||t.status==c.PLACED||t.status==c.ON_HOLD,[t,c]),S=a.useMemo(()=>P?!0:n.isSet("PURCHASEORDER_EDIT_COMPLETED_ORDERS"),[P,n]),v=a.useMemo(()=>{const o={...t};return delete o.reference,o},[t]),F=x({url:d.purchase_order_list,title:e._({id:"XRoR1U"}),fields:W,initialData:v,follow:!0,modelType:i.purchaseorder}),E=a.useMemo(()=>{if(h.isFetching)return s.jsx(de,{});const o=[{type:"text",name:"reference",label:e._({id:"N2C89m"}),copy:!0},{type:"text",name:"supplier_reference",label:e._({id:"K7PVg3"}),icon:"reference",hidden:!t.supplier_reference,copy:!0},{type:"link",name:"supplier",icon:"suppliers",label:e._({id:"PYTEl0"}),model:i.company},{type:"text",name:"description",label:e._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:e._({id:"uAQUqI"}),model:i.purchaseorder},{type:"status",name:"status_custom_key",label:e._({id:"4DvUAJ"}),model:i.purchaseorder,icon:"status",hidden:!t.status_custom_key||t.status_custom_key==t.status}],C=[{type:"progressbar",name:"completed",icon:"progress",label:e._({id:"qgs95u"}),total:t.line_items,progress:t.completed_lines},{type:"link",model:i.stocklocation,link:!0,name:"destination",label:e._({id:"Enslfm"}),hidden:!t.destination},{type:"text",name:"currency",label:e._({id:"0UZTSq"}),value_formatter:()=>k},{type:"text",name:"total_price",label:e._({id:"A6C0pv"}),value_formatter:()=>ie(t?.total_price,{currency:t?.order_currency||t?.supplier_detail?.currency})}],j=[{type:"link",external:!0,name:"link",label:e._({id:"yzF66j"}),copy:!0,hidden:!t.link},{type:"text",name:"contact_detail.name",label:e._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!t.contact},{type:"text",name:"contact_detail.email",label:e._({id:"41BQ3k"}),icon:"email",copy:!0,hidden:!t.contact_detail?.email},{type:"text",name:"contact_detail.phone",label:e._({id:"P1x5uo"}),icon:"phone",copy:!0,hidden:!t.contact_detail?.phone},{type:"text",name:"project_code_label",label:e._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!t.project_code},{type:"text",name:"responsible",label:e._({id:"XQACoK"}),badge:"owner",hidden:!t.responsible}],D=[{type:"date",name:"creation_date",label:e._({id:"FNcMGM"}),copy:!0,icon:"calendar"},{type:"date",name:"issue_date",label:e._({id:"M1cChr"}),icon:"calendar",copy:!0,hidden:!t.issue_date},{type:"date",name:"start_date",label:e._({id:"D3iCkb"}),icon:"calendar",copy:!0,hidden:!t.start_date},{type:"date",name:"target_date",label:e._({id:"ZmykKo"}),icon:"calendar",copy:!0,hidden:!t.target_date},{type:"date",name:"complete_date",icon:"calendar_check",label:e._({id:"41ha49"}),copy:!0,hidden:!t.complete_date}];return s.jsxs(Ae,{children:[s.jsxs(Q,{grow:!0,children:[s.jsx(Ie,{appRole:_.purchase_order,apiPath:d.company_list,src:t.supplier_detail?.image,pk:t.supplier}),s.jsx(Q.Col,{span:{base:12,sm:8},children:s.jsx(w,{fields:o,item:t})})]}),s.jsx(w,{fields:C,item:t}),s.jsx(w,{fields:j,item:t}),s.jsx(w,{fields:D,item:t})]})},[t,k,h]),L=a.useMemo(()=>[{name:"detail",label:e._({id:"Tol4BF"}),icon:s.jsx(Te,{}),content:E},{name:"line-items",label:e._({id:"SgduFH"}),icon:s.jsx(Me,{}),content:s.jsxs(f,{multiple:!0,defaultValue:["line-items","extra-items"],children:[s.jsxs(f.Item,{value:"line-items",children:[s.jsx(f.Control,{children:s.jsx(Y,{size:"lg",children:e._({id:"SgduFH"})})}),s.jsx(f.Panel,{children:s.jsx(it,{order:t,orderDetailRefresh:l,currency:k,orderId:Number(u),editable:S,supplierId:Number(t.supplier)})})]},"lineitems"),s.jsxs(f.Item,{value:"extra-items",children:[s.jsx(f.Control,{children:s.jsx(Y,{size:"lg",children:e._({id:"l11DG/"})})}),s.jsx(f.Panel,{children:s.jsx(He,{endpoint:d.purchase_order_extra_line_list,orderId:t.pk,orderDetailRefresh:l,currency:k,editable:S,role:_.purchase_order})})]},"extraitems")]})},{name:"received-stock",label:e._({id:"b447qM"}),icon:s.jsx(Oe,{}),content:s.jsx(at,{tableName:"received-stock",params:{purchase_order:u}})},Re({model_type:i.purchaseorder,model_id:t.pk}),ve({model_type:i.purchaseorder,model_id:t.pk})],[t,u,b]),A=x({url:R(d.purchase_order_issue,t.pk),title:e._({id:"keApR9"}),onFormSuccess:l,preFormWarning:e._({id:"lLiNZC"}),successMessage:e._({id:"R/WvFK"})}),g=x({url:R(d.purchase_order_cancel,t.pk),title:e._({id:"98xQHK"}),onFormSuccess:l,preFormWarning:e._({id:"MPFqR0"}),successMessage:e._({id:"H5qWhm"})}),T=x({url:R(d.purchase_order_hold,t.pk),title:e._({id:"vJaCK0"}),onFormSuccess:l,preFormWarning:e._({id:"3Wfk51"}),successMessage:e._({id:"0NH/ob"})}),M=x({url:R(d.purchase_order_complete,t.pk),title:e._({id:"CWbcdO"}),successMessage:e._({id:"W7TghJ"}),timeout:1e4,fields:{accept_incomplete:{}},onFormSuccess:l,preFormWarning:e._({id:"DYITap"})}),K=a.useMemo(()=>{const o=b.hasChangeRole(_.purchase_order),C=o&&(t.status==c.PENDING||t.status==c.ON_HOLD),j=o&&(t.status==c.PENDING||t.status==c.PLACED),D=o&&t.status==c.PLACED,q=o&&t.status!=c.CANCELLED&&t.status!=c.COMPLETE;return[s.jsx(X,{title:e._({id:"WajCDs"}),icon:"issue",hidden:!C,color:"blue",onClick:A.open}),s.jsx(X,{title:e._({id:"NPZqBL"}),icon:"complete",hidden:!D,color:"green",onClick:M.open}),s.jsx(pe,{model:i.purchaseorder,id:t.pk}),s.jsx(xe,{model:i.purchaseorder,pk:t.pk,hash:t?.barcode_hash}),s.jsx(ke,{modelType:i.purchaseorder,items:[t.pk],enableLabels:!0,enableReports:!0}),s.jsx(ge,{tooltip:e._({id:"/IKytX"}),actions:[Ce({hidden:!o,tooltip:e._({id:"mVeaUg"}),onClick:()=>{p.open()}}),je({hidden:!b.hasAddRole(_.purchase_order),onClick:()=>F.open(),tooltip:e._({id:"oi/3Pq"})}),Pe({tooltip:e._({id:"20mLBC"}),hidden:!j,onClick:T.open}),Se({tooltip:e._({id:"tVJk4q"}),hidden:!q,onClick:g.open})]})]},[u,t,b,c]),U=a.useMemo(()=>h.isLoading?[]:[s.jsx(Ve,{status:t.status_custom_key,type:i.purchaseorder,options:{size:"lg"}})],[t,h]),O=a.useMemo(()=>{let o=t.supplier_detail?.name||"";return t.supplier_reference&&(o+=` (${t.supplier_reference})`),o},[t]);return s.jsxs(s.Fragment,{children:[A.modal,T.modal,g.modal,M.modal,p.modal,F.modal,s.jsx(De,{query:h,requiredRole:_.purchase_order,children:s.jsxs(ue,{gap:"xs",children:[s.jsx(qe,{title:`${e._({id:"KxySMG"})}: ${t.reference}`,subtitle:O,imageUrl:t.supplier_detail?.image,breadcrumbs:[{name:e._({id:"UOTpFa"}),url:"/purchasing/"}],lastCrumb:[{name:t.reference,url:`/purchasing/purchase-order/${t.pk}`}],actions:K,badges:U,editAction:p.open,editEnabled:b.hasChangePermission(i.purchaseorder)}),s.jsx(Ne,{pageKey:"purchaseorder",panels:L,model:i.purchaseorder,instance:t,reloadInstance:l,id:t.pk})]})})]})}export{Zt as default};
//# sourceMappingURL=PurchaseOrderDetail-BcBCLcbe.js.map
