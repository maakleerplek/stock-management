import{ag as Q,r as n,ao as a,j as t,b5 as L,ab as s,bc as r,d as u,c8 as v,aO as D,aq as F,a7 as I,S as V,aD as A}from"./index-DjOBj_Ai.js";import{aq as H,ae as Z,j as f,e as $,c as W,d as X}from"./Filter-CpWhllKn.js";import{P as J}from"./PrimaryActionButton-BAA_Awc0.js";import{B as ee,P as se,O as te,E as ie,C as re}from"./InvenTreeTable-C-s5lvnS.js";import{I as oe,D as h,a as ae}from"./InstanceDetail-DPGTPy9_.js";import{D as _}from"./DetailsBadge-BUJWq3FE.js";import{D as ne,A as de,N as le}from"./NotesPanel-Gq5AAnCV.js";import{P as me}from"./PageDetail-1HLwiKVO.js";import{P as ce}from"./PanelGroup-_Eigw1UV.js";import{f as M}from"./formatters-Dkpc25sQ.js";import{b as pe,c as _e}from"./SalesOrderForms-EpMC8M0_.js";import{u as C}from"./UseInstance-BYH4ds5B.js";import{S as ue}from"./SalesOrderAllocationTable-CViFzEk8.js";import{a1 as he,a as be,y as fe,a9 as P}from"./ThemeContext-BjJu0IKI.js";import{I as xe}from"./IconBookmark-DTqUQJe4.js";import"./DesktopAppView-D6tHFi_e.js";import"./ActionButton-D4nRdKaB.js";import"./IconChevronDown-I6OOyduR.js";import"./index-_kfXKtfq.js";import"./QRCode-BL-P7mX-.js";import"./browser-JUP5PmmS.js";import"./IconDotsVertical-CGvw5eIR.js";import"./IconTags-Bukq1non.js";import"./YesNoButton-CYsvXLSb.js";import"./ModelType-BxY4rynO.js";import"./GenericErrorPage-BWQWzpn2.js";import"./NotFound-BksZ8Fp_.js";import"./PermissionDenied-CPiNkqvu.js";import"./use-hover-CbuFBCOT.js";import"./index-Chjiymov.js";import"./AttachmentLink-EwW6behJ.js";import"./PageTitle-CaObz4lR.js";import"./PluginUIFeature-DWPwHUQS.js";import"./RemoteComponent-CrOPmrx3.js";import"./ColumnRenderers-BCeqgJNS.js";import"./IconUsers-DgSduCbv.js";import"./IconAddressBook-0_3zwfXJ.js";import"./UseStockAdjustActions-B7uQUwuU.js";function is(){const{id:Y}=he(),m=Q(),E=be(),w=n.useMemo(()=>m.userId(),[m]),{instance:e,instanceQuery:c,refreshInstance:p}=C({endpoint:a.sales_order_shipment_list,pk:Y,params:{order_detail:!0}}),{instance:d,instanceQuery:x}=C({endpoint:a.company_list,pk:e.order_detail?.customer,hasPrimaryKey:!0}),i=n.useMemo(()=>!e.shipment_date,[e]),l=n.useMemo(()=>!!e.checked_by,[e]),k=n.useMemo(()=>{if(c.isFetching||x.isFetching)return t.jsx(L,{});const o={...e,customer:d?.pk,customer_name:d?.name,customer_reference:e.order_detail?.customer_reference},T=[{type:"link",model:r.salesorder,name:"order",label:s._({id:"LozYBo"}),icon:"sales_orders",model_field:"reference"},{type:"link",name:"customer",icon:"customers",label:s._({id:"876pfE"}),model:r.company,model_field:"name",hidden:!o.customer},{type:"link",external:!0,name:"link",label:s._({id:"yzF66j"}),copy:!0,hidden:!e.link}],q=[{type:"text",name:"customer_reference",icon:"serial",label:s._({id:"ZVUe1A"}),hidden:!o.customer_reference,copy:!0},{type:"text",name:"reference",icon:"serial",label:s._({id:"Dwgrby"}),copy:!0},{type:"text",name:"tracking_number",label:s._({id:"DTku8S"}),icon:"trackable",value_formatter:()=>e.tracking_number||"---",copy:!!e.tracking_number},{type:"text",name:"invoice_number",label:s._({id:"MhyecB"}),icon:"serial",value_formatter:()=>e.invoice_number||"---",copy:!!e.invoice_number}],z=e.shipment_address_detail||e.order_detail?.address_detail,G=[{type:"text",name:"address",label:s._({id:"g6yaYE"}),icon:"address",value_formatter:()=>z?t.jsx(H,{instance:e.shipment_address_detail||e.order_detail?.address_detail}):t.jsx(u,{size:"sm",c:"red",children:s._({id:"dm2vYF"})})}],K=[{type:"text",name:"allocated_items",icon:"packages",label:s._({id:"sdy17V"})},{type:"text",name:"checked_by",label:s._({id:"3hwu1C"}),icon:"check",value_formatter:()=>e.checked_by_detail?t.jsx(Z,{instance:e.checked_by_detail}):t.jsx(u,{size:"sm",c:"red",children:s._({id:"zjdtIu"})})},{type:"text",name:"shipment_date",label:s._({id:"MFQxyA"}),icon:"calendar",value_formatter:()=>M(e.shipment_date),hidden:!e.shipment_date},{type:"text",name:"delivery_date",label:s._({id:"ovm9ir"}),icon:"calendar",value_formatter:()=>M(e.delivery_date),hidden:!e.delivery_date}];return t.jsx(t.Fragment,{children:t.jsxs(oe,{children:[t.jsxs(v,{grow:!0,children:[t.jsx(ne,{appRole:D.sales_order,apiPath:a.company_list,src:d?.image,pk:d?.pk,imageActions:{selectExisting:!1,downloadImage:!1,uploadFile:!1,deleteFile:!1}}),t.jsx(v.Col,{span:{base:12,sm:8},children:t.jsx(h,{fields:T,item:o})})]}),t.jsx(h,{fields:q,item:o}),t.jsx(h,{fields:G,item:o}),t.jsx(h,{fields:K,item:o})]})})},[e,c,d,x]),B=n.useMemo(()=>[{name:"detail",label:s._({id:"aaEiwW"}),icon:t.jsx(fe,{}),content:k},{name:"items",label:s._({id:"MD2yP5"}),icon:t.jsx(xe,{}),content:t.jsx(ue,{orderId:e.order,shipmentId:e.pk,showPartInfo:!0,allowEdit:i,modelField:"item",modelTarget:r.stockitem})},de({model_type:r.salesordershipment,model_id:e.pk}),le({model_type:r.salesordershipment,model_id:e.pk})],[i,e,k]),R=pe({pending:i,customerId:e.order_detail?.customer}),b=f({url:a.sales_order_shipment_list,pk:e.pk,fields:R,title:s._({id:"rX/5YH"}),onFormSuccess:p}),y=$({url:a.sales_order_shipment_list,pk:e.pk,title:s._({id:"YAsuZ2"}),onFormSuccess:()=>{E(A(r.salesorder,e.order))}}),O=_e({}),g=W({url:a.sales_order_shipment_complete,pk:e.pk,fields:O,title:s._({id:"/IxVda"}),focus:"tracking_number",initialData:{...e,shipment_date:X().format("YYYY-MM-DD")},onFormSuccess:p}),j=f({url:a.sales_order_shipment_list,pk:e.pk,title:s._({id:"+/tsLo"}),preFormContent:t.jsx(F,{color:"green",icon:t.jsx(I,{}),title:s._({id:"+/tsLo"}),children:t.jsx(u,{children:s._({id:"tVwgS8"})})}),fetchInitialData:!1,fields:{checked_by:{hidden:!0,value:w}},successMessage:s._({id:"geK3em"}),onFormSuccess:p}),S=f({url:a.sales_order_shipment_list,pk:e.pk,title:s._({id:"0NN8nM"}),preFormContent:t.jsx(F,{color:"red",icon:t.jsx(P,{}),title:s._({id:"0NN8nM"}),children:t.jsx(u,{children:s._({id:"u6RcM4"})})}),fetchInitialData:!1,fields:{checked_by:{hidden:!0,value:null}},successMessage:s._({id:"Y1izhb"}),onFormSuccess:p}),U=n.useMemo(()=>c.isFetching?[]:[t.jsx(_,{label:s._({id:"UbRKMZ"}),color:"gray",visible:i},"pending"),t.jsx(_,{label:s._({id:"VSGGki"}),color:"green",visible:i&&l},"checked"),t.jsx(_,{label:s._({id:"WPp4C4"}),color:"red",visible:i&&!l},"not-checked"),t.jsx(_,{label:s._({id:"AoOqHM"}),color:"green",visible:!i},"shipped"),t.jsx(_,{label:s._({id:"BTOhSm"}),color:"blue",visible:!!e.delivery_date},"delivered")],[i,l,e.deliveryDate,c.isFetching]),N=n.useMemo(()=>{const o=m.hasChangePermission(r.salesordershipment);return[t.jsx(J,{title:s._({id:"1mYYQ6"}),icon:"sales_orders",hidden:!i,color:"green",onClick:()=>{g.open()}},"send-shipment"),t.jsx(ee,{model:r.salesordershipment,pk:e.pk,hash:e?.barcode_hash},"barcode"),t.jsx(se,{modelType:r.salesordershipment,items:[e.pk],enableLabels:!0,enableReports:!0},"print"),t.jsx(te,{tooltip:s._({id:"8ijAtN"}),actions:[ie({hidden:!o,onClick:b.open,tooltip:s._({id:"rX/5YH"})}),{hidden:!i||l,name:s._({id:"9td1Wl"}),tooltip:s._({id:"Hg9xwv"}),icon:t.jsx(I,{color:"green"}),onClick:j.open},{hidden:!i||!l,name:s._({id:"KtJ7KJ"}),tooltip:s._({id:"s7mDq/"}),icon:t.jsx(P,{color:"red"}),onClick:S.open},re({hidden:!i,onClick:y.open,tooltip:s._({id:"YAsuZ2"})})]},"actions")]},[l,i,m,e]);return t.jsxs(t.Fragment,{children:[g.modal,b.modal,y.modal,j.modal,S.modal,t.jsx(ae,{query:c,requiredRole:D.sales_order,children:t.jsxs(V,{gap:"xs",children:[t.jsx(me,{title:`${s._({id:"qGSobR"})}: ${e.reference}`,subtitle:`${s._({id:"LozYBo"})}: ${e.order_detail?.reference}`,breadcrumbs:[{name:s._({id:"mUv9U4"}),url:"/sales/"},{name:e.order_detail?.reference,url:A(r.salesorder,e.order)}],badges:U,imageUrl:d?.image,editAction:b.open,editEnabled:m.hasChangePermission(r.salesordershipment),actions:N}),t.jsx(ce,{pageKey:"salesordershipment",panels:B,model:r.salesordershipment,reloadInstance:p,instance:e,id:e.pk})]})})]})}export{is as default};
//# sourceMappingURL=SalesOrderShipmentDetail-DqUBA5QW.js.map
