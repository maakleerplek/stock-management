import{ag as P,j as s,N as m,S as v,d as f,aA as U,ab as d,b3 as z,b6 as C,$ as A,r as i,bc as R,aC as q,e as V,an as $,O as _,al as F,bp as G,az as N,bf as B,bV as j,aq as M,a8 as D,b5 as Q,bm as W,c as H,cP as w,ao as L,cQ as k,cR as O}from"./index-DjOBj_Ai.js";import{a as X,S as J,C as Y,a5 as E,y as Z}from"./ThemeContext-BjJu0IKI.js";import{u as K}from"./DesktopAppView-D6tHFi_e.js";import{R as ee,j as se}from"./Filter-CpWhllKn.js";function oe({label:e,title:n,shorthand:l,subtitle:a}){const c=P(),r=X();return s.jsxs(m,{justify:"space-between",children:[s.jsxs(v,{gap:"0",ml:"sm",children:[s.jsxs(m,{children:[s.jsx(J,{size:"xl",children:n}),l&&s.jsxs(f,{c:"dimmed",children:["(",l,")"]})]}),s.jsx(m,{children:a?s.jsx(f,{c:"dimmed",children:a}):null})]}),c.isStaff()&&s.jsx(U,{data:[{value:"user",label:d._({id:"ekfzWq"})},{value:"system",label:d._({id:"zNkWa6"})},{value:"admin",label:d._({id:"uTLn08"})}],onChange:t=>r(`/settings/${t}`),value:e})]})}function ne({setting:e,onEdit:n,onToggle:l}){const a=i.useMemo(()=>{let o=e.value;return e?.choices&&e?.choices?.length>0&&(o=e.choices.find(b=>b.value==e.value)?.display_name||e.value),e?.units&&(o=`${o} ${e.units}`),o},[e]),[c,r]=i.useState(null),t=i.useCallback(()=>{e.read_only||n(e)},[e,n]),S=i.useCallback(o=>{e.read_only||l(e,o.currentTarget.checked)},[e,l]),p=i.useMemo(()=>{if(e.model_name){const o=e.model_name.split(".")[1];return R[o]||null}return null},[e]);if(i.useEffect(()=>{if(r(null),p&&e.value){const o=q[p].api_endpoint;V.get($(o,e.value)).then(h=>{h.data?r(h.data):r(null)}).catch(h=>{r(null)})}},[e,p]),c&&p&&e.value)return s.jsxs(m,{justify:"right",gap:"xs",children:[s.jsx(ee,{instance:c,model:p}),s.jsx(_,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:t,children:s.jsx(E,{})})]});switch(e?.type||"string"){case"boolean":return s.jsx(G,{size:"sm",radius:"lg","aria-label":`toggle-setting-${e.key}`,disabled:e.read_only,checked:e.value.toString().toLowerCase()=="true",onChange:S,wrapperProps:{"aria-label":`setting-${e.key}-wrapper`},style:{paddingRight:"20px"}});default:return a?s.jsxs(m,{gap:"xs",justify:"right",children:[s.jsx(F,{}),s.jsx(_,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:t,children:a})]}):s.jsx(_,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:t,children:s.jsx(E,{})})}}function ae({setting:e,shaded:n,onEdit:l,onToggle:a}){const{colorScheme:c}=z(),r={paddingLeft:"8px"};return n&&(r.backgroundColor=c==="light"?C.colors.gray[1]:C.colors.gray[9]),s.jsx(A,{style:r,children:s.jsxs(m,{justify:"space-between",p:"3",children:[s.jsxs(v,{gap:"2",p:"4px",children:[s.jsxs(f,{children:[e.name,e.required?" *":""]}),s.jsx(f,{size:"xs",children:e.description})]}),s.jsx(Y,{label:`setting-value-${e.key}`,children:s.jsx(ne,{setting:e,onEdit:l,onToggle:a})})]})})}function g({settingsState:e,keys:n,onChange:l,onLoaded:a}){i.useEffect(()=>{e.loaded&&a?.(e)},[e.loaded,e.settings]);const c=K(),r=i.useMemo(()=>e?.settings?.map(u=>u.key)??[],[e?.settings]),[t,S]=i.useState(void 0),p=i.useMemo(()=>t?.choices?.length?"choice":t?.type!=null?t.type:"string",[t]),o=i.useMemo(()=>t?.key??"",[t]),h=se({url:e.endpoint,pk:o,pathParams:e.pathParams,title:d._({id:"mjN1LS"}),fields:{value:{field_type:p,required:t?.required??!1,label:t?.name,description:t?.description,api_url:t?.api_url??"",model:t?.model_name?.split(".")[1]??null,filters:t?.model_filters||void 0,choices:t?.choices??void 0}},successMessage:d._({id:"1onc6y",values:{key:o}}),onFormSuccess:()=>{e.fetchSettings(),l?.()}}),b=i.useCallback(u=>{S(u),h.open()},[h]),T=i.useCallback((u,y)=>{c.patch($(e.endpoint,u.key,e.pathParams),{value:y}).then(()=>{j.hide("setting"),j.show({title:d._({id:"C3htzi"}),message:d._({id:"n/n6vh",values:{0:u.key}}),color:"green",id:"setting"}),l?.()}).catch(x=>{j.hide("setting"),j.show({title:d._({id:"CsUgn+"}),message:x.message,color:"red",id:"setting"})}).finally(()=>{e.fetchSettings()})},[e]);return e.isError?s.jsx(M,{color:"red",icon:s.jsx(D,{}),title:d._({id:"SlfejT"}),children:s.jsx(f,{children:d._({id:"wXadfA"})})}):e?.loaded?(n||r).length===0?s.jsx(M,{color:"blue",icon:s.jsx(Z,{}),title:d._({id:"j+o7ms"}),children:s.jsx(f,{children:d._({id:"9922QB"})})}):s.jsxs(s.Fragment,{children:[h.modal,s.jsxs(v,{gap:"xs",children:[(n||r)?.map((u,y)=>{const x=e?.settings?.find(I=>I.key===u);return e?.settings&&!x&&console.error(`Setting ${u} not found`),s.jsx(W.Fragment,{children:x?s.jsx(ae,{setting:x,shaded:y%2===0,onEdit:b,onToggle:T}):s.jsxs(f,{size:"sm",style:{fontStyle:"italic"},c:"red",children:["Setting ",u," not found"]})},u)}),(n||r)?.length===0&&s.jsx(f,{style:{fontStyle:"italic"},children:s.jsx(H,{id:"3CUVvD"})})]})]}):s.jsx(Q,{animate:!0})}function ce({keys:e}){const n=B();return s.jsx(g,{settingsState:n,keys:e})}function de({keys:e}){const n=N();return s.jsx(g,{settingsState:n,keys:e})}function ue({pluginKey:e,onLoaded:n}){const l=i.useMemo(()=>w({plugin:e,endpoint:L.plugin_setting_list}),[e]),a=k(l);return i.useEffect(()=>{a.fetchSettings()},[a.fetchSettings]),s.jsx(g,{settingsState:a,onLoaded:n})}function he({pluginKey:e,onLoaded:n}){const l=i.useMemo(()=>w({plugin:e,endpoint:L.plugin_user_setting_list}),[e]),a=k(l);return i.useEffect(()=>{a.fetchSettings()},[a.fetchSettings]),s.jsx(g,{settingsState:a,onLoaded:n})}function fe({machinePk:e,configType:n,onChange:l}){const a=i.useMemo(()=>O({machine:e,configType:n}),[e,n]),c=k(a);return i.useEffect(()=>{c.fetchSettings()},[c.fetchSettings]),s.jsx(g,{settingsState:c,onChange:l})}export{de as G,fe as M,ue as P,oe as S,ce as U,he as a};
//# sourceMappingURL=SettingList-LimgrkYC.js.map
