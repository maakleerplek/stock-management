import{ag as N,r as a,ab as t,bc as u,ao as _,aO as k,j as p,an as V}from"./index-DjOBj_Ai.js";import{A as Y}from"./ActionButton-D4nRdKaB.js";import{u as G,R as K,a as P,d as z,I as H}from"./InvenTreeTable-C-s5lvnS.js";import{f as O}from"./formatters-Dkpc25sQ.js";import{a as Q}from"./SalesOrderForms-EpMC8M0_.js";import{ai as T,U as Z,j as W,e as $,k as I}from"./Filter-CpWhllKn.js";import{u as ee}from"./UseStockAdjustActions-B7uQUwuU.js";import{R as te,D as j,S as se,P as ie,j as ae}from"./ColumnRenderers-BCeqgJNS.js";import{a as le,q as oe}from"./ThemeContext-BjJu0IKI.js";function fe({partId:o,stockId:M,orderId:r,lineItemId:x,shipmentId:h,showPartInfo:n,showOrderInfo:d,allowEdit:c,isSubTable:s,modelTarget:S,modelField:v}){const m=N(),D=le(),q=a.useMemo(()=>{let e="salesorderallocations";return o&&(e+="-part"),s&&(e+="-sub"),e},[o,s]),i=G(q),w=a.useMemo(()=>{const e=[{name:"outstanding",label:t._({id:"aimnwe"}),description:t._({id:"ILsgZ4"})},{name:"assigned_to_shipment",label:t._({id:"uvBviC"}),description:t._({id:"U6KGSj"})},T()];return o&&e.push(Z()),e},[o]),y=a.useMemo(()=>[te({accessor:"order_detail.reference",title:t._({id:"LozYBo"}),switchable:!1,sortable:!0,hidden:d!=!0}),j({accessor:"order_detail.description",hidden:d!=!0}),se({accessor:"order_detail.status",model:u.salesorder,title:t._({id:"acIJ41"}),hidden:d!=!0}),ie({hidden:n!=!0,part:"part_detail"}),j({accessor:"part_detail.description",hidden:n!=!0}),{accessor:"part_detail.IPN",title:t._({id:"3wXEsN"}),hidden:n!=!0,sortable:!0,ordering:"IPN"},{accessor:"serial",title:t._({id:"AXeJt4"}),sortable:!0,switchable:!0,render:e=>e?.item_detail?.serial},{accessor:"batch",title:t._({id:"Vea6Aj"}),sortable:!0,switchable:!0,render:e=>e?.item_detail?.batch},{accessor:"available",title:t._({id:"I8CEek"}),sortable:!1,hidden:s,render:e=>e?.item_detail?.quantity},{accessor:"quantity",title:t._({id:"Tk6w1l"}),sortable:!0},ae({accessor:"location_detail",switchable:!0,sortable:!0}),{accessor:"shipment_detail.reference",title:t._({id:"4fws5M"}),switchable:!0,sortable:!1,render:e=>e.shipment_detail?.reference??t._({id:"Xmnh8X"})},{accessor:"shipment_date",title:t._({id:"MFQxyA"}),switchable:!0,sortable:!0,render:e=>e.shipment_detail?.shipment_date?O(e.shipment_detail.shipment_date):e.shipment?t._({id:"BVdqnq"}):t._({id:"Xmnh8X"})}],[d,n,s]),[b,R]=a.useState(0),[L,X]=a.useState(null),B=Q({orderId:r,shipment:L}),g=W({url:_.sales_order_allocation_list,pk:b,fields:B,title:t._({id:"+2kti8"}),onFormSuccess:()=>i.refreshTable()}),C=$({url:_.sales_order_allocation_list,pk:b,title:t._({id:"m9p8qY"}),onFormSuccess:()=>i.refreshTable()}),E=a.useCallback(e=>{const l=!!e.shipment_detail?.shipment_date;return[K({tooltip:t._({id:"+2kti8"}),hidden:l||!c||!m.hasChangeRole(k.sales_order),onClick:()=>{R(e.pk),X(e.shipment),g.open()}}),P({tooltip:t._({id:"m9p8qY"}),hidden:l||!c||!m.hasDeleteRole(k.sales_order),onClick:()=>{R(e.pk),C.open()}}),z({tooltip:t._({id:"GtJdx7"}),title:t._({id:"GtJdx7"}),hidden:!e.shipment||!!h,modelId:e.shipment,modelType:u.salesordershipment,navigate:D})]},[c,h,m]),U=a.useMemo(()=>({items:i.selectedRecords.filter(l=>!!l.item_detail).map(l=>({...l.item_detail,part_detail:l.part_detail,location_detail:l.location_detail})),model:u.stockitem,refresh:i.refreshTable}),[i.selectedRecords,i.refreshTable]),f=ee({formProps:U,merge:!1,assign:!1,delete:!1,add:!1,count:!1,remove:!1}),A=a.useMemo(()=>(i.selectedRecords?.filter(e=>!e.shipment_detail?.shipment_date)??[]).map(e=>e.pk),[i.selectedRecords]),F=I({url:_.sales_order_allocation_list,items:A,title:t._({id:"jLpOuT"}),fields:{shipment:{filters:{order:r,shipped:!1}}},onFormSuccess:i.refreshTable}),J=a.useMemo(()=>[f.dropdown,p.jsx(Y,{tooltip:t._({id:"7m2EYK"}),icon:p.jsx(oe,{}),onClick:()=>{F.open()},disabled:A.length==0,hidden:!r||!c||!m.hasChangeRole(k.sales_order)})],[c,A,r,m,f.dropdown]);return p.jsxs(p.Fragment,{children:[F.modal,g.modal,C.modal,!s&&f.modals.map(e=>e.modal),p.jsx(H,{url:V(_.sales_order_allocation_list),tableState:i,columns:y,props:{params:{part_detail:n??!1,order_detail:d??!1,item_detail:!0,location_detail:!0,line:x,part:o,order:r,shipment:h,item:M},enableSearch:!s,enableRefresh:!s,enableColumnSwitching:!s,enableFilters:!s,enableDownload:!s,enableSelection:!s,minHeight:s?100:void 0,rowActions:E,tableActions:s?void 0:J,tableFilters:w,modelField:v??"order",enableReports:!s,enableLabels:!s,printingAccessor:"item",modelType:S??u.salesorder}})]})}export{fe as S};
//# sourceMappingURL=SalesOrderAllocationTable-CViFzEk8.js.map
