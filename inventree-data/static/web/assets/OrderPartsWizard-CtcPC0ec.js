import{K as le,az as V,r as s,j as e,bc as M,ab as a,an as E,ao as S,b2 as q,U as oe,ax as de,ay as ce,ak as C,bd as L,N as b,b as ue,S as Q,al as pe,aj as Y,ba as _e,aB as xe,aa as P,ac as z,cx as K,a7 as fe,aq as Z,a8 as $,av as he,$ as je,be as ge,bP as R,d as y}from"./index-DjOBj_Ai.js";import{A as w}from"./ActionButton-D4nRdKaB.js";import{a5 as me,c as T,d as be,T as ke,h as D,i as I,m as J,q as A}from"./Filter-CpWhllKn.js";import{P as ye,W as ve}from"./index-_kfXKtfq.js";import{a as we}from"./CompanyForms-BrBn0vUb.js";import{I as ee,b as Ce,d as Se,e as Ee,R as te}from"./PluginUIFeature-DWPwHUQS.js";import{L as Fe,ap as N,aq as qe,al as Ie,S as ie,z as v,t as Ae,aj as Pe,ar as ze,Z as De,C as Oe,as as X,p as Te,y as Me}from"./ThemeContext-BjJu0IKI.js";import{I as Be}from"./IconUsers-DgSduCbv.js";import{I as Le}from"./IconAddressBook-0_3zwfXJ.js";import{u as Re}from"./UseInstance-BYH4ds5B.js";import{b as Ne}from"./IconChevronDown-I6OOyduR.js";import{l as Ve}from"./ColumnRenderers-BCeqgJNS.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"M5 12l14 0",key:"svg-0"}],["path",{d:"M5 12l6 6",key:"svg-1"}],["path",{d:"M5 12l6 -6",key:"svg-2"}]],We=le("outline","arrow-left","ArrowLeft",Qe);function ct({supplierId:t,orderId:i,create:c}){const u=V(),[l,r]=s.useState(""),[_,h]=s.useState(!0),[j,x]=s.useState({});return s.useEffect(()=>{_&&r("")},[_]),s.useEffect(()=>{h(l==="")},[l]),s.useMemo(()=>{const o={order:{filters:{supplier_detail:!0},disabled:!0},part:{filters:{part_detail:!0,supplier_detail:!0,active:!0,part_active:!0},onValueChange:(d,m)=>{x(m?.part_detail??{})},adjustFilters:d=>({...d.filters,supplier:t})},quantity:{},reference:{},purchase_price:{icon:e.jsx(De,{}),value:l,onValueChange:r},purchase_price_currency:{icon:e.jsx(ee,{})},auto_pricing:{value:_,onValueChange:h},project_code:{description:a._({id:"XruckR"})},target_date:{icon:e.jsx(N,{})},destination:{icon:e.jsx(ze,{})},build_order:{disabled:!j?.assembly,filters:{external:!0,outstanding:!0,part:j?.pk}},notes:{icon:e.jsx(Pe,{})},link:{icon:e.jsx(Ae,{})}};return u.isSet("BUILDORDER_EXTERNAL_BUILDS",!1)||delete o.build_order,c&&(o.merge_items={}),o},[c,i,j,u,t,_,l])}function He({supplierId:t,duplicateOrderId:i}){const c=V();return s.useMemo(()=>{const u={reference:{icon:e.jsx(Ie,{})},description:{},supplier:{value:t,disabled:!!i||!!t,filters:{is_supplier:!0,active:!0}},supplier_reference:{},project_code:{icon:e.jsx(qe,{})},order_currency:{icon:e.jsx(ee,{})},start_date:{icon:e.jsx(N,{})},target_date:{icon:e.jsx(N,{})},destination:{filters:{structural:!1}},link:{},contact:{icon:e.jsx(Fe,{}),adjustFilters:l=>({...l.filters,company:l.data.supplier})},address:{icon:e.jsx(Le,{}),adjustFilters:l=>({...l.filters,company:l.data.supplier})},responsible:{filters:{is_active:!0},icon:e.jsx(Be,{})}};return i&&(u.duplicate={children:{order_id:{hidden:!0,value:i},copy_lines:{},copy_extra_lines:{}}}),c.isSet("PROJECT_CODES_ENABLED",!0)||delete u.project_code,u},[i,t,c])}function Ge({props:t,record:i,statuses:c}){const[u,{open:l,close:r}]=q(!1,{onClose:()=>t.changeFn(t.idx,"barcode",void 0)}),[_,h]=q(!1,{onClose:()=>t.changeFn(t.idx,"location",void 0)}),j=s.useMemo(()=>i.part_detail?.trackable??!1,[i]),x=V();s.useEffect(()=>{i.destination&&(t.changeFn(t.idx,"location",i.destination),h.open())},[i.destination]);const f=Ce({isEnabled:()=>g,onGenerate:p=>{p&&t.changeFn(t.idx,"batch_code",p)}}),o=Se({isEnabled:()=>g&&j,onGenerate:p=>{p&&t.changeFn(t.idx,"serial_numbers",p)}}),[d,m]=q(!1,{onClose:()=>{t.changeFn(t.idx,"packaging",void 0)}}),[n,k]=q(!1,{onClose:()=>{t.changeFn(t.idx,"note",void 0)}}),[g,F]=q(!1,{onClose:()=>{t.changeFn(t.idx,"batch_code",void 0),t.changeFn(t.idx,"serial_numbers",void 0)},onOpen:()=>{f.update({part:i?.supplier_part_detail?.part,order:i?.order}),j?o.update({part:i?.supplier_part_detail?.part,quantity:t.item.quantity}):t.changeFn(t.idx,"serial_numbers",void 0)}}),[W,ae]=q(!1,{onOpen:()=>{const p=i.part_detail?.default_expiry;p!==void 0&&p>0&&t.changeFn(t.idx,"expiry_date",be().add(p,"day").format("YYYY-MM-DD"))},onClose:()=>{t.changeFn(t.idx,"expiry_date",void 0)}}),[H,ne]=q(!1,{onClose:()=>t.changeFn(t.idx,"status",void 0)}),[O,G]=s.useState(""),[B,U]=s.useState(void 0);s.useEffect(()=>{t.changeFn(t.idx,"barcode",B)},[B]);const se=s.useMemo(()=>j?a._({id:"W778m0"}):a._({id:"K5pQC8"}),[j]);s.useEffect(()=>{if(!u)return;const p=setTimeout(()=>{U(O.length?O:null),r(),G("")},500);return()=>clearTimeout(p)},[O]);const re=s.useMemo(()=>{const p=a._({id:"RL9/J8"});return location===null?p:location===i.destination?a._({id:"LNKjyK"}):!i.destination&&!i.destination_detail&&i.part_detail&&location===i.part_detail?.category_default_location?a._({id:"q3WAIO"}):!i.destination&&i.destination_detail&&location===i.destination_detail.pk&&i.received>0?a._({id:"K1Mf+T"}):i.part_detail?.default_location&&location===i.part_detail.default_location?a._({id:"ALFlH9"}):p},[location]);return e.jsxs(e.Fragment,{children:[e.jsx(oe,{opened:u,onClose:r,title:e.jsx(ie,{children:a._({id:"fNvDwV"})}),children:e.jsx(de,{children:e.jsx(ce,{label:"Barcode data","data-autofocus":!0,value:O,onChange:p=>G(p.target.value)})})}),e.jsxs(C.Tr,{children:[e.jsx(C.Td,{children:e.jsxs(L,{gap:"sm",align:"center",children:[e.jsx(ke,{size:40,src:i.part_detail.thumbnail,align:"center"}),e.jsx("div",{children:i.part_detail.name})]})}),e.jsx(C.Td,{children:i.supplier_part_detail.SKU}),e.jsx(C.Td,{children:e.jsx(ye,{value:i.received,maximum:i.quantity,progressLabel:!0})}),e.jsx(C.Td,{style:{whiteSpace:"nowrap"},children:e.jsx(D,{fieldName:"quantity",fieldDefinition:{field_type:"number",value:t.item.quantity,onValueChange:p=>{t.changeFn(t.idx,"quantity",p),o.update({quantity:p})}},error:t.rowErrors?.quantity?.message})}),e.jsx(C.Td,{style:{width:"1%",whiteSpace:"nowrap"},children:e.jsxs(L,{gap:"1px",children:[e.jsx(w,{size:"sm",onClick:()=>h.toggle(),icon:e.jsx(v,{icon:"location"}),tooltip:a._({id:"TJYLHZ"}),tooltipAlignment:"top",variant:_?"filled":"transparent"}),e.jsx(w,{size:"sm",onClick:()=>F.toggle(),icon:e.jsx(v,{icon:"batch_code"}),tooltip:se,tooltipAlignment:"top",variant:g?"filled":"transparent"}),x.isSet("STOCK_ENABLE_EXPIRY")&&e.jsx(w,{size:"sm",onClick:()=>ae.toggle(),icon:e.jsx(Ee,{}),tooltip:a._({id:"okjJiB"}),tooltipAlignment:"top",variant:W?"filled":"transparent"}),e.jsx(w,{size:"sm",icon:e.jsx(v,{icon:"packaging"}),tooltip:a._({id:"O7MZ1G"}),tooltipAlignment:"top",onClick:()=>m.toggle(),variant:d?"filled":"transparent"}),e.jsx(w,{onClick:()=>ne.toggle(),icon:e.jsx(v,{icon:"status"}),tooltip:a._({id:"Gt4cm5"}),tooltipAlignment:"top",variant:H?"filled":"transparent"}),e.jsx(w,{icon:e.jsx(v,{icon:"note"}),tooltip:a._({id:"nxv8yE"}),tooltipAlignment:"top",variant:n?"filled":"transparent",onClick:()=>k.toggle()}),B?e.jsx(w,{icon:e.jsx(v,{icon:"unlink"}),tooltip:a._({id:"ut1J8k"}),tooltipAlignment:"top",variant:"filled",color:"red",onClick:()=>U(void 0)}):e.jsx(w,{icon:e.jsx(v,{icon:"barcode"}),tooltip:a._({id:"fNvDwV"}),tooltipAlignment:"top",variant:"transparent",onClick:()=>l()})]})}),e.jsx(C.Td,{children:e.jsx(te,{onClick:()=>t.removeFn(t.idx)})})]}),_&&e.jsx(C.Tr,{children:e.jsx(C.Td,{colSpan:10,children:e.jsxs(b,{grow:!0,preventGrowOverflow:!1,justify:"flex-apart",p:"xs",children:[e.jsx(ue,{flex:0,p:"xs",children:e.jsx(v,{icon:"downright"})}),e.jsx(D,{fieldDefinition:{field_type:"related field",model:M.stocklocation,api_url:E(S.stock_location_list),filters:{structural:!1},onValueChange:p=>{t.changeFn(t.idx,"location",p)},description:re,value:t.item.location,label:a._({id:"wJijgU"}),icon:e.jsx(v,{icon:"location"})},defaultValue:i.destination??(i.destination_detail?i.destination_detail.pk:null)}),e.jsxs(L,{style:{marginBottom:"7px"},children:[(i.part_detail?.default_location||i.part_detail?.category_default_location)&&e.jsx(w,{icon:e.jsx(v,{icon:"default_location"}),tooltip:a._({id:"j9qXAA"}),onClick:()=>t.changeFn(t.idx,"location",i.part_detail?.default_location??i.part_detail?.category_default_location),tooltipAlignment:"top"}),i.destination&&e.jsx(w,{icon:e.jsx(v,{icon:"destination"}),tooltip:a._({id:"Co8OYS"}),onClick:()=>t.changeFn(t.idx,"location",i.destination),tooltipAlignment:"top"}),!i.destination&&i.destination_detail&&i.received>0&&e.jsx(w,{icon:e.jsx(v,{icon:"repeat_destination"}),tooltip:a._({id:"CKgjtC"}),onClick:()=>t.changeFn(t.idx,"location",i.destination_detail.pk),tooltipAlignment:"top"})]})]})})}),e.jsx(I,{visible:g,onValueChange:p=>{t.changeFn(t.idx,"batch_code",p)},fieldName:"batch_code",fieldDefinition:{field_type:"string",label:a._({id:"Vea6Aj"}),description:a._({id:"s848yO"}),value:t.item.batch_code},error:t.rowErrors?.batch_code?.message}),e.jsx(I,{visible:g&&j,onValueChange:p=>t.changeFn(t.idx,"serial_numbers",p),fieldName:"serial_numbers",fieldDefinition:{field_type:"string",label:a._({id:"VzQT2x"}),description:a._({id:"ig+UDq"}),value:t.item.serial_numbers},error:t.rowErrors?.serial_numbers?.message}),x.isSet("STOCK_ENABLE_EXPIRY")&&e.jsx(I,{visible:W,onValueChange:p=>t.changeFn(t.idx,"expiry_date",p),fieldName:"expiry_date",fieldDefinition:{field_type:"date",label:a._({id:"uaSvqt"}),description:a._({id:"ICgiSv"}),value:t.item.expiry_date},error:t.rowErrors?.expiry_date?.message}),e.jsx(I,{visible:d,onValueChange:p=>t.changeFn(t.idx,"packaging",p),fieldName:"packaging",fieldDefinition:{field_type:"string",label:a._({id:"pD/Ew0"})},defaultValue:i?.supplier_part_detail?.packaging,error:t.rowErrors?.packaging?.message}),e.jsx(I,{visible:H,defaultValue:10,fieldName:"status",onValueChange:p=>t.changeFn(t.idx,"status",p),fieldDefinition:{field_type:"choice",api_url:E(S.stock_status),choices:c,label:a._({id:"uAQUqI"})},error:t.rowErrors?.status?.message}),e.jsx(I,{visible:n,fieldName:"note",onValueChange:p=>t.changeFn(t.idx,"note",p),fieldDefinition:{field_type:"string",label:a._({id:"KiJn9B"})},error:t.rowErrors?.note?.message})]})}function ut(t){const i=s.useMemo(()=>me(M.stockitem),[]),c=Object.fromEntries(t.items.map(r=>[r.pk,r])),u=t.items.filter(r=>r.quantity!==r.received),l=s.useMemo(()=>({id:{value:t.orderPk,hidden:!0},items:{field_type:"table",value:u.map((r,_)=>({line_item:r.pk,location:r.destination??r.destination_detail?.pk??null,quantity:r.quantity-r.received,expiry_date:null,batch_code:"",serial_numbers:"",status:10,barcode:null})),modelRenderer:r=>{const _=c[r.item.line_item];return e.jsx(Ge,{props:r,record:_,statuses:i},_.pk)},headers:[{title:a._({id:"vgP+9p"}),style:{minWidth:"200px"}},{title:a._({id:"y90mqQ"}),style:{minWidth:"200px"}},{title:a._({id:"fZ5Vnu"}),style:{minWidth:"200px"}},{title:a._({id:"VbWX2u"}),style:{width:"200px"}},{title:a._({id:"7L01XJ"})},{title:"",style:{width:"50px"}}]},location:{filters:{structural:!1}}}),[u,t,i]);return T({...t.formProps,url:E(S.purchase_order_receive,t.orderPk),title:a._({id:"MXlhj9"}),fields:l,initialData:{location:t.destinationPk},size:"80%",successMessage:a._({id:"zFmwOr"})})}function Ue({currentStep:t,steps:i,onSelectStep:c,disableManualStepChange:u=!1}){if(!i||i.length==0)return null;const l=s.useCallback(h=>!i||i.length<=1?!1:Math.abs(h-t)==1,[t,i]),r=t>0,_=t<i.length-1;return e.jsx(xe,{p:"xs",withBorder:!0,children:e.jsxs(b,{justify:u?"center":"space-between",gap:"xs",wrap:"nowrap",children:[!u&&e.jsx(P,{label:i[t-1],position:"top",disabled:!r,children:e.jsx(z,{variant:"transparent",onClick:()=>c(t-1),disabled:!r,children:e.jsx(We,{})})}),e.jsx(K,{active:t,onStepClick:h=>{u||c(h)},iconSize:20,size:"xs",children:i.map((h,j)=>e.jsx(K.Step,{label:h,"aria-label":`wizard-step-${j}`,allowStepSelect:l(j)},h))}),_?!u&&e.jsx(P,{label:i[t+1],position:"top",disabled:!_,children:e.jsx(z,{variant:"transparent",onClick:()=>c(t+1),disabled:!_||u,children:e.jsx(Ne,{})})}):e.jsx(P,{label:a._({id:"bD8I7O"}),position:"top",children:e.jsx(z,{color:"green",variant:"transparent",children:e.jsx(fe,{})})})]})})}function Ke({title:t,currentStep:i,steps:c,children:u,opened:l,onClose:r,onNextStep:_,onPreviousStep:h,disableManualStepChange:j}){const x=s.useMemo(()=>e.jsxs(Q,{gap:"xs",style:{width:"100%"},children:[e.jsxs(b,{gap:"xs",wrap:"nowrap",justify:"space-between",grow:!0,preventGrowOverflow:!1,children:[e.jsx(ie,{size:"xl",children:t}),e.jsx(Ue,{currentStep:i,steps:c,disableManualStepChange:j,onSelectStep:f=>{j||(f<i?h?.():_?.())}}),e.jsx(pe,{})]}),e.jsx(Y,{})]}),[t,i,c]);return e.jsx(_e,{position:"bottom",size:"75%",title:x,withCloseButton:!0,closeOnEscape:!1,closeOnClickOutside:!1,styles:{header:{width:"100%"},title:{width:"100%"}},opened:l,onClose:r,children:e.jsx(Oe,{label:"wizard-drawer",children:u})})}function Je(t){const[i,c]=s.useState(0),[u,l]=s.useState(!1),[r,_]=s.useState(null),[h,j]=s.useState(null),x=s.useCallback(()=>{_(null),j(null)},[]);s.useEffect(()=>{u&&(c(0),x())},[u]);const f=s.useCallback(()=>{l(!0)},[]),o=s.useCallback(()=>{t.onClose?.(),l(!1)},[]),d=s.useCallback(()=>{c(g=>{if(t.canStepForward&&!t.canStepForward(g))return g;const F=Math.min(g+1,t.steps.length-1);return F!==g&&x(),F})},[t.canStepForward]),m=s.useCallback(()=>{c(g=>{if(t.canStepBackward&&!t.canStepBackward(g))return g;const F=Math.max(g-1,0);return F!==g&&x(),F})},[t.canStepBackward]),n=s.useCallback(g=>{g<0||g>=t.steps.length||(c(g),x())},[t.steps.length]),k=s.useMemo(()=>t.renderStep(i),[u,i,t.renderStep]);return{currentStep:i,opened:u,clearError:x,error:r,setError:_,errorDetail:h,setErrorDetail:j,openWizard:f,closeWizard:o,nextStep:d,previousStep:m,setStep:n,wizard:e.jsx(Ke,{disableManualStepChange:t.disableManualStepChange,title:t.title,currentStep:i,steps:t.steps,opened:u,onClose:o,onNextStep:d,onPreviousStep:m,children:e.jsxs(Q,{gap:"xs",children:[r&&e.jsx(Z,{color:"red",title:r,icon:e.jsx($,{}),children:h}),k]})})}}function Xe({partId:t,onQuantityChange:i}){const[c,u]=s.useState(0);s.useEffect(()=>{i?.(c)},[c]);const l=Re({endpoint:S.part_requirements,pk:t,hasPrimaryKey:!0,defaultValue:{}});return s.useMemo(()=>{if(l.instanceQuery.isFetching||l.instanceQuery.isLoading)return e.jsx(ge,{size:"sm"});if(l.instanceQuery.isError)return e.jsx(P,{label:a._({id:"WMVuBL"}),children:e.jsx(z,{variant:"transparent",color:"red",children:e.jsx($,{})})});const _=l.instance?.required_for_build_orders||0,h=l.instance?.required_for_sales_orders||0,j=_+h,x=l.instance?.building||0,f=l.instance?.ordering||0,o=x+f,d=l.instance?.total_stock||0,m=Math.max(0,j-d-o);return u(m),e.jsxs(R,{position:"bottom-end",children:[e.jsx(R.Target,{children:e.jsx(z,{variant:"transparent",color:m>0?"blue":"green",size:"sm",children:e.jsx(Me,{})})}),e.jsx(R.Dropdown,{children:e.jsxs(Q,{gap:"xs",children:[e.jsx(y,{children:a._({id:"QuBpLd"})}),e.jsx(Y,{}),_>0&&e.jsxs(b,{justify:"space-between",children:[e.jsx(y,{size:"xs",children:a._({id:"OQGQ1P"})}),e.jsx(y,{size:"xs",children:A(_)})]}),h>0&&e.jsxs(b,{justify:"space-between",children:[e.jsx(y,{size:"xs",children:a._({id:"4PPMB0"})}),e.jsx(y,{size:"xs",children:A(h)})]}),d>0&&e.jsxs(b,{justify:"space-between",children:[e.jsx(y,{size:"xs",children:a._({id:"zn38D/"})}),e.jsx(y,{size:"xs",children:A(d)})]}),f>0&&e.jsxs(b,{justify:"space-between",children:[e.jsx(y,{size:"xs",children:a._({id:"0lg3zX"})}),e.jsx(y,{size:"xs",children:A(f)})]}),x>0&&e.jsxs(b,{justify:"space-between",children:[e.jsx(y,{size:"xs",children:a._({id:"BE5Q6v"})}),e.jsx(y,{size:"xs",children:A(x)})]}),e.jsxs(b,{justify:"space-between",children:[e.jsx(y,{size:"xs",children:a._({id:"D91mkk"})}),e.jsx(y,{size:"xs",children:A(m)})]})]})})]})},[l.instanceQuery.isFetching,l.instanceQuery.isLoading,l.instanceQuery.isError,l.instance,u])}function Ye({records:t,onRemovePart:i,onSelectQuantity:c,onSelectSupplierPart:u,onSelectPurchaseOrder:l}){const[r,_]=s.useState(null),h=He({supplierId:r?.supplier_part?.supplier}),j=T({url:E(S.purchase_order_list),title:a._({id:"00xEJ9"}),fields:h,successMessage:a._({id:"x3sha9"}),onFormSuccess:n=>{l(r?.part.pk,n)}}),x=we({partId:r?.part.pk}),f=T({url:E(S.supplier_part_list),title:a._({id:"wvbkAd"}),fields:x,successMessage:a._({id:"LjPQ/X"}),onFormSuccess:n=>{u(r?.part.pk,n)}}),o=s.useMemo(()=>({order:{value:r?.purchase_order?.pk,disabled:!0},part:{value:r?.supplier_part?.pk,disabled:!0},reference:{},quantity:{},merge_items:{}}),[r]),d=T({url:E(S.purchase_order_line_list),title:a._({id:"84UAd6"}),fields:o,focus:"quantity",initialData:{order:r?.purchase_order?.pk,part:r?.supplier_part?.pk,quantity:r?.quantity},onFormSuccess:n=>{i(r?.part)},successMessage:a._({id:"WdLHOQ"})}),m=s.useMemo(()=>[{accessor:"left_actions",title:" ",width:"1%",render:n=>e.jsx(b,{gap:"xs",wrap:"nowrap",justify:"left",children:e.jsx(te,{tooltipAlignment:"top-start",onClick:()=>i(n.part)})})},{accessor:"part",title:a._({id:"vgP+9p"}),render:n=>e.jsx(P,{label:n.part?.description,children:e.jsx(je,{p:"xs",children:e.jsx(Ve,{part:n.part})})})},{accessor:"supplier_part",title:a._({id:"nne72x"}),width:"40%",render:n=>e.jsxs(b,{gap:"xs",wrap:"nowrap",justify:"left",children:[e.jsx(X,{children:e.jsx(D,{fieldName:"supplier_part",hideLabels:!0,error:n.errors?.supplier_part,fieldDefinition:{field_type:"related field",api_url:E(S.supplier_part_list),model:M.supplierpart,placeholder:a._({id:"5L5j54"}),required:!0,value:n.supplier_part?.pk,onValueChange:(k,g)=>{u(n.part.pk,g)},filters:{part:n.part.pk,active:!0,part_detail:!0,supplier_detail:!0}}})}),e.jsx(J,{tooltip:a._({id:"vCJjUj"}),tooltipAlignment:"top-end",onClick:()=>{_(n),f.open()}})]})},{accessor:"purchase_order",title:a._({id:"KxySMG"}),width:"40%",render:n=>e.jsxs(b,{gap:"xs",wrap:"nowrap",justify:"left",children:[e.jsx(X,{children:e.jsx(D,{fieldName:"purchase_order",hideLabels:!0,fieldDefinition:{field_type:"related field",api_url:E(S.purchase_order_list),model:M.purchaseorder,placeholder:a._({id:"pfANUH"}),disabled:!n.supplier_part?.supplier,value:n.purchase_order?.pk,filters:{supplier:n.supplier_part?.supplier,outstanding:!0},onValueChange:(k,g)=>{l(n.part.pk,g)}}})}),e.jsx(J,{tooltip:a._({id:"ilPjST"}),tooltipAlignment:"top-end",disabled:!n.supplier_part?.pk,onClick:()=>{_(n),j.open()}})]})},{accessor:"quantity",title:a._({id:"VbWX2u"}),width:150,render:n=>e.jsxs(b,{gap:"xs",wrap:"nowrap",children:[e.jsx(D,{fieldName:"quantity",hideLabels:!0,error:n.errors?.quantity,fieldDefinition:{field_type:"number",required:!0,value:n.quantity,onValueChange:k=>{c(n.part.pk,k)}}}),e.jsx(Xe,{partId:n.part.pk,onQuantityChange:k=>c(n.part.pk,k)})]})},{accessor:"right_actions",title:" ",width:"1%",render:n=>e.jsx(b,{grow:!0,gap:"xs",wrap:"nowrap",justify:"right",children:e.jsx(w,{onClick:()=>{_(n),d.open()},disabled:!n.supplier_part?.pk||!n.quantity||!n.purchase_order?.pk,icon:e.jsx(Te,{}),tooltip:a._({id:"T0PG4M"}),tooltipAlignment:"top-end",color:"blue"})})}],[i]);return t.length===0?e.jsx(Z,{color:"red",title:a._({id:"RHAB56"}),children:a._({id:"J6mnho"})}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{idAccessor:"part.pk",columns:m,records:t}),j.modal,f.modal,d.modal]})}function pt({parts:t}){const[i,c]=s.useState([]),u=s.useCallback(f=>{const o=i.filter(d=>d.part?.pk!==f.pk);c(o),o.length===0&&(x.closeWizard(),he({title:a._({id:"sUQHeO"}),message:a._({id:"s2oix5"}),color:"green"}))},[i]),l=s.useCallback((f,o)=>{const d=[...i];d.forEach((m,n)=>{m.part.pk===f&&(d[n].quantity=o)}),c(d)},[i]),r=s.useCallback((f,o)=>{const d=[...i];d.forEach((m,n)=>{m.part.pk===f&&(d[n].supplier_part=o)}),c(d)},[i]),_=s.useCallback((f,o)=>{const d=[...i];d.forEach((m,n)=>{m.part.pk===f&&(d[n].purchase_order=o)}),c(d)},[i]),h=s.useCallback(f=>e.jsx(Ye,{records:i,onRemovePart:u,onSelectQuantity:l,onSelectSupplierPart:r,onSelectPurchaseOrder:_}),[i]),j=s.useCallback(f=>{if(!i?.length)return x.setError(a._({id:"RHAB56"})),x.setErrorDetail(a._({id:"hqPdIW"})),!1;let o=!0;const d=[...i];return i.forEach((m,n)=>{d[n].errors={supplier_part:m.supplier_part?null:a._({id:"f4INHl"}),quantity:!m.quantity||m.quantity<=0?a._({id:"siOHHM"}):null},Object.values(d[n].errors).some(k=>k)&&(o=!1)}),c(d),o||(x.setError(a._({id:"EG74zf"})),x.setErrorDetail(a._({id:"6FCFII"}))),o},[i]),x=Je({title:a._({id:"3u5ICq"}),steps:[],renderStep:h,canStepForward:j});return s.useEffect(()=>{const f=[];x.opened?(t.filter(o=>o.purchaseable&&o.active).forEach(o=>{if(!f.find(d=>d.part?.pk===o.pk)){const d=(o.minimum_stock??0)+(o.required_for_build_orders??0)+(o.required_for_sales_orders??0),m=o.total_in_stock??0,n=o.ordering??0,k=o.building??0,g=d-m-n-k;f.push({part:o,supplier_part:void 0,purchase_order:void 0,quantity:Math.max(g,0),errors:{}})}}),c(f)):c([])},[x.opened]),x}export{We as I,pt as O,Je as a,ut as b,ct as c,He as u};
//# sourceMappingURL=OrderPartsWizard-CtcPC0ec.js.map
