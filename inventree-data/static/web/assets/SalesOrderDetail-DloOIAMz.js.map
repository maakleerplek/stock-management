{"version":3,"file":"SalesOrderDetail-DloOIAMz.js","sources":["../../../../../../frontend/src/tables/sales/SalesOrderLineItemTable.tsx","../../../../../../frontend/src/pages/sales/SalesOrderDetail.tsx"],"sourcesContent":["import { t } from '@lingui/core/macro';\nimport { Group, Paper, Text } from '@mantine/core';\nimport {\n  IconArrowRight,\n  IconHash,\n  IconShoppingCart,\n  IconSquareArrowRight,\n  IconTools\n} from '@tabler/icons-react';\nimport type { DataTableRowExpansionProps } from 'mantine-datatable';\nimport { type ReactNode, useCallback, useMemo, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\n\nimport { ActionButton } from '@lib/components/ActionButton';\nimport { AddItemButton } from '@lib/components/AddItemButton';\nimport { ProgressBar } from '@lib/components/ProgressBar';\nimport {\n  type RowAction,\n  RowDeleteAction,\n  RowDuplicateAction,\n  RowEditAction,\n  RowViewAction\n} from '@lib/components/RowActions';\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { ModelType } from '@lib/enums/ModelType';\nimport { UserRoles } from '@lib/enums/Roles';\nimport { apiUrl } from '@lib/functions/Api';\nimport type { TableFilter } from '@lib/types/Filters';\nimport type { TableColumn } from '@lib/types/Tables';\nimport { RenderPart } from '../../components/render/Part';\nimport OrderPartsWizard from '../../components/wizards/OrderPartsWizard';\nimport { formatCurrency, formatDecimal } from '../../defaults/formatters';\nimport { useBuildOrderFields } from '../../forms/BuildForms';\nimport {\n  useAllocateToSalesOrderForm,\n  useSalesOrderAllocateSerialsFields,\n  useSalesOrderLineItemFields\n} from '../../forms/SalesOrderForms';\nimport {\n  useCreateApiFormModal,\n  useDeleteApiFormModal,\n  useEditApiFormModal\n} from '../../hooks/UseForm';\nimport { useTable } from '../../hooks/UseTable';\nimport { useUserState } from '../../states/UserState';\nimport {\n  DateColumn,\n  DecimalColumn,\n  DescriptionColumn,\n  LinkColumn,\n  ProjectCodeColumn,\n  RenderPartColumn\n} from '../ColumnRenderers';\nimport { InvenTreeTable } from '../InvenTreeTable';\nimport RowExpansionIcon from '../RowExpansionIcon';\nimport { TableHoverCard } from '../TableHoverCard';\nimport SalesOrderAllocationTable from './SalesOrderAllocationTable';\n\nexport default function SalesOrderLineItemTable({\n  orderId,\n  orderDetailRefresh,\n  currency,\n  customerId,\n  editable\n}: Readonly<{\n  orderId: number;\n  orderDetailRefresh: () => void;\n  currency: string;\n  customerId: number;\n  editable: boolean;\n}>) {\n  const navigate = useNavigate();\n  const user = useUserState();\n  const table = useTable('sales-order-line-item');\n\n  const tableColumns: TableColumn[] = useMemo(() => {\n    return [\n      {\n        accessor: 'part',\n        sortable: true,\n        switchable: false,\n        minWidth: 175,\n        render: (record: any) => {\n          return (\n            <Group wrap='nowrap'>\n              {record.part_detail?.virtual || (\n                <RowExpansionIcon\n                  enabled={record.allocated}\n                  expanded={table.isRowExpanded(record.pk)}\n                />\n              )}\n              <RenderPartColumn part={record.part_detail} />\n            </Group>\n          );\n        }\n      },\n      {\n        accessor: 'part_detail.IPN',\n        title: t`IPN`,\n        switchable: true\n      },\n      DescriptionColumn({\n        accessor: 'part_detail.description'\n      }),\n      {\n        accessor: 'reference',\n        sortable: false,\n        switchable: true\n      },\n      ProjectCodeColumn({}),\n      DecimalColumn({\n        accessor: 'quantity',\n        sortable: true\n      }),\n      {\n        accessor: 'sale_price',\n        render: (record: any) =>\n          formatCurrency(record.sale_price, {\n            currency: record.sale_price_currency\n          })\n      },\n      {\n        accessor: 'total_price',\n        title: t`Total Price`,\n        render: (record: any) =>\n          formatCurrency(record.sale_price, {\n            currency: record.sale_price_currency,\n            multiplier: record.quantity\n          })\n      },\n      DateColumn({\n        accessor: 'target_date',\n        sortable: true,\n        title: t`Target Date`\n      }),\n      {\n        accessor: 'stock',\n        title: t`Available Stock`,\n        render: (record: any) => {\n          if (record.part_detail?.virtual) {\n            return <Text size='sm' fs='italic'>{t`Virtual part`}</Text>;\n          }\n\n          const part_stock = record?.available_stock ?? 0;\n          const variant_stock = record?.available_variant_stock ?? 0;\n          const available = part_stock + variant_stock;\n\n          const required = Math.max(\n            record.quantity - record.allocated - record.shipped,\n            0\n          );\n\n          let color: string | undefined;\n          let text = `${formatDecimal(available)}`;\n\n          const extra: ReactNode[] = [];\n\n          if (available <= 0) {\n            color = 'red';\n            text = t`No stock available`;\n          } else if (available < required) {\n            color = 'orange';\n          }\n\n          if (variant_stock > 0) {\n            extra.push(<Text size='sm'>{t`Includes variant stock`}</Text>);\n          }\n\n          if (record.building > 0) {\n            extra.push(\n              <Text size='sm'>\n                {t`In production`}: {formatDecimal(record.building)}\n              </Text>\n            );\n          }\n\n          if (record.on_order > 0) {\n            extra.push(\n              <Text size='sm'>\n                {t`On order`}: {formatDecimal(record.on_order)}\n              </Text>\n            );\n          }\n\n          return (\n            <TableHoverCard\n              value={<Text c={color}>{text}</Text>}\n              extra={extra}\n              title={t`Stock Information`}\n            />\n          );\n        }\n      },\n      {\n        accessor: 'allocated',\n        sortable: true,\n        render: (record: any) => {\n          if (record.part_detail?.virtual) {\n            return <Text size='sm' fs='italic'>{t`Virtual part`}</Text>;\n          }\n\n          return (\n            <ProgressBar\n              progressLabel={true}\n              value={record.allocated}\n              maximum={record.quantity}\n            />\n          );\n        }\n      },\n      {\n        accessor: 'shipped',\n        sortable: true,\n        render: (record: any) => {\n          if (record.part_detail?.virtual) {\n            return <Text size='sm' fs='italic'>{t`Virtual part`}</Text>;\n          }\n\n          return (\n            <ProgressBar\n              progressLabel={true}\n              value={record.shipped}\n              maximum={record.quantity}\n            />\n          );\n        }\n      },\n      {\n        accessor: 'notes'\n      },\n      LinkColumn({\n        accessor: 'link'\n      })\n    ];\n  }, [table.isRowExpanded]);\n\n  const [selectedLineId, setSelectedLineId] = useState<number>(0);\n\n  const [selectedSupplierPart, setSelectedSupplierPart] = useState<any>(null);\n\n  const [initialData, setInitialData] = useState({});\n\n  const createLineFields = useSalesOrderLineItemFields({\n    orderId: orderId,\n    customerId: customerId,\n    create: true,\n    currency: currency\n  });\n\n  const newLine = useCreateApiFormModal({\n    url: ApiEndpoints.sales_order_line_list,\n    title: t`Add Line Item`,\n    fields: createLineFields,\n    initialData: {\n      ...initialData,\n      sale_price_currency: currency\n    },\n    onFormSuccess: orderDetailRefresh,\n    table: table\n  });\n\n  const editLineFields = useSalesOrderLineItemFields({\n    orderId: orderId,\n    customerId: customerId,\n    create: false\n  });\n\n  const editLine = useEditApiFormModal({\n    url: ApiEndpoints.sales_order_line_list,\n    pk: selectedLineId,\n    title: t`Edit Line Item`,\n    fields: editLineFields,\n    onFormSuccess: orderDetailRefresh,\n    table: table\n  });\n\n  const deleteLine = useDeleteApiFormModal({\n    url: ApiEndpoints.sales_order_line_list,\n    pk: selectedLineId,\n    title: t`Delete Line Item`,\n    onFormSuccess: orderDetailRefresh,\n    table: table\n  });\n\n  const allocateSerialFields = useSalesOrderAllocateSerialsFields({\n    itemId: selectedLineId,\n    orderId: orderId\n  });\n\n  const allocateBySerials = useCreateApiFormModal({\n    url: ApiEndpoints.sales_order_allocate_serials,\n    pk: orderId,\n    title: t`Allocate Serial Numbers`,\n    preFormContent: selectedSupplierPart ? (\n      <Paper withBorder p='sm'>\n        <RenderPart instance={selectedSupplierPart} />\n      </Paper>\n    ) : undefined,\n    initialData: initialData,\n    fields: allocateSerialFields,\n    table: table\n  });\n\n  const buildOrderFields = useBuildOrderFields({\n    create: true,\n    modalId: 'build-order-create-from-sales-order'\n  });\n\n  const newBuildOrder = useCreateApiFormModal({\n    url: ApiEndpoints.build_order_list,\n    title: t`Create Build Order`,\n    modalId: 'build-order-create-from-sales-order',\n    fields: buildOrderFields,\n    initialData: initialData,\n    follow: true,\n    modelType: ModelType.build\n  });\n\n  const [selectedItems, setSelectedItems] = useState<any[]>([]);\n\n  const allocateStock = useAllocateToSalesOrderForm({\n    orderId: orderId,\n    lineItems: selectedItems,\n    onFormSuccess: () => {\n      table.refreshTable();\n      table.clearSelectedRecords();\n    }\n  });\n\n  const [partsToOrder, setPartsToOrder] = useState<any[]>([]);\n\n  const orderPartsWizard = OrderPartsWizard({\n    parts: partsToOrder\n  });\n\n  const tableFilters: TableFilter[] = useMemo(() => {\n    return [\n      {\n        name: 'allocated',\n        label: t`Allocated`,\n        description: t`Show lines which are fully allocated`\n      },\n      {\n        name: 'completed',\n        label: t`Completed`,\n        description: t`Show lines which are completed`\n      }\n    ];\n  }, []);\n\n  const tableActions = useMemo(() => {\n    return [\n      <AddItemButton\n        key='add-line-item'\n        tooltip={t`Add Line Item`}\n        onClick={() => {\n          setInitialData({\n            order: orderId\n          });\n          newLine.open();\n        }}\n        hidden={!editable || !user.hasAddRole(UserRoles.sales_order)}\n      />,\n      <ActionButton\n        key='order-parts'\n        hidden={!user.hasAddRole(UserRoles.purchase_order)}\n        disabled={!table.hasSelectedRecords}\n        tooltip={t`Order Parts`}\n        icon={<IconShoppingCart />}\n        color='blue'\n        onClick={() => {\n          setPartsToOrder(table.selectedRecords.map((r) => r.part_detail));\n          orderPartsWizard.openWizard();\n        }}\n      />,\n      <ActionButton\n        key='allocate-stock'\n        tooltip={t`Allocate Stock`}\n        icon={<IconArrowRight />}\n        disabled={!table.hasSelectedRecords}\n        color='green'\n        onClick={() => {\n          setSelectedItems(\n            table.selectedRecords.filter((r) => r.allocated < r.quantity)\n          );\n          allocateStock.open();\n        }}\n      />\n    ];\n  }, [user, orderId, table.hasSelectedRecords, table.selectedRecords]);\n\n  const rowActions = useCallback(\n    (record: any): RowAction[] => {\n      const allocated = (record?.allocated ?? 0) > (record?.quantity ?? 0);\n      const virtual = record?.part_detail?.virtual ?? false;\n\n      return [\n        RowViewAction({\n          title: t`View Part`,\n          modelType: ModelType.part,\n          modelId: record.part,\n          navigate: navigate,\n          hidden: !user.hasViewRole(UserRoles.part)\n        }),\n        {\n          hidden:\n            allocated ||\n            virtual ||\n            !editable ||\n            !user.hasChangeRole(UserRoles.sales_order),\n          title: t`Allocate Stock`,\n          icon: <IconSquareArrowRight />,\n          color: 'green',\n          onClick: () => {\n            setSelectedItems([record]);\n            allocateStock.open();\n          }\n        },\n        {\n          hidden:\n            !record?.part_detail?.trackable ||\n            allocated ||\n            virtual ||\n            !editable ||\n            !user.hasChangeRole(UserRoles.sales_order),\n          title: t`Allocate serials`,\n          icon: <IconHash />,\n          color: 'green',\n          onClick: () => {\n            setSelectedLineId(record.pk);\n            setSelectedSupplierPart(record?.part_detail ?? null);\n            setInitialData({\n              quantity: record.quantity - record.allocated\n            });\n            allocateBySerials.open();\n          }\n        },\n        {\n          hidden:\n            allocated ||\n            virtual ||\n            !user.hasAddRole(UserRoles.build) ||\n            !record?.part_detail?.assembly,\n          title: t`Build stock`,\n          icon: <IconTools />,\n          color: 'blue',\n          onClick: () => {\n            setInitialData({\n              part: record.part,\n              quantity: (record?.quantity ?? 1) - (record?.allocated ?? 0),\n              sales_order: orderId\n            });\n            newBuildOrder.open();\n          }\n        },\n        {\n          hidden:\n            allocated ||\n            virtual ||\n            !user.hasAddRole(UserRoles.purchase_order) ||\n            !record?.part_detail?.purchaseable,\n          title: t`Order stock`,\n          icon: <IconShoppingCart />,\n          color: 'blue',\n          onClick: () => {\n            setPartsToOrder([record.part_detail]);\n            orderPartsWizard.openWizard();\n          }\n        },\n        RowEditAction({\n          hidden: !editable || !user.hasChangeRole(UserRoles.sales_order),\n          onClick: () => {\n            setSelectedLineId(record.pk);\n            editLine.open();\n          }\n        }),\n        RowDuplicateAction({\n          hidden: !editable || !user.hasAddRole(UserRoles.sales_order),\n          onClick: () => {\n            setInitialData(record);\n            newLine.open();\n          }\n        }),\n        RowDeleteAction({\n          hidden: !editable || !user.hasDeleteRole(UserRoles.sales_order),\n          onClick: () => {\n            setSelectedLineId(record.pk);\n            deleteLine.open();\n          }\n        })\n      ];\n    },\n    [navigate, user, editable]\n  );\n\n  // Control row expansion\n  const rowExpansion: DataTableRowExpansionProps<any> = useMemo(() => {\n    return {\n      allowMultiple: true,\n      expandable: ({ record }: { record: any }) => {\n        if (record?.part_detail?.virtual) {\n          return false;\n        }\n        return table.isRowExpanded(record.pk) || record.allocated > 0;\n      },\n      content: ({ record }: { record: any }) => {\n        return (\n          <SalesOrderAllocationTable\n            showOrderInfo={false}\n            showPartInfo={false}\n            orderId={orderId}\n            lineItemId={record.pk}\n            partId={record.part}\n            allowEdit={true}\n            modelTarget={ModelType.stockitem}\n            modelField={'item'}\n            isSubTable\n          />\n        );\n      }\n    };\n  }, [orderId, table.isRowExpanded]);\n\n  return (\n    <>\n      {editLine.modal}\n      {deleteLine.modal}\n      {newLine.modal}\n      {newBuildOrder.modal}\n      {allocateBySerials.modal}\n      {allocateStock.modal}\n      {orderPartsWizard.wizard}\n      <InvenTreeTable\n        url={apiUrl(ApiEndpoints.sales_order_line_list)}\n        tableState={table}\n        columns={tableColumns}\n        props={{\n          enableSelection: true,\n          enableDownload: true,\n          params: {\n            order: orderId,\n            part_detail: true\n          },\n          rowActions: rowActions,\n          tableActions: tableActions,\n          tableFilters: tableFilters,\n          rowExpansion: rowExpansion\n        }}\n      />\n    </>\n  );\n}\n","import { t } from '@lingui/core/macro';\nimport { Accordion, Grid, Skeleton, Stack, Text } from '@mantine/core';\nimport {\n  IconBookmark,\n  IconCubeSend,\n  IconInfoCircle,\n  IconList,\n  IconTools\n} from '@tabler/icons-react';\nimport { type ReactNode, useMemo } from 'react';\nimport { useParams } from 'react-router-dom';\n\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { ModelType } from '@lib/enums/ModelType';\nimport { UserRoles } from '@lib/enums/Roles';\nimport { apiUrl } from '@lib/functions/Api';\nimport AdminButton from '../../components/buttons/AdminButton';\nimport PrimaryActionButton from '../../components/buttons/PrimaryActionButton';\nimport { PrintingActions } from '../../components/buttons/PrintingActions';\nimport {\n  type DetailsField,\n  DetailsTable\n} from '../../components/details/Details';\nimport { DetailsImage } from '../../components/details/DetailsImage';\nimport { ItemDetailsGrid } from '../../components/details/ItemDetails';\nimport {\n  BarcodeActionDropdown,\n  CancelItemAction,\n  DuplicateItemAction,\n  EditItemAction,\n  HoldItemAction,\n  OptionsActionDropdown\n} from '../../components/items/ActionDropdown';\nimport { StylishText } from '../../components/items/StylishText';\nimport InstanceDetail from '../../components/nav/InstanceDetail';\nimport { PageDetail } from '../../components/nav/PageDetail';\nimport AttachmentPanel from '../../components/panels/AttachmentPanel';\nimport NotesPanel from '../../components/panels/NotesPanel';\nimport type { PanelType } from '../../components/panels/Panel';\nimport { PanelGroup } from '../../components/panels/PanelGroup';\nimport { RenderAddress } from '../../components/render/Company';\nimport { StatusRenderer } from '../../components/render/StatusRenderer';\nimport { formatCurrency } from '../../defaults/formatters';\nimport { useSalesOrderFields } from '../../forms/SalesOrderForms';\nimport {\n  useCreateApiFormModal,\n  useEditApiFormModal\n} from '../../hooks/UseForm';\nimport { useInstance } from '../../hooks/UseInstance';\nimport useStatusCodes from '../../hooks/UseStatusCodes';\nimport { useGlobalSettingsState } from '../../states/SettingsStates';\nimport { useUserState } from '../../states/UserState';\nimport { BuildOrderTable } from '../../tables/build/BuildOrderTable';\nimport ExtraLineItemTable from '../../tables/general/ExtraLineItemTable';\nimport SalesOrderAllocationTable from '../../tables/sales/SalesOrderAllocationTable';\nimport SalesOrderLineItemTable from '../../tables/sales/SalesOrderLineItemTable';\nimport SalesOrderShipmentTable from '../../tables/sales/SalesOrderShipmentTable';\n\n/**\n * Detail page for a single SalesOrder\n */\nexport default function SalesOrderDetail() {\n  const { id } = useParams();\n\n  const user = useUserState();\n\n  const globalSettings = useGlobalSettingsState();\n\n  const {\n    instance: order,\n    instanceQuery,\n    refreshInstance\n  } = useInstance({\n    endpoint: ApiEndpoints.sales_order_list,\n    pk: id,\n    params: {\n      customer_detail: true\n    }\n  });\n\n  const orderCurrency = useMemo(() => {\n    return (\n      order.order_currency ||\n      order.customer_detail?.currency ||\n      globalSettings.getSetting('INVENTREE_DEFAULT_CURRENCY')\n    );\n  }, [order, globalSettings]);\n\n  const detailsPanel = useMemo(() => {\n    if (instanceQuery.isFetching) {\n      return <Skeleton />;\n    }\n\n    const tl: DetailsField[] = [\n      {\n        type: 'text',\n        name: 'reference',\n        label: t`Reference`,\n        copy: true\n      },\n      {\n        type: 'text',\n        name: 'customer_reference',\n        label: t`Customer Reference`,\n        copy: true,\n        icon: 'reference',\n        hidden: !order.customer_reference\n      },\n      {\n        type: 'link',\n        name: 'customer',\n        icon: 'customers',\n        label: t`Customer`,\n        model: ModelType.company\n      },\n      {\n        type: 'text',\n        name: 'description',\n        label: t`Description`,\n        copy: true\n      },\n      {\n        type: 'status',\n        name: 'status',\n        label: t`Status`,\n        model: ModelType.salesorder\n      },\n      {\n        type: 'status',\n        name: 'status_custom_key',\n        label: t`Custom Status`,\n        model: ModelType.salesorder,\n        icon: 'status',\n        hidden:\n          !order.status_custom_key || order.status_custom_key == order.status\n      }\n    ];\n\n    const tr: DetailsField[] = [\n      {\n        type: 'progressbar',\n        name: 'completed',\n        icon: 'progress',\n        label: t`Completed Line Items`,\n        total: order.line_items,\n        progress: order.completed_lines,\n        hidden: !order.line_items\n      },\n      {\n        type: 'progressbar',\n        name: 'shipments',\n        icon: 'shipment',\n        label: t`Completed Shipments`,\n        total: order.shipments_count,\n        progress: order.completed_shipments_count,\n        hidden: !order.shipments_count\n      },\n      {\n        type: 'text',\n        name: 'currency',\n        label: t`Order Currency`,\n        value_formatter: () => orderCurrency\n      },\n      {\n        type: 'text',\n        name: 'total_price',\n        label: t`Total Cost`,\n        value_formatter: () => {\n          return formatCurrency(order?.total_price, {\n            currency: orderCurrency\n          });\n        }\n      }\n    ];\n\n    const bl: DetailsField[] = [\n      {\n        type: 'link',\n        external: true,\n        name: 'link',\n        label: t`Link`,\n        copy: true,\n        hidden: !order.link\n      },\n      {\n        type: 'text',\n        name: 'address',\n        label: t`Shipping Address`,\n        icon: 'address',\n        value_formatter: () =>\n          order.address_detail ? (\n            <RenderAddress instance={order.address_detail} />\n          ) : (\n            <Text size='sm' c='red'>{t`Not specified`}</Text>\n          )\n      },\n      {\n        type: 'text',\n        name: 'contact_detail.name',\n        label: t`Contact`,\n        icon: 'user',\n        copy: true,\n        hidden: !order.contact\n      },\n      {\n        type: 'text',\n        name: 'contact_detail.email',\n        label: t`Contact Email`,\n        icon: 'email',\n        copy: true,\n        hidden: !order.contact_detail?.email\n      },\n      {\n        type: 'text',\n        name: 'contact_detail.phone',\n        label: t`Contact Phone`,\n        icon: 'phone',\n        copy: true,\n        hidden: !order.contact_detail?.phone\n      },\n      {\n        type: 'text',\n        name: 'project_code_label',\n        label: t`Project Code`,\n        icon: 'reference',\n        copy: true,\n        hidden: !order.project_code\n      },\n      {\n        type: 'text',\n        name: 'responsible',\n        label: t`Responsible`,\n        badge: 'owner',\n        hidden: !order.responsible\n      }\n    ];\n\n    const br: DetailsField[] = [\n      {\n        type: 'date',\n        name: 'creation_date',\n        label: t`Creation Date`,\n        copy: true,\n        hidden: !order.creation_date\n      },\n      {\n        type: 'date',\n        name: 'issue_date',\n        label: t`Issue Date`,\n        icon: 'calendar',\n        copy: true,\n        hidden: !order.issue_date\n      },\n      {\n        type: 'date',\n        name: 'start_date',\n        label: t`Start Date`,\n        icon: 'calendar',\n        hidden: !order.start_date,\n        copy: true\n      },\n      {\n        type: 'date',\n        name: 'target_date',\n        label: t`Target Date`,\n        hidden: !order.target_date,\n        copy: true\n      },\n      {\n        type: 'date',\n        name: 'shipment_date',\n        label: t`Completion Date`,\n        hidden: !order.shipment_date,\n        copy: true\n      }\n    ];\n\n    return (\n      <ItemDetailsGrid>\n        <Grid grow>\n          <DetailsImage\n            appRole={UserRoles.purchase_order}\n            apiPath={ApiEndpoints.company_list}\n            src={order.customer_detail?.image}\n            pk={order.customer}\n          />\n          <Grid.Col span={{ base: 12, sm: 8 }}>\n            <DetailsTable fields={tl} item={order} />\n          </Grid.Col>\n        </Grid>\n        <DetailsTable fields={tr} item={order} />\n        <DetailsTable fields={bl} item={order} />\n        <DetailsTable fields={br} item={order} />\n      </ItemDetailsGrid>\n    );\n  }, [order, orderCurrency, instanceQuery]);\n\n  const soStatus = useStatusCodes({ modelType: ModelType.salesorder });\n\n  const lineItemsEditable: boolean = useMemo(() => {\n    const orderOpen: boolean =\n      order.status != soStatus.COMPLETE && order.status != soStatus.CANCELLED;\n\n    if (orderOpen) {\n      return true;\n    } else {\n      return globalSettings.isSet('SALESORDER_EDIT_COMPLETED_ORDERS');\n    }\n  }, [globalSettings, order.status, soStatus]);\n\n  const salesOrderFields = useSalesOrderFields({});\n\n  const editSalesOrder = useEditApiFormModal({\n    url: ApiEndpoints.sales_order_list,\n    pk: order.pk,\n    title: t`Edit Sales Order`,\n    fields: salesOrderFields,\n    onFormSuccess: () => {\n      refreshInstance();\n    }\n  });\n\n  const duplicateOrderFields = useSalesOrderFields({\n    duplicateOrderId: order.pk\n  });\n\n  const duplicateSalesOrderInitialData = useMemo(() => {\n    const data = { ...order };\n    // if we set the reference to null/undefined, it will be left blank in the form\n    // if we omit the reference altogether, it will be auto-generated via reference pattern\n    // from the OPTIONS response\n    delete data.reference;\n    return data;\n  }, [order]);\n\n  const duplicateSalesOrder = useCreateApiFormModal({\n    url: ApiEndpoints.sales_order_list,\n    title: t`Add Sales Order`,\n    fields: duplicateOrderFields,\n    initialData: duplicateSalesOrderInitialData,\n    follow: true,\n    modelType: ModelType.salesorder\n  });\n\n  const orderPanels: PanelType[] = useMemo(() => {\n    return [\n      {\n        name: 'detail',\n        label: t`Order Details`,\n        icon: <IconInfoCircle />,\n        content: detailsPanel\n      },\n      {\n        name: 'line-items',\n        label: t`Line Items`,\n        icon: <IconList />,\n        content: (\n          <Accordion\n            multiple={true}\n            defaultValue={['line-items', 'extra-items']}\n          >\n            <Accordion.Item value='line-items' key='lineitems'>\n              <Accordion.Control>\n                <StylishText size='lg'>{t`Line Items`}</StylishText>\n              </Accordion.Control>\n              <Accordion.Panel>\n                <SalesOrderLineItemTable\n                  orderId={order.pk}\n                  orderDetailRefresh={refreshInstance}\n                  currency={orderCurrency}\n                  customerId={order.customer}\n                  editable={lineItemsEditable}\n                />\n              </Accordion.Panel>\n            </Accordion.Item>\n            <Accordion.Item value='extra-items' key='extraitems'>\n              <Accordion.Control>\n                <StylishText size='lg'>{t`Extra Line Items`}</StylishText>\n              </Accordion.Control>\n              <Accordion.Panel>\n                <ExtraLineItemTable\n                  endpoint={ApiEndpoints.sales_order_extra_line_list}\n                  orderId={order.pk}\n                  editable={lineItemsEditable}\n                  orderDetailRefresh={refreshInstance}\n                  currency={orderCurrency}\n                  role={UserRoles.sales_order}\n                />\n              </Accordion.Panel>\n            </Accordion.Item>\n          </Accordion>\n        )\n      },\n      {\n        name: 'shipments',\n        label: t`Shipments`,\n        icon: <IconCubeSend />,\n        content: (\n          <SalesOrderShipmentTable\n            orderId={order.pk}\n            customerId={order.customer}\n          />\n        )\n      },\n      {\n        name: 'allocations',\n        label: t`Allocated Stock`,\n        icon: <IconBookmark />,\n        content: (\n          <SalesOrderAllocationTable\n            orderId={order.pk}\n            showPartInfo\n            allowEdit\n            modelField='item'\n            modelTarget={ModelType.stockitem}\n          />\n        )\n      },\n      {\n        name: 'build-orders',\n        label: t`Build Orders`,\n        icon: <IconTools />,\n        hidden: !user.hasViewRole(UserRoles.build),\n        content: order?.pk ? (\n          <BuildOrderTable salesOrderId={order.pk} />\n        ) : (\n          <Skeleton />\n        )\n      },\n      AttachmentPanel({\n        model_type: ModelType.salesorder,\n        model_id: order.pk\n      }),\n      NotesPanel({\n        model_type: ModelType.salesorder,\n        model_id: order.pk\n      })\n    ];\n  }, [order, id, user, soStatus, user]);\n\n  const issueOrder = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.sales_order_issue, order.pk),\n    title: t`Issue Sales Order`,\n    onFormSuccess: refreshInstance,\n    preFormWarning: t`Issue this order`,\n    successMessage: t`Order issued`\n  });\n\n  const cancelOrder = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.sales_order_cancel, order.pk),\n    title: t`Cancel Sales Order`,\n    onFormSuccess: refreshInstance,\n    preFormWarning: t`Cancel this order`,\n    successMessage: t`Order cancelled`\n  });\n\n  const holdOrder = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.sales_order_hold, order.pk),\n    title: t`Hold Sales Order`,\n    onFormSuccess: refreshInstance,\n    preFormWarning: t`Place this order on hold`,\n    successMessage: t`Order placed on hold`\n  });\n\n  const shipOrder = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.sales_order_complete, order.pk),\n    title: t`Ship Sales Order`,\n    onFormSuccess: refreshInstance,\n    preFormWarning: t`Ship this order?`,\n    successMessage: t`Order shipped`,\n    fields: {\n      accept_incomplete: {}\n    }\n  });\n\n  const completeOrder = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.sales_order_complete, order.pk),\n    title: t`Complete Sales Order`,\n    onFormSuccess: refreshInstance,\n    preFormWarning: t`Mark this order as complete`,\n    successMessage: t`Order completed`,\n    fields: {\n      accept_incomplete: {}\n    }\n  });\n\n  const soActions = useMemo(() => {\n    const canEdit: boolean = user.hasChangeRole(UserRoles.sales_order);\n\n    const canIssue: boolean =\n      canEdit &&\n      (order.status == soStatus.PENDING || order.status == soStatus.ON_HOLD);\n\n    const canCancel: boolean =\n      canEdit &&\n      (order.status == soStatus.PENDING ||\n        order.status == soStatus.ON_HOLD ||\n        order.status == soStatus.IN_PROGRESS);\n\n    const canHold: boolean =\n      canEdit &&\n      (order.status == soStatus.PENDING ||\n        order.status == soStatus.IN_PROGRESS);\n\n    const autoComplete = globalSettings.isSet('SALESORDER_SHIP_COMPLETE');\n\n    const canShip: boolean =\n      !autoComplete && canEdit && order.status == soStatus.IN_PROGRESS;\n    const canComplete: boolean =\n      canEdit &&\n      (order.status == soStatus.SHIPPED ||\n        (autoComplete && order.status == soStatus.IN_PROGRESS));\n\n    return [\n      <PrimaryActionButton\n        title={t`Issue Order`}\n        icon='issue'\n        hidden={!canIssue}\n        color='blue'\n        onClick={issueOrder.open}\n      />,\n      <PrimaryActionButton\n        title={t`Ship Order`}\n        icon='deliver'\n        hidden={!canShip}\n        color='blue'\n        onClick={shipOrder.open}\n      />,\n      <PrimaryActionButton\n        title={t`Complete Order`}\n        icon='complete'\n        hidden={!canComplete}\n        color='green'\n        onClick={completeOrder.open}\n      />,\n      <AdminButton model={ModelType.salesorder} id={order.pk} />,\n      <BarcodeActionDropdown\n        model={ModelType.salesorder}\n        pk={order.pk}\n        hash={order?.barcode_hash}\n      />,\n      <PrintingActions\n        modelType={ModelType.salesorder}\n        items={[order.pk]}\n        enableReports\n        enableLabels\n      />,\n      <OptionsActionDropdown\n        tooltip={t`Order Actions`}\n        actions={[\n          EditItemAction({\n            hidden: !canEdit,\n            onClick: editSalesOrder.open,\n            tooltip: t`Edit order`\n          }),\n          DuplicateItemAction({\n            hidden: !user.hasAddRole(UserRoles.sales_order),\n            onClick: duplicateSalesOrder.open,\n            tooltip: t`Duplicate order`\n          }),\n          HoldItemAction({\n            tooltip: t`Hold order`,\n            hidden: !canHold,\n            onClick: holdOrder.open\n          }),\n          CancelItemAction({\n            tooltip: t`Cancel order`,\n            hidden: !canCancel,\n            onClick: cancelOrder.open\n          })\n        ]}\n      />\n    ];\n  }, [user, order, soStatus, globalSettings]);\n\n  const orderBadges: ReactNode[] = useMemo(() => {\n    return instanceQuery.isLoading\n      ? []\n      : [\n          <StatusRenderer\n            status={order.status_custom_key}\n            type={ModelType.salesorder}\n            options={{ size: 'lg' }}\n            key={order.pk}\n          />\n        ];\n  }, [order, instanceQuery]);\n\n  const subtitle: string = useMemo(() => {\n    let t = order.customer_detail?.name || '';\n\n    if (order.customer_reference) {\n      t += ` (${order.customer_reference})`;\n    }\n\n    return t;\n  }, [order]);\n\n  return (\n    <>\n      {issueOrder.modal}\n      {cancelOrder.modal}\n      {holdOrder.modal}\n      {shipOrder.modal}\n      {completeOrder.modal}\n      {editSalesOrder.modal}\n      {duplicateSalesOrder.modal}\n      <InstanceDetail\n        query={instanceQuery}\n        requiredRole={UserRoles.sales_order}\n      >\n        <Stack gap='xs'>\n          <PageDetail\n            title={`${t`Sales Order`}: ${order.reference}`}\n            subtitle={subtitle}\n            imageUrl={order.customer_detail?.image}\n            badges={orderBadges}\n            actions={soActions}\n            breadcrumbs={[{ name: t`Sales`, url: '/sales/' }]}\n            lastCrumb={[\n              { name: order.reference, url: `/sales/sales-order/${order.pk}` }\n            ]}\n            editAction={editSalesOrder.open}\n            editEnabled={user.hasChangePermission(ModelType.salesorder)}\n          />\n          <PanelGroup\n            pageKey='salesorder'\n            panels={orderPanels}\n            model={ModelType.salesorder}\n            reloadInstance={refreshInstance}\n            instance={order}\n            id={order.pk}\n          />\n        </Stack>\n      </InstanceDetail>\n    </>\n  );\n}\n"],"names":["SalesOrderLineItemTable","orderId","orderDetailRefresh","currency","customerId","editable","navigate","useNavigate","user","useUserState","table","useTable","tableColumns","useMemo","accessor","sortable","switchable","minWidth","render","record","jsxs","Group","part_detail","virtual","jsx","RowExpansionIcon","allocated","isRowExpanded","pk","RenderPartColumn","title","_i18n","_","id","DescriptionColumn","ProjectCodeColumn","DecimalColumn","formatCurrency","sale_price","sale_price_currency","multiplier","quantity","DateColumn","Text","part_stock","available_stock","variant_stock","available_variant_stock","available","required","Math","max","shipped","color","text","formatDecimal","extra","push","building","on_order","TableHoverCard","ProgressBar","LinkColumn","selectedLineId","setSelectedLineId","useState","selectedSupplierPart","setSelectedSupplierPart","initialData","setInitialData","createLineFields","useSalesOrderLineItemFields","create","newLine","useCreateApiFormModal","url","ApiEndpoints","sales_order_line_list","fields","onFormSuccess","editLineFields","editLine","useEditApiFormModal","deleteLine","useDeleteApiFormModal","allocateSerialFields","useSalesOrderAllocateSerialsFields","itemId","allocateBySerials","sales_order_allocate_serials","preFormContent","Paper","RenderPart","undefined","buildOrderFields","useBuildOrderFields","modalId","newBuildOrder","build_order_list","follow","modelType","ModelType","build","selectedItems","setSelectedItems","allocateStock","useAllocateToSalesOrderForm","lineItems","refreshTable","clearSelectedRecords","partsToOrder","setPartsToOrder","orderPartsWizard","OrderPartsWizard","parts","tableFilters","name","label","description","tableActions","AddItemButton","order","open","hasAddRole","UserRoles","sales_order","ActionButton","purchase_order","hasSelectedRecords","IconShoppingCart","selectedRecords","map","r","openWizard","IconArrowRight","filter","rowActions","useCallback","RowViewAction","part","modelId","hidden","hasViewRole","hasChangeRole","icon","IconSquareArrowRight","onClick","trackable","IconHash","assembly","IconTools","purchaseable","RowEditAction","RowDuplicateAction","RowDeleteAction","hasDeleteRole","rowExpansion","allowMultiple","expandable","content","SalesOrderAllocationTable","stockitem","Fragment","modal","wizard","InvenTreeTable","apiUrl","enableSelection","enableDownload","params","SalesOrderDetail","useParams","globalSettings","useGlobalSettingsState","instance","instanceQuery","refreshInstance","useInstance","endpoint","sales_order_list","customer_detail","orderCurrency","order_currency","getSetting","detailsPanel","isFetching","Skeleton","tl","type","copy","customer_reference","model","company","salesorder","status_custom_key","status","tr","total","line_items","progress","completed_lines","shipments_count","completed_shipments_count","value_formatter","total_price","bl","external","link","address_detail","RenderAddress","contact","contact_detail","email","phone","project_code","badge","responsible","br","creation_date","issue_date","start_date","target_date","shipment_date","ItemDetailsGrid","Grid","DetailsImage","company_list","image","customer","base","sm","DetailsTable","soStatus","useStatusCodes","lineItemsEditable","COMPLETE","CANCELLED","isSet","salesOrderFields","useSalesOrderFields","editSalesOrder","duplicateOrderFields","duplicateOrderId","duplicateSalesOrderInitialData","data","reference","duplicateSalesOrder","orderPanels","IconInfoCircle","IconList","Accordion","StylishText","ExtraLineItemTable","sales_order_extra_line_list","IconCubeSend","SalesOrderShipmentTable","IconBookmark","BuildOrderTable","AttachmentPanel","model_type","model_id","NotesPanel","issueOrder","sales_order_issue","preFormWarning","successMessage","cancelOrder","sales_order_cancel","holdOrder","sales_order_hold","shipOrder","sales_order_complete","accept_incomplete","completeOrder","soActions","canEdit","canIssue","PENDING","ON_HOLD","canCancel","IN_PROGRESS","canHold","autoComplete","canShip","canComplete","SHIPPED","PrimaryActionButton","AdminButton","BarcodeActionDropdown","barcode_hash","PrintingActions","OptionsActionDropdown","EditItemAction","tooltip","DuplicateItemAction","HoldItemAction","CancelItemAction","orderBadges","isLoading","StatusRenderer","size","subtitle","t","InstanceDetail","Stack","PageDetail","hasChangePermission","PanelGroup"],"mappings":"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"}