import{r as c,j as e,$ as D,S as F,ak as f,N as m,d as l,aD as g,b9 as E,g as I,b5 as v,A as b,ab as u,az as N,am as y,bP as w,ca as P,bc as z,ao as _,an as A,b8 as $,ag as M,C as U,b as Y,be as G}from"./index-DjOBj_Ai.js";import{S as W,z as p,ag as H,a as K,A as V}from"./ThemeContext-BjJu0IKI.js";import{t as R,P as O}from"./index-_kfXKtfq.js";import{Y as X}from"./YesNoButton-CYsvXLSb.js";import{u as C}from"./DesktopAppView-D6tHFi_e.js";import{f as q}from"./formatters-Dkpc25sQ.js";import{g as Q}from"./ModelType-BxY4rynO.js";import{q as J,g as Z}from"./Filter-CpWhllKn.js";import{E as S}from"./GenericErrorPage-BWQWzpn2.js";import ee from"./NotFound-BksZ8Fp_.js";import{P as k}from"./PermissionDenied-CPiNkqvu.js";function se(s,t){function i(r){switch(t){case"owner":return[`${r.label}: ${r.name}`,r.name,g(r.owner_model,r.pk,!0),void 0,void 0];case"user":return[`${r.first_name} ${r.last_name}`,r.username,g(z.user,r.pk,!0),r?.image,e.jsxs(e.Fragment,{children:[r.is_superuser&&e.jsx(y,{color:"red",children:u._({id:"agYOFs"})}),r.is_staff&&e.jsx(y,{color:"blue",children:u._({id:"uXsB4R"})}),r.email&&u._({id:"3WlEIN"})+r.email]})];case"group":return[r.name,r.name,g(z.group,r.pk,!0),r?.image,void 0];default:return"dd"}}const a=i(s);return e.jsxs(w.Dropdown,{children:[e.jsxs(m,{children:[e.jsx(P,{src:a[3],radius:"xl"}),e.jsxs(F,{gap:5,children:[e.jsx(l,{size:"sm",fw:700,style:{lineHeight:1},children:a[0]}),e.jsx(b,{href:a[2],c:"dimmed",size:"xs",style:{lineHeight:1},children:a[1]})]})]}),e.jsx(l,{size:"sm",mt:"md",children:a[4]})]})}function B({pk:s,type:t}){const i=C(),{data:a}=V({queryKey:["badge",t,s],queryFn:async()=>{let d="";switch(t){case"owner":d=_.owner_list;break;case"user":d=_.user_list;break;case"group":d=_.group_list;break;default:return{}}const n=A(d,s);return i.get(n).then(h=>{switch(h.status){case 200:return h.data;default:return{}}})}}),r=N(),o=c.useMemo(()=>a?se(a,t):e.jsx(v,{height:12,radius:"md"}),[a]);if(!a||a.isLoading||a.isFetching)return e.jsx(v,{height:12,radius:"md"});function x(){return!a||!a.pk?"":t==="user"&&r.isSet("DISPLAY_FULL_NAMES")?a.first_name||a.last_name?`${a.first_name} ${a.last_name}`:a.username:t==="user"?a.username:a.name}return e.jsxs(m,{wrap:"nowrap",gap:"sm",justify:"right",children:[e.jsx(y,{color:"dark",variant:"filled",style:{display:"flex",alignItems:"center"},children:e.jsxs(w,{width:320,shadow:"md",withArrow:!0,openDelay:200,closeDelay:400,children:[e.jsx(w.Target,{children:e.jsx("p",{children:a?.name??x()})}),o]})}),e.jsx(p,{icon:t==="user"?t:a.label})]})}function ae(s){return e.jsx(l,{size:"sm",children:q(s.field_value?.toString())})}function re(s){const t=s?.field_value,i=Number.parseFloat(t.toString());return t==null?e.jsx(l,{size:"sm",children:"'---'"}):e.jsxs(m,{wrap:"nowrap",gap:"xs",justify:"left",children:[e.jsx(l,{size:"sm",children:J(i)}),!!s.field_data?.unit&&e.jsxs(l,{size:"xs",children:["[",s.field_data?.unit,"]"]})]})}function te(s){const t=s?.field_value;let i=null;return s.field_data?.badge?e.jsx(B,{pk:t,type:s.field_data.badge}):(s?.field_data?.value_formatter?i=s.field_data.value_formatter():t==null?i=e.jsx(l,{size:"sm",children:"'---'"}):i=e.jsx(l,{size:"sm",children:t.toString()}),e.jsxs(m,{wrap:"nowrap",gap:"xs",justify:"space-apart",children:[e.jsxs(m,{wrap:"nowrap",gap:"xs",justify:"left",children:[i,s.field_data.unit&&e.jsx(l,{size:"xs",children:s.unit})]}),s.field_data.user&&e.jsx(B,{pk:s.field_data?.user,type:"user"})]}))}function ie(s){return e.jsx(X,{value:s.field_value})}function ne(s){const t=C(),i=K(),{data:a}=V({queryKey:["detail",s.field_data.model,s.field_value],queryFn:async()=>{if(!s.field_data?.model)return{};const j=Q(s.field_data.model);if(!j?.api_endpoint)return{};const L=A(j.api_endpoint,s.field_value);return t.get(L,{params:s.field_data.model_filters??void 0}).then(T=>{switch(T.status){case 200:return T.data;default:return{}}})}}),r=c.useMemo(()=>s?.field_data?.model&&g(s.field_data.model,s.field_value),[s.field_data.model,s.field_value]),o=c.useCallback(j=>{E(r,i,j)},[r]),x=c.useMemo(()=>`/${I()}${r}`,[r]);if(!a||a.isLoading||a.isFetching)return e.jsx(v,{height:12,radius:"md"});if(s.field_data.external)return e.jsx(b,{href:`${s.field_value}`,target:"_blank",rel:"noreferrer noopener",children:e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"3px"},children:[e.jsx(l,{children:s.field_value}),e.jsx(p,{icon:"external",iconProps:{size:15}})]})});let d=s.field_data?.link??!0,n;s.field_data.model_formatter?n=s.field_data.model_formatter(a)??n:s.field_data.model_field?n=a?.[s.field_data.model_field]??n:n=a?.name;let h;return n===void 0&&(n=a?.name??s.field_data?.backup_value??u._({id:"ATGKLv"}),d=!1,h="red"),e.jsx(e.Fragment,{children:d?e.jsx(b,{href:x,onClick:o,children:e.jsx(l,{children:n})}):e.jsx(l,{c:h,children:n})})}function le(s){return s.field_data.total<=0?e.jsx(l,{size:"sm",children:s.field_data.progress}):e.jsx(O,{size:"lg",value:s.field_data.progress,maximum:s.field_data.total,progressLabel:!0})}function de(s){return e.jsx(Z,{type:s.field_data.model,status:s.field_value})}function ue({value:s}){return e.jsx(H,{value:s})}function oe({item:s,field:t}){function i(o){switch(o){case"boolean":return ie;case"link":return ne;case"progressbar":return le;case"status":return de;case"date":return ae;case"number":return re;case"text":case"string":default:return te}}const a=i(t.type),r=c.useMemo(()=>R(s,t.name),[s,t.name]);return e.jsxs(f.Tr,{style:{verticalAlign:"top"},children:[e.jsx(f.Td,{style:{minWidth:75,lineBreak:"auto",flex:2},children:e.jsxs(m,{gap:"xs",wrap:"nowrap",children:[e.jsx(p,{icon:t.icon??t.name}),e.jsx(l,{style:{paddingLeft:10},children:t.label})]})}),e.jsx(f.Td,{style:{lineBreak:"anywhere",minWidth:100,flex:10,display:"inline-block"},children:e.jsx(a,{field_data:t,field_value:r})}),e.jsx(f.Td,{style:{width:"50"},children:t.copy&&e.jsx(ue,{value:r})})]})}function Se({item:s,fields:t,title:i}){const a=c.useMemo(()=>t.filter(r=>!r.hidden),[t]);return a?.length?e.jsx(D,{p:"xs",withBorder:!0,style:{overflowX:"hidden",width:"100%",minWidth:200},children:e.jsxs(F,{gap:"xs",children:[i&&e.jsx(W,{size:"lg",children:i}),e.jsx(f,{striped:!0,verticalSpacing:5,horizontalSpacing:"sm",children:e.jsx(f.Tbody,{children:a.map((r,o)=>e.jsx(oe,{field:r,item:s},o))})})]})}):e.jsx("div",{})}function Te(s){return e.jsx(D,{p:"xs",children:e.jsx($,{cols:{base:1,"900px":2},type:"container",spacing:"xs",verticalSpacing:"xs",children:s.children})})}function ce(){return e.jsx(S,{title:u._({id:"vYV5VB"}),message:u._({id:"5a3xiK"})})}function fe({status:s}){switch(s){case 401:return e.jsx(ce,{});case 403:return e.jsx(k,{});case 404:return e.jsx(ee,{})}return e.jsx(S,{title:u._({id:"AOPUbq"}),message:u._({id:"yuzYd9"}),status:s})}function me({status:s}){return e.jsx(S,{title:u._({id:"iSWuCp"}),message:u._({id:"vB3crB"}),status:s})}function ze({query:s,children:t,requiredRole:i,requiredPermission:a}){const r=M(),[o,x]=c.useState(!1);if(c.useEffect(()=>{s.isSuccess&&x(!0)},[s.isSuccess]),s.isError){const d=s.failureReason,n=d?.response?.status??d?.status??0;return n>=500?e.jsx(me,{status:n}):e.jsx(fe,{status:n})}return i&&!r.hasViewRole(i)?e.jsx(k,{}):a&&!r.hasViewPermission(a)?e.jsx(k,{}):!o||!r.isLoggedIn()?e.jsx(U,{children:e.jsx(Y,{children:e.jsx(G,{})})}):e.jsx(e.Fragment,{children:t})}export{Se as D,Te as I,ze as a};
//# sourceMappingURL=InstanceDetail-DPGTPy9_.js.map
