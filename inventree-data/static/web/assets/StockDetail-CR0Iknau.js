import{K as Pe,ag as Z,ab as t,an as A,ao as p,r as o,bc as l,j as s,aO as b,b5 as N,az as xe,N as R,d as W,aa as Y,am as oe,av as ne,a7 as qe,ak as B,al as ze,O as re,aD as q,c8 as de,as as C,S as Ee,bV as Be}from"./index-DjOBj_Ai.js";import{aa as Ne,A as fe,y as ye,aH as Ue,a as ge,a1 as Ke,E as Le,aL as Oe,S as ce,ar as Ve,aK as We,z as ue,p as Ye,k as Ge}from"./ThemeContext-BjJu0IKI.js";import{A as Qe}from"./ActionButton-D4nRdKaB.js";import{A as He}from"./AdminButton-B8c0S9L9.js";import{u as ee,I as te,R as Xe,a as Je,e as $e,B as Ze,P as et,A as tt,O as st,b as at,E as it,D as lt}from"./InvenTreeTable-C-s5lvnS.js";import{I as ot,D as V,a as nt}from"./InstanceDetail-DPGTPy9_.js";import{D as w}from"./DetailsBadge-BUJWq3FE.js";import{D as rt,A as dt,N as ct}from"./NotesPanel-Gq5AAnCV.js";import{N as ut}from"./NavigationTree-DO_Tzr1I.js";import{P as mt}from"./PageDetail-1HLwiKVO.js";import{P as pt}from"./PanelGroup-_Eigw1UV.js";import{L as _t}from"./LocateItemButton-96nC8STB.js";import{c as U,q as G,m as je,j as ve,e as Se,ag as me,g as Ae,aa as kt,f as bt,aj as ht,ak as xt,al as ft,am as yt,an as gt,ac as jt,ae as vt}from"./Filter-CpWhllKn.js";import{I as St,O as At}from"./OrderPartsWizard-CtcPC0ec.js";import{u as Ie}from"./DesktopAppView-D6tHFi_e.js";import{f as pe,a as _e}from"./formatters-Dkpc25sQ.js";import{r as It,t as wt,q as ke,p as Tt,a as be,v as Mt}from"./PluginUIFeature-DWPwHUQS.js";import{u as he}from"./UseInstance-BYH4ds5B.js";import{u as Ct}from"./UseStockAdjustActions-B7uQUwuU.js";import{B as Rt}from"./BuildAllocatedStockTable-DiOHvKTH.js";import{S as Dt}from"./SalesOrderAllocationTable-CViFzEk8.js";import{P as Ft,S as Pt,D as we,N as qt,k as Te,U as zt}from"./ColumnRenderers-BCeqgJNS.js";import{S as Et}from"./StockItemTable-D_Czm6nE.js";import{W as Bt}from"./index-_kfXKtfq.js";import{P as Nt}from"./YesNoButton-CYsvXLSb.js";import{A as Ut}from"./AttachmentLink-EwW6behJ.js";import{R as Kt}from"./RowExpansionIcon-CUnOv-Ch.js";import{b as Lt}from"./IconChevronDown-I6OOyduR.js";import{I as Ot}from"./IconBookmark-DTqUQJe4.js";import{I as Vt}from"./IconChecklist-DvRIMPyQ.js";import"./QRCode-BL-P7mX-.js";import"./browser-JUP5PmmS.js";import"./IconDotsVertical-CGvw5eIR.js";import"./IconTags-Bukq1non.js";import"./ModelType-BxY4rynO.js";import"./GenericErrorPage-BWQWzpn2.js";import"./NotFound-BksZ8Fp_.js";import"./PermissionDenied-CPiNkqvu.js";import"./use-hover-CbuFBCOT.js";import"./index-Chjiymov.js";import"./IconChevronRight-BBTCuiZt.js";import"./PageTitle-CaObz4lR.js";import"./RemoteComponent-CrOPmrx3.js";import"./UsePlugins-eh-Mb5PQ.js";import"./CompanyForms-BrBn0vUb.js";import"./IconAt-B6wo_srX.js";import"./IconUsers-DgSduCbv.js";import"./IconAddressBook-0_3zwfXJ.js";import"./BuildForms-BNnXhzVm.js";import"./IconCircleDashedCheck-FiF_1OHY.js";import"./SalesOrderForms-EpMC8M0_.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=[["path",{d:"M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M8 16v.01",key:"svg-1"}],["path",{d:"M8 12v.01",key:"svg-2"}],["path",{d:"M8 8v.01",key:"svg-3"}],["path",{d:"M16 16v.01",key:"svg-4"}],["path",{d:"M16 12v.01",key:"svg-5"}],["path",{d:"M16 8v.01",key:"svg-6"}],["path",{d:"M12 8v.01",key:"svg-7"}],["path",{d:"M12 16v.01",key:"svg-8"}]],Yt=Pe("outline","box-padding","BoxPadding",Wt);function Gt({stockItem:c}){const r=ee("stock_item_install"),m=Z(),f=It({stockItem:c}),u=U({url:A(p.stock_install),pk:c.pk,title:t._({id:"erPDED"}),table:r,successMessage:t._({id:"g+zcGQ"}),fields:f}),[g,h]=o.useState({}),n=wt(),e=U({url:A(p.stock_uninstall),pk:g.pk,title:t._({id:"q2BZiX"}),table:r,successMessage:t._({id:"ibtYlF"}),fields:n,initialData:{location:c.location??c.part_detail?.default_location}}),k=o.useMemo(()=>[Ft({part:"part_detail"}),{accessor:"quantity",switchable:!1,render:j=>{let I=G(j.quantity);return j.serial&&j.quantity==1&&(I=`# ${j.serial}`),I}},{accessor:"batch",switchable:!1},Pt({model:l.stockitem})],[]),S=o.useMemo(()=>[s.jsx(je,{tooltip:t._({id:"erPDED"}),onClick:()=>{u.open()},hidden:!m.hasChangeRole(b.stock)||c.is_building||c.part_detail?.assembly!=!0},"install")],[c,m]),x=o.useCallback(j=>[{title:t._({id:"fo0VXg"}),tooltip:t._({id:"mGSvSz"}),onClick:()=>{h(j),e.open()},icon:s.jsx(Ne,{}),hidden:!m.hasChangeRole(b.stock)}],[m]);return s.jsxs(s.Fragment,{children:[u.modal,e.modal,c.pk?s.jsx(te,{url:A(p.stock_item_list),tableState:r,columns:k,props:{tableActions:S,enableSelection:!0,enableLabels:!0,enableReports:!0,rowActions:x,modelType:l.stockitem,params:{belongs_to:c.pk,part_detail:!0}}}):s.jsx(N,{})]})}function Qt({partId:c,itemId:r}){const m=Ie(),f=Z(),u=ee("stocktests"),g=xe(),h=o.useMemo(()=>g.isSet("TEST_STATION_DATA"),[g]),{data:n}=fe({queryKey:["stocktesttemplates",c,r],queryFn:async()=>c?m.get(A(p.part_test_template_list),{params:{part:c,include_inherited:!0,enabled:!0}}).then(d=>d.data):[]});o.useEffect(()=>{u.refreshTable()},[n]);const e=o.useCallback(d=>{const a=n?.map(_=>({..._,templateId:_.pk,results:[]}))??[];return d.forEach(_=>{a.find(y=>y.templateId==_.template)||a.push({..._.template_detail,templateId:_.template,results:[]})}),d.sort((_,y)=>_.pk>y.pk?1:-1).forEach(_=>{const y=a.findIndex(M=>M.templateId==_.template);y>=0&&(a[y]={...a[y],..._},a[y].results.push(_))}),a},[c,r,n]),k=o.useCallback(d=>[{accessor:"test",title:t._({id:"NnH3pK"}),switchable:!1,sortable:!0,render:a=>{const _=a.enabled??a.template_detail?.enabled,y=a.stock_item!=null&&a.stock_item!=r,M=a.results&&a.results.length>1;return s.jsxs(R,{justify:"space-between",wrap:"nowrap",children:[s.jsxs(R,{gap:"xs",children:[!d&&s.jsx(Kt,{enabled:M,expanded:u.isRowExpanded(a.pk)}),s.jsxs(W,{style:{fontStyle:y?"italic":void 0},c:_?void 0:"red",children:[!a.templateId&&"- ",a.test_name??a.template_detail?.test_name]})]}),s.jsxs(R,{justify:"right",children:[a.results&&a.results.length>1&&s.jsx(Y,{label:t._({id:"isbwWo"}),children:s.jsx(oe,{color:"lightblue",variant:"filled",children:a.results.length})}),y&&s.jsx(Y,{label:t._({id:"yd1WJ/"}),children:s.jsx(ye,{size:16,color:"blue"})})]})]})}},{accessor:"result",title:t._({id:"RD6AE9"}),switchable:!1,sortable:!0,render:a=>a.result===void 0?s.jsx(oe,{color:"lightblue",variant:"filled",children:t._({id:"4bobEy"})}):s.jsx(Nt,{value:a.result})},we({}),{accessor:"value",title:t._({id:"wMHvYH"})},{accessor:"attachment",title:t._({id:"UY1vmE"}),render:a=>a.attachment&&s.jsx(Ut,{attachment:a.attachment}),noContext:!0},qt({}),Te({}),zt({accessor:"user_detail",ordering:"user"}),{accessor:"test_station",sortable:!0,title:t._({id:"18Lf3c"}),hidden:!h},{accessor:"started_datetime",sortable:!0,title:t._({id:"JEGlfK"}),hidden:!h,render:a=>s.jsx(R,{justify:"space-between",children:pe(a.started_datetime,{showTime:!0,showSeconds:!0})})},{accessor:"finished_datetime",sortable:!0,title:t._({id:"4dQFvz"}),hidden:!h,render:a=>s.jsx(R,{justify:"space-between",children:pe(a.finished_datetime,{showTime:!0,showSeconds:!0})})}],[r,h,u.expandedRecords]),S=o.useMemo(()=>k(!1),[r,h,u.expandedRecords]),[x,j]=o.useState(void 0),I=ke({partId:c,itemId:r,templateId:x,editing:!1}),K=ke({partId:c,itemId:r,templateId:x,editing:!0}),T=U({url:p.stock_test_result_list,fields:o.useMemo(()=>({...I}),[I]),initialData:{template:x,result:!0},title:t._({id:"VzkBcq"}),table:u,successMessage:t._({id:"VivtT0"})}),[D,F]=o.useState(0),z=ve({url:p.stock_test_result_list,pk:D,fields:o.useMemo(()=>({...K}),[K]),title:t._({id:"1HKt5e"}),onFormSuccess:()=>u.refreshTable,successMessage:t._({id:"G0v/SO"})}),L=Se({url:p.stock_test_result_list,pk:D,title:t._({id:"381PhV"}),table:u,successMessage:t._({id:"xbuMqN"})}),Q=o.useCallback(d=>{m.post(A(p.stock_test_result_list),{template:d,stock_item:r,result:!0}).then(()=>{u.refreshTable(),ne({title:t._({id:"uUlW4e"}),message:t._({id:"uiR3yF"}),color:"green"})}).catch(()=>{ne({title:t._({id:"SlfejT"}),message:t._({id:"VjER3N"}),color:"red"})})},[r]),O=o.useCallback(d=>d.stock_item!=null&&d.stock_item!=r?[]:[{title:t._({id:"up/ozE"}),color:"green",icon:s.jsx(qe,{}),hidden:!d.templateId||d?.requires_attachment||d?.requires_value||d.result,onClick:()=>Q(d.templateId)},{title:t._({id:"m16xKo"}),tooltip:t._({id:"VzkBcq"}),color:"green",icon:s.jsx(Ue,{}),hidden:!f.hasAddRole(b.stock)||!d.templateId,onClick:()=>{j(d.templateId),T.open()}},Xe({tooltip:t._({id:"1HKt5e"}),hidden:!f.hasChangeRole(b.stock)||!d.template_detail,onClick:()=>{F(d.pk),z.open()}}),Je({tooltip:t._({id:"381PhV"}),hidden:!f.hasDeleteRole(b.stock)||!d.template_detail,onClick:()=>{F(d.pk),L.open()}})],[f,r]),E=o.useMemo(()=>[{name:"required",label:t._({id:"TMLAx2"}),description:t._({id:"sKK8za"})},{name:"include_installed",label:t._({id:"TD72EF"}),description:t._({id:"BYeSw1"})},{name:"result",label:t._({id:"nqMwPi"}),description:t._({id:"bcwRe2"})},{name:"enabled",label:t._({id:"RxzN1M"}),description:t._({id:"+kMQXd"})}],[]),H=o.useMemo(()=>[s.jsx(je,{tooltip:t._({id:"VzkBcq"}),onClick:()=>{j(void 0),T.open()},hidden:!f.hasAddRole(b.stock)},"add-test-result")],[f]),X=o.useMemo(()=>{const d=[...k(!0),{accessor:"actions",title:"  ",hidden:!1,switchable:!1,width:50,render:a=>s.jsx($e,{actions:O(a)??[]})}];return{allowMultiple:!0,expandable:({record:a})=>u.isRowExpanded(a.pk)||a.results&&a.results.length>1,content:({record:a})=>{if(!a||!a.results||a.results.length<2)return null;const _=a?.results??[];return s.jsx(Bt,{idAccessor:"test",noHeader:!0,columns:d,records:_.slice(0,-1)},a.pk)}}},[k,u.isRowExpanded]);return s.jsxs(s.Fragment,{children:[T.modal,z.modal,L.modal,s.jsx(te,{url:A(p.stock_test_result_list),tableState:u,columns:S,props:{dataFormatter:e,enablePagination:!1,tableActions:H,tableFilters:E,rowActions:O,rowExpansion:X,params:{stock_item:r,user_detail:!0,attachment_detail:!0,template_detail:!0}}})]})}function Ht({itemId:c}){const r=ge(),m=ee("stock_tracking"),f=o.useCallback(h=>{const n=h?.deltas??{},e=[{label:t._({id:"igx8Og"}),key:"stockitem",details:n.stockitem_detail&&me({instance:n.stockitem_detail,link:!0})},{label:t._({id:"igx8Og"}),key:"item",details:n.item_detail&&me({instance:n.item_detail,link:!0})},{label:t._({id:"uAQUqI"}),key:"status",details:n.status&&Ae({status:n.status,type:l.stockitem})},{label:t._({id:"VbWX2u"}),key:"quantity",details:G(n.quantity)},{label:t._({id:"hp8OtS"}),key:"added",details:n.added},{label:t._({id:"eps54V"}),key:"removed",details:n.removed},{label:t._({id:"vgP+9p"}),key:"part",details:n.part_detail&&kt({instance:n.part_detail,link:!0,navigate:r})},{label:t._({id:"wJijgU"}),key:"location",details:n.location_detail&&bt({instance:n.location_detail,link:!0,navigate:r})},{label:t._({id:"YxwWvi"}),key:"buildorder",details:n.buildorder_detail&&ht({instance:n.buildorder_detail,link:!0,navigate:r})},{label:t._({id:"KxySMG"}),key:"purchaseorder",details:n.purchaseorder_detail&&xt({instance:n.purchaseorder_detail,link:!0,navigate:r})},{label:t._({id:"LozYBo"}),key:"salesorder",details:n.salesorder_detail&&ft({instance:n.salesorder_detail,link:!0,navigate:r})},{label:t._({id:"Z6ve1w"}),key:"returnorder",details:n.returnorder_detail&&yt({instance:n.returnorder_detail,link:!0,navigate:r})},{label:t._({id:"876pfE"}),key:"customer",details:n.customer_detail&&gt({instance:n.customer_detail,link:!0,navigate:r})}];return s.jsx(B,{striped:!0,children:s.jsx(B.Tbody,{children:e.map(k=>k.details&&s.jsxs(B.Tr,{children:[s.jsx(B.Td,{children:s.jsx(W,{children:k.label})}),s.jsx(B.Td,{children:k.details})]},k.key))})})},[r]),u=o.useMemo(()=>[jt({name:"user",label:t._({id:"7PzzBU"}),description:t._({id:"FVjW63"})})],[]),g=o.useMemo(()=>[Te({switchable:!1}),we({accessor:"label"}),{accessor:"details",title:t._({id:"URmyfc"}),switchable:!1,render:f},{accessor:"notes",title:t._({id:"1DBGsz"}),sortable:!1,switchable:!0},{accessor:"user",title:t._({id:"7PzzBU"}),render:h=>h.user_detail?vt({instance:h.user_detail}):s.jsx(W,{size:"sm",fs:"italic",children:t._({id:"L5d7xh"})})}],[]);return s.jsx(te,{tableState:m,url:A(p.stock_tracking_list),columns:g,props:{params:{item:c,user_detail:!0},enableDownload:!0,tableFilters:u}})}function Gs(){const{id:c}=Ke(),r=Ie(),m=Z(),f=xe(),u=o.useMemo(()=>f.isSet("STOCK_ENABLE_EXPIRY"),[f]),g=ge(),[h,n]=o.useState(!1),{instance:e,refreshInstance:k,instanceQuery:S}=he({endpoint:p.stock_item_list,pk:c,params:{part_detail:!0,location_detail:!0,path_detail:!0}}),{instance:x,instanceQuery:j}=he({endpoint:p.stock_serial_info,pk:c}),I=Tt({partId:e.part}),K=o.useMemo(()=>{const i={...e},v=e?.part_detail??{};if(i.available_stock=Math.max(0,i.quantity-i.allocated),S.isFetching)return s.jsx(N,{});const J=[{name:"part",label:t._({id:"mY+KgP"}),type:"link",model:l.part},{name:"part_detail.IPN",label:t._({id:"3wXEsN"}),type:"text",copy:!0,icon:"part",hidden:!v.IPN},{name:"part_detail.revision",label:t._({id:"6LTyxl"}),type:"string",copy:!0,icon:"revision",hidden:!v.revision},{name:"status",type:"status",label:t._({id:"uAQUqI"}),model:l.stockitem},{name:"status_custom_key",type:"status",label:t._({id:"4DvUAJ"}),model:l.stockitem,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status},{type:"link",name:"link",label:t._({id:"yzF66j"}),external:!0,copy:!0,hidden:!e.link}],$=[{type:"text",name:"serial",label:t._({id:"AXeJt4"}),hidden:!e.serial,value_formatter:()=>s.jsxs(R,{gap:"xs",justify:"space-apart",children:[s.jsx(W,{children:e.serial}),s.jsx(ze,{flex:10}),s.jsxs(R,{gap:2,justify:"right",children:[x.previous?.pk&&s.jsx(Y,{label:t._({id:"6nb2iE"}),position:"top",children:s.jsx(re,{p:3,"aria-label":"previous-serial-number",leftSection:s.jsx(St,{}),variant:"transparent",size:"sm",onClick:()=>{g(q(l.stockitem,x.previous.pk))},children:x.previous.serial})}),s.jsx(Qe,{icon:s.jsx(Le,{size:18}),tooltip:t._({id:"jfMcvL"}),tooltipAlignment:"top",variant:"transparent",onClick:I.open}),x.next?.pk&&s.jsx(Y,{label:t._({id:"TVYdHj"}),position:"top",children:s.jsx(re,{p:3,"aria-label":"next-serial-number",rightSection:s.jsx(Lt,{}),variant:"transparent",size:"sm",onClick:()=>{g(q(l.stockitem,x.next.pk))},children:x.next.serial})})]})]})},{type:"number",name:"quantity",label:t._({id:"VbWX2u"}),unit:v?.units,hidden:!!e.serial&&e.quantity==1},{type:"number",name:"available_stock",label:t._({id:"csDS2L"}),unit:v?.units,icon:"stock"},{type:"number",name:"allocated",label:t._({id:"8oSGoC"}),unit:v?.units,icon:"tick_off",hidden:!e.allocated},{type:"text",name:"batch",label:t._({id:"Vea6Aj"}),hidden:!e.batch}],De=[{name:"supplier_part",label:t._({id:"nne72x"}),type:"link",model_field:"SKU",model:l.supplierpart,hidden:!e.supplier_part},{type:"link",name:"location",label:t._({id:"wJijgU"}),model:l.stocklocation,hidden:!e.location},{type:"link",name:"belongs_to",label:t._({id:"QPoAhl"}),model_filters:{part_detail:!0},model_formatter:P=>{let le=P?.part_detail?.full_name??P?.name;return P.serial&&P.quantity==1&&(le+=` # ${P.serial}`),le},icon:"stock",model:l.stockitem,hidden:!e.belongs_to},{type:"link",name:"parent",icon:"sitemap",label:t._({id:"0o0T0n"}),model:l.stockitem,hidden:!e.parent,model_formatter:P=>t._({id:"94QKKW"})},{type:"link",name:"consumed_by",label:t._({id:"H00rnl"}),model:l.build,hidden:!e.consumed_by,icon:"build",model_field:"reference"},{type:"link",name:"build",label:t._({id:"YxwWvi"}),model:l.build,hidden:!e.build,model_field:"reference"},{type:"link",name:"purchase_order",label:t._({id:"KxySMG"}),model:l.purchaseorder,hidden:!e.purchase_order,icon:"purchase_orders",model_field:"reference"},{type:"link",name:"sales_order",label:t._({id:"LozYBo"}),model:l.salesorder,hidden:!e.sales_order,icon:"sales_orders",model_field:"reference"},{type:"link",name:"customer",label:t._({id:"876pfE"}),model:l.company,hidden:!e.customer}],Fe=[{type:"date",name:"expiry_date",label:t._({id:"uaSvqt"}),hidden:!u||!e.expiry_date,icon:"calendar"},{type:"text",name:"purchase_price",label:t._({id:"vWelsN"}),icon:"currency",hidden:!e.purchase_price,value_formatter:()=>_e(e.purchase_price,{currency:e.purchase_price_currency})},{type:"text",name:"stock_value",label:t._({id:"g9RfVq"}),icon:"currency",hidden:!e.purchase_price||e.quantity==1||e.quantity==0,value_formatter:()=>_e(e.purchase_price,{currency:e.purchase_price_currency,multiplier:e.quantity})},{type:"text",name:"packaging",icon:"part",label:t._({id:"pD/Ew0"}),hidden:!e.packaging},{type:"text",name:"updated",icon:"calendar",label:t._({id:"K7P0jz"})},{type:"text",name:"stocktake",icon:"calendar",label:t._({id:"whZ7zT"}),hidden:!e.stocktake}];return s.jsxs(ot,{children:[s.jsxs(de,{grow:!0,children:[s.jsx(rt,{appRole:b.part,apiPath:p.part_list,src:e.part_detail?.image??e?.part_detail?.thumbnail,pk:e.part}),s.jsx(de.Col,{span:{base:12,sm:8},children:s.jsx(V,{fields:J,item:i})})]}),s.jsx(V,{fields:$,item:i}),s.jsx(V,{fields:De,item:i}),s.jsx(V,{fields:Fe,item:i})]})},[e,x,j.isFetching,S.isFetching,u]),T=o.useMemo(()=>e?.part_detail?.component&&!e?.sales_order&&!e?.belongs_to,[e]),D=o.useMemo(()=>e?.part_detail?.salable,[e]),F=fe({queryKey:["tracked-bom-item",e.pk,e.part],queryFn:()=>!e.pk||!e.part||!e.part_detail?.assembly?!1:r.get(A(p.bom_list),{params:{part:e.part,sub_part_trackable:!0,limit:1}}).then(i=>i.status==200?i.data.count>0:null)}),z=o.useMemo(()=>e?.installed_items?!0:F.data?F.data:e?.part_detail?.assembly,[F,e]),L=o.useMemo(()=>[{name:"details",label:t._({id:"hBG+yp"}),icon:s.jsx(ye,{}),content:K},{name:"tracking",label:t._({id:"IdrYoA"}),icon:s.jsx(Oe,{}),content:e.pk?s.jsx(Ht,{itemId:e.pk}):s.jsx(N,{})},{name:"allocations",label:t._({id:"KwhnxF"}),icon:s.jsx(Ot,{}),hidden:!e.in_stock||!D&&!T,content:s.jsxs(C,{multiple:!0,defaultValue:["buildAllocations","salesAllocations"],children:[T&&s.jsxs(C.Item,{value:"buildAllocations",children:[s.jsx(C.Control,{children:s.jsx(ce,{size:"lg",children:t._({id:"KCpl4N"})})}),s.jsx(C.Panel,{children:s.jsx(Rt,{stockId:e.pk,modelField:"build",modelTarget:l.build,showBuildInfo:!0})})]},"buildAllocations"),D&&s.jsxs(C.Item,{value:"salesAllocations",children:[s.jsx(C.Control,{children:s.jsx(ce,{size:"lg",children:t._({id:"DaWMWw"})})}),s.jsx(C.Panel,{children:s.jsx(Dt,{stockId:e.pk,modelField:"order",modelTarget:l.salesorder,showOrderInfo:!0})})]},"salesAllocations")]})},{name:"test-results",label:t._({id:"isbwWo"}),icon:s.jsx(Vt,{}),hidden:!e?.part_detail?.testable,content:e?.pk?s.jsx(Qt,{itemId:e.pk,partId:e.part}):s.jsx(N,{})},{name:"installed_items",label:t._({id:"xnskHi"}),icon:s.jsx(Yt,{}),hidden:!z,content:s.jsx(Gt,{stockItem:e})},{name:"child_items",label:t._({id:"K4v96J"}),icon:s.jsx(Ve,{}),hidden:(e?.child_items??0)==0,content:e?.pk?s.jsx(Et,{tableName:"child-stock",params:{ancestor:e.pk}}):s.jsx(N,{})},dt({model_type:l.stockitem,model_id:e.pk}),ct({model_type:l.stockitem,model_id:e.pk})],[D,T,z,e,x,j,c,m]),Q=o.useMemo(()=>[{name:t._({id:"blbbPS"}),url:"/stock"},...(e.location_path??[]).map(i=>({name:i.name,url:q(l.stocklocation,i.pk)}))],[e]),O=be({create:!1,stockItem:e,partId:e.part,modalId:"edit-stock-item"}),E=ve({url:p.stock_item_list,pk:e.pk,title:t._({id:"gQgYNs"}),modalId:"edit-stock-item",fields:O,onFormSuccess:k}),H=be({create:!0,modalId:"duplicate-stock-item"}),X=o.useMemo(()=>{const i={...e,serial_numbers:e.serial};return delete i.serial,i},[e]),d=U({url:p.stock_item_list,title:t._({id:"bJLEQT"}),modalId:"duplicate-stock-item",fields:H,initialData:{...X},follow:!0,successMessage:null,modelType:l.stockitem,onFormSuccess:i=>{if(Array.isArray(i)&&i.length>0)if(i.length==1)g(q(l.stockitem,i[0]?.pk));else{const v=i.length;Be.show({title:t._({id:"7Vas0a"}),message:t._({id:"DHdcSX",values:{n:v}}),color:"green"})}}}),a=o.useMemo(()=>{},[e]),_=Se({url:p.stock_item_list,pk:e.pk,title:t._({id:"BJoa27"}),preFormContent:a,onFormSuccess:()=>{g(q(l.part,e.part))}}),y=o.useMemo(()=>({items:[e],model:l.stockitem,refresh:k,filters:{in_stock:!0}}),[e]),M=Ct({formProps:y,delete:!1,assign:!!e.in_stock,return:!!e.consumed_by||!!e.customer,merge:!1}),Me=Mt({partId:e.part,trackable:e.part_detail?.trackable,modalId:"stock-item-serialize"}),se=U({url:p.stock_serialize,pk:e.pk,title:t._({id:"ETKLHa"}),modalId:"stock-item-serialize",fields:Me,initialData:{quantity:e.quantity,destination:e.location??e.part_detail?.default_location},onFormSuccess:i=>{i.length>=e.quantity?g(q(l.stockitem,i[0].pk)):k()},successMessage:t._({id:"Hkw/xj"})}),ae=At({parts:e.part_detail?[e.part_detail]:[]}),ie=We({title:t._({id:"kiz1mM"}),modelType:l.stocklocation,callback:async(i,v)=>{const J=v.stocklocation.pk;return r.post(A(p.stock_transfer),{location:J,items:[{pk:e.pk,quantity:e.quantity}]}).then(()=>(k(),{success:t._({id:"vdb1YW"})})).catch($=>(console.log("Error scanning stock item:",$),{error:t._({id:"TL3ZFM"})}))}}),Ce=o.useMemo(()=>{m.hasChangeRole(b.stock)&&!e.sales_order&&!e.belongs_to&&!e.customer&&e.consumed_by,e.is_building;const i=e.serial,v=i!=null&&i!=null&&i!=""&&e.quantity==1;return[s.jsx(He,{model:l.stockitem,id:e.pk}),s.jsx(_t,{stockId:e.pk}),s.jsx(Ze,{model:l.stockitem,pk:e.pk,hash:e?.barcode_hash,perm:m.hasChangeRole(b.stock),actions:[{name:t._({id:"MeG2ih"}),icon:s.jsx(ue,{icon:"location"}),tooltip:t._({id:"8Otzst"}),onClick:ie.open}]}),s.jsx(et,{modelType:l.stockitem,items:[e.pk],enableReports:!0,enableLabels:!0}),s.jsx(tt,{tooltip:t._({id:"ClJC3x"}),icon:s.jsx(Ge,{}),actions:[...M.menuActions,{name:t._({id:"Wlr+mY"}),tooltip:t._({id:"Vmnyam"}),hidden:v||e?.quantity<1||e?.part_detail?.trackable!=!0,icon:s.jsx(ue,{icon:"serial",iconProps:{color:"blue"}}),onClick:()=>{se.open()}},{name:t._({id:"UYUgdb"}),tooltip:t._({id:"cUzrZK"}),hidden:!m.hasAddRole(b.purchase_order)||!e.part_detail?.active||!e.part_detail?.purchaseable,icon:s.jsx(Ye,{color:"blue"}),onClick:()=>{ae.openWizard()}}]}),s.jsx(st,{tooltip:t._({id:"oPF3fX"}),actions:[at({hidden:!m.hasAddRole(b.stock),onClick:()=>d.open()}),it({hidden:!m.hasChangeRole(b.stock),onClick:()=>E.open()}),lt({hidden:!m.hasDeleteRole(b.stock),onClick:()=>_.open()})]})]},[c,e,m,M.menuActions]),Re=o.useMemo(()=>{let i=(e?.quantity??0)-(e?.allocated??0);return i=Math.max(0,i),S.isLoading?[]:[s.jsx(w,{color:"yellow",label:t._({id:"BE5Q6v"}),visible:e.is_building}),s.jsx(w,{color:"blue",label:`${t._({id:"AXeJt4"})}: ${e.serial}`,visible:!!e.serial},"serial"),s.jsx(w,{color:"blue",label:`${t._({id:"VbWX2u"})}: ${G(e.quantity)}`,visible:!e.serial},"quantity"),s.jsx(w,{color:"yellow",label:`${t._({id:"csDS2L"})}: ${G(i)}`,visible:e.in_stock&&!e.serial&&i!=e.quantity},"available"),s.jsx(w,{color:"blue",label:`${t._({id:"Vea6Aj"})}: ${e.batch}`,visible:!!e.batch},"batch"),s.jsx(Ae,{status:e.status_custom_key||e.status,type:l.stockitem,options:{size:"lg"}},"status"),s.jsx(w,{color:"yellow",label:t._({id:"1ba70W"}),visible:u&&e.stale&&!e.expired},"stale"),s.jsx(w,{color:"orange",label:t._({id:"M1RnFv"}),visible:u&&e.expired},"expired"),s.jsx(w,{color:"red",label:t._({id:"jqzUyM"}),visible:e.in_stock==!1},"unavailable")]},[e,S,u]);return s.jsxs(s.Fragment,{children:[I.modal,ie.dialog,s.jsx(nt,{query:S,requiredPermission:l.stockitem,children:s.jsxs(Ee,{children:[m.hasViewRole(b.stock_location)&&s.jsx(ut,{title:t._({id:"1eBWAw"}),modelType:l.stocklocation,endpoint:p.stock_location_tree,opened:h,onClose:()=>n(!1),selectedId:e?.location}),s.jsx(mt,{title:t._({id:"igx8Og"}),subtitle:e.part_detail?.full_name,imageUrl:e.part_detail?.thumbnail,editAction:E.open,editEnabled:m.hasChangePermission(l.stockitem),badges:Re,breadcrumbs:m.hasViewRole(b.stock_location)?Q:void 0,lastCrumb:[{name:e.name,url:`/stock/item/${e.pk}/`}],breadcrumbAction:()=>{n(!0)},actions:Ce}),s.jsx(pt,{pageKey:"stockitem",panels:L,model:l.stockitem,id:e.pk,instance:e})]})}),E.modal,d.modal,_.modal,se.modal,M.modals.map(i=>i.modal),ae.wizard]})}export{Gs as default};
//# sourceMappingURL=StockDetail-CR0Iknau.js.map
