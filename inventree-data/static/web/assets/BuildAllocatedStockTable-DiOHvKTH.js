import{ag as E,r as a,ab as t,bc as _,ao as p,j as i,aO as r,an as N}from"./index-DjOBj_Ai.js";import{u as U,R as V,a as v,I as B}from"./InvenTreeTable-C-s5lvnS.js";import{A as O}from"./ActionButton-D4nRdKaB.js";import{c as P}from"./BuildForms-BNnXhzVm.js";import{U as J,ai as K,j as W,e as X}from"./Filter-CpWhllKn.js";import{u as Y}from"./UseStockAdjustActions-B7uQUwuU.js";import{R as z,S as G,P as H,h as g,j as Q}from"./ColumnRenderers-BCeqgJNS.js";import{I as T}from"./IconCircleDashedCheck-FiF_1OHY.js";function ie({buildId:u,stockId:j,partId:c,showBuildInfo:d,showPartInfo:n,allowEdit:k,modelTarget:x,modelField:I}){const l=E(),s=U(c?"buildallocatedstock-part":"buildallocatedstock"),w=a.useMemo(()=>{const e=[{name:"tracked",label:t._({id:"ML+087"}),description:t._({id:"mVVw+/"})}];return c&&e.push(J()),e.push(K()),e},[c]),D=a.useMemo(()=>[z({accessor:"build_detail.reference",title:t._({id:"YxwWvi"}),switchable:!1,hidden:d!=!0}),{accessor:"build_detail.title",title:t._({id:"Nu4oKW"}),hidden:d!=!0},G({accessor:"build_detail.status",model:_.build,title:t._({id:"acIJ41"}),hidden:d!=!0}),H({hidden:!n,switchable:!1}),{accessor:"part_detail.IPN",ordering:"IPN",hidden:!n,title:t._({id:"3wXEsN"}),sortable:!0,switchable:!0},{hidden:!n,accessor:"bom_reference",title:t._({id:"N2C89m"}),sortable:!0,switchable:!0},{accessor:"serial",title:t._({id:"AXeJt4"}),sortable:!1,switchable:!0,render:e=>e?.stock_item_detail?.serial},{accessor:"batch",title:t._({id:"Vea6Aj"}),sortable:!1,switchable:!0,render:e=>e?.stock_item_detail?.batch},g({accessor:"available",title:t._({id:"csDS2L"})}),g({accessor:"quantity",title:t._({id:"A/ybx7"}),sortable:!0,switchable:!1}),Q({accessor:"location_detail",switchable:!0,sortable:!0}),{accessor:"install_into",title:t._({id:"gILim+"}),sortable:!0},{accessor:"sku",title:t._({id:"nne72x"}),render:e=>e?.supplier_part_detail?.SKU,sortable:!0}],[]),[h,f]=a.useState(0),C=W({pk:h,url:p.build_item_list,title:t._({id:"Tqnsor"}),fields:{stock_item:{disabled:!0},quantity:{}},table:s}),R=X({pk:h,url:p.build_item_list,title:t._({id:"nV5okC"}),table:s}),[A,S]=a.useState([]),F=a.useMemo(()=>A.filter(e=>!e.part_detail?.trackable),[A]),m=P({buildId:u??0,allocatedItems:F,onFormSuccess:()=>{s.clearSelectedRecords(),s.refreshTable()}}),M=a.useMemo(()=>({items:s.selectedRecords.filter(o=>!!o.stock_item_detail).map(o=>({...o.stock_item_detail,part_detail:o.part_detail,location_detail:o.location_detail})),model:_.stockitem,refresh:s.refreshTable}),[s.selectedRecords,s.refreshTable]),b=Y({formProps:M,merge:!1,assign:!1,delete:!1,add:!1,count:!1,remove:!1}),y=a.useCallback(e=>{const q=(e.part_detail??{})?.trackable??!1;return[{color:"green",icon:i.jsx(T,{}),title:t._({id:"gyu1Ok"}),tooltip:t._({id:"8nBqTf"}),hidden:!u||q||!l.hasChangeRole(r.build),onClick:()=>{S([e]),m.open()}},V({hidden:!l.hasChangeRole(r.build),onClick:()=>{f(e.pk),C.open()}}),v({hidden:!l.hasDeleteRole(r.build),onClick:()=>{f(e.pk),R.open()}})]},[l]),L=a.useMemo(()=>[b.dropdown,i.jsx(O,{icon:i.jsx(T,{}),tooltip:t._({id:"8nBqTf"}),hidden:!l.hasChangeRole(r.build),disabled:s.selectedRecords.length==0,color:"green",onClick:()=>{S(s.selectedRecords),m.open()}},"consume-stock")],[l,s.selectedRecords,b.dropdown]);return i.jsxs(i.Fragment,{children:[C.modal,R.modal,m.modal,b.modals.map(e=>e.modal),i.jsx(B,{tableState:s,url:N(p.build_item_list),columns:D,props:{params:{build:u,part:c,stock_item:j,build_detail:d??!1,part_detail:n??!1,location_detail:!0,stock_detail:!0,supplier_detail:!0},enableBulkDelete:k&&l.hasDeleteRole(r.build),enableDownload:!0,enableSelection:k&&l.hasDeleteRole(r.build),rowActions:y,tableActions:L,tableFilters:w,enableLabels:!0,enableReports:!0,printingAccessor:"stock_item",modelField:I??"stock_item",modelType:x??_.stockitem}})]})}export{ie as B};
//# sourceMappingURL=BuildAllocatedStockTable-DiOHvKTH.js.map
