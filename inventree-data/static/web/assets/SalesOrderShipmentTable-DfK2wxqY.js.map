{"version":3,"file":"SalesOrderShipmentTable-DfK2wxqY.js","sources":["../../../../../../frontend/src/tables/sales/SalesOrderShipmentTable.tsx"],"sourcesContent":["import { t } from '@lingui/core/macro';\nimport { IconTruckDelivery } from '@tabler/icons-react';\nimport { useCallback, useMemo, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\n\nimport { AddItemButton } from '@lib/components/AddItemButton';\nimport {\n  type RowAction,\n  RowCancelAction,\n  RowEditAction,\n  RowViewAction\n} from '@lib/components/RowActions';\nimport { YesNoButton } from '@lib/components/YesNoButton';\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { ModelType } from '@lib/enums/ModelType';\nimport { UserRoles } from '@lib/enums/Roles';\nimport { apiUrl } from '@lib/functions/Api';\nimport type { TableFilter } from '@lib/types/Filters';\nimport type { TableColumn } from '@lib/types/Tables';\nimport dayjs from 'dayjs';\nimport {\n  useSalesOrderShipmentCompleteFields,\n  useSalesOrderShipmentFields\n} from '../../forms/SalesOrderForms';\nimport {\n  useCreateApiFormModal,\n  useDeleteApiFormModal,\n  useEditApiFormModal\n} from '../../hooks/UseForm';\nimport { useTable } from '../../hooks/UseTable';\nimport { useUserState } from '../../states/UserState';\nimport {\n  CompanyColumn,\n  DateColumn,\n  LinkColumn,\n  StatusColumn\n} from '../ColumnRenderers';\nimport { InvenTreeTable } from '../InvenTreeTable';\n\nexport default function SalesOrderShipmentTable({\n  showOrderInfo = false,\n  tableName,\n  customerId,\n  orderId,\n  filters\n}: Readonly<{\n  showOrderInfo?: boolean;\n  tableName?: string;\n  customerId?: number;\n  orderId?: number;\n  filters?: any;\n}>) {\n  const user = useUserState();\n  const navigate = useNavigate();\n  const table = useTable(tableName ?? 'sales-order-shipment');\n\n  const [selectedShipment, setSelectedShipment] = useState<any>({});\n\n  const newShipmentFields = useSalesOrderShipmentFields({\n    customerId: customerId\n  });\n\n  const editShipmentFields = useSalesOrderShipmentFields({\n    customerId: customerId\n  });\n\n  const completeShipmentFields = useSalesOrderShipmentCompleteFields({});\n\n  const newShipment = useCreateApiFormModal({\n    url: ApiEndpoints.sales_order_shipment_list,\n    fields: newShipmentFields,\n    title: t`Create Shipment`,\n    table: table,\n    initialData: {\n      order: orderId\n    }\n  });\n\n  const deleteShipment = useDeleteApiFormModal({\n    url: ApiEndpoints.sales_order_shipment_list,\n    pk: selectedShipment.pk,\n    title: t`Cancel Shipment`,\n    table: table\n  });\n\n  const editShipment = useEditApiFormModal({\n    url: ApiEndpoints.sales_order_shipment_list,\n    pk: selectedShipment.pk,\n    fields: editShipmentFields,\n    title: t`Edit Shipment`,\n    table: table\n  });\n\n  const completeShipment = useCreateApiFormModal({\n    url: ApiEndpoints.sales_order_shipment_complete,\n    pk: selectedShipment.pk,\n    fields: completeShipmentFields,\n    title: t`Complete Shipment`,\n    table: table,\n    focus: 'tracking_number',\n    initialData: {\n      ...selectedShipment,\n      shipment_date: dayjs().format('YYYY-MM-DD')\n    }\n  });\n\n  const tableColumns: TableColumn[] = useMemo(() => {\n    return [\n      {\n        accessor: 'customer',\n        title: t`Customer`,\n        switchable: true,\n        sortable: true,\n        hidden: !showOrderInfo,\n        render: (record: any) => (\n          <CompanyColumn company={record.customer_detail} />\n        )\n      },\n      {\n        switchable: false,\n        accessor: 'order_detail.reference',\n        title: t`Sales Order`,\n        hidden: !showOrderInfo,\n        sortable: false\n      },\n      StatusColumn({\n        switchable: true,\n        model: ModelType.salesorder,\n        accessor: 'order_detail.status',\n        title: t`Order Status`,\n        hidden: !showOrderInfo\n      }),\n      {\n        accessor: 'reference',\n        title: t`Shipment Reference`,\n        switchable: false,\n        sortable: true\n      },\n      {\n        accessor: 'allocated_items',\n        sortable: true,\n        switchable: false,\n        title: t`Items`\n      },\n      {\n        accessor: 'checked',\n        title: t`Checked`,\n        switchable: true,\n        sortable: false,\n        render: (record: any) => <YesNoButton value={!!record.checked_by} />\n      },\n      {\n        accessor: 'shipped',\n        title: t`Shipped`,\n        switchable: true,\n        sortable: false,\n        render: (record: any) => <YesNoButton value={!!record.shipment_date} />\n      },\n      {\n        accessor: 'delivered',\n        title: t`Delivered`,\n        switchable: true,\n        sortable: false,\n        render: (record: any) => <YesNoButton value={!!record.delivery_date} />\n      },\n      DateColumn({\n        accessor: 'shipment_date',\n        title: t`Shipment Date`\n      }),\n      DateColumn({\n        accessor: 'delivery_date',\n        title: t`Delivery Date`\n      }),\n      {\n        accessor: 'tracking_number'\n      },\n      {\n        accessor: 'invoice_number'\n      },\n      LinkColumn({\n        accessor: 'link'\n      })\n    ];\n  }, [showOrderInfo]);\n\n  const rowActions = useCallback(\n    (record: any): RowAction[] => {\n      const shipped: boolean = !!record.shipment_date;\n\n      return [\n        {\n          hidden: shipped || !user.hasChangeRole(UserRoles.sales_order),\n          title: t`Complete Shipment`,\n          color: 'green',\n          icon: <IconTruckDelivery />,\n          onClick: () => {\n            setSelectedShipment(record);\n            completeShipment.open();\n          }\n        },\n        RowEditAction({\n          hidden: !user.hasChangeRole(UserRoles.sales_order),\n          tooltip: t`Edit shipment`,\n          onClick: () => {\n            setSelectedShipment(record);\n            editShipment.open();\n          }\n        }),\n        RowCancelAction({\n          hidden: shipped || !user.hasDeleteRole(UserRoles.sales_order),\n          tooltip: t`Cancel shipment`,\n          onClick: () => {\n            setSelectedShipment(record);\n            deleteShipment.open();\n          }\n        }),\n        RowViewAction({\n          title: t`View Sales Order`,\n          modelType: ModelType.salesorder,\n          modelId: record.order,\n          hidden:\n            !record.order ||\n            !showOrderInfo ||\n            !user.hasViewRole(UserRoles.sales_order),\n          navigate: navigate\n        })\n      ];\n    },\n    [showOrderInfo, user]\n  );\n\n  const tableActions = useMemo(() => {\n    // No actions possible if no order is specified\n    if (!orderId) {\n      return [];\n    }\n\n    return [\n      <AddItemButton\n        key='add-shipment'\n        tooltip={t`Add shipment`}\n        hidden={!user.hasAddRole(UserRoles.sales_order)}\n        onClick={() => {\n          newShipment.open();\n        }}\n      />\n    ];\n  }, [orderId, user]);\n\n  const tableFilters: TableFilter[] = useMemo(() => {\n    return [\n      {\n        name: 'checked',\n        label: t`Checked`,\n        description: t`Show shipments which have been checked`\n      },\n      {\n        name: 'shipped',\n        label: t`Shipped`,\n        description: t`Show shipments which have been shipped`\n      },\n      {\n        name: 'delivered',\n        label: t`Delivered`,\n        description: t`Show shipments which have been delivered`\n      }\n    ];\n  }, []);\n\n  return (\n    <>\n      {newShipment.modal}\n      {editShipment.modal}\n      {deleteShipment.modal}\n      {completeShipment.modal}\n      <InvenTreeTable\n        url={apiUrl(ApiEndpoints.sales_order_shipment_list)}\n        tableState={table}\n        columns={tableColumns}\n        props={{\n          tableActions: tableActions,\n          tableFilters: tableFilters,\n          modelType: ModelType.salesordershipment,\n          enableSelection: true,\n          enableReports: true,\n          rowActions: rowActions,\n          params: {\n            order: orderId,\n            order_detail: true,\n            customer_detail: showOrderInfo,\n            ...filters\n          }\n        }}\n      />\n    </>\n  );\n}\n"],"names":["SalesOrderShipmentTable","showOrderInfo","tableName","customerId","orderId","filters","user","useUserState","navigate","useNavigate","table","useTable","selectedShipment","setSelectedShipment","useState","newShipmentFields","useSalesOrderShipmentFields","editShipmentFields","completeShipmentFields","useSalesOrderShipmentCompleteFields","newShipment","useCreateApiFormModal","url","ApiEndpoints","sales_order_shipment_list","fields","title","_i18n","_","id","initialData","order","deleteShipment","useDeleteApiFormModal","pk","editShipment","useEditApiFormModal","completeShipment","sales_order_shipment_complete","focus","shipment_date","dayjs","format","tableColumns","useMemo","accessor","switchable","sortable","hidden","render","record","CompanyColumn","customer_detail","StatusColumn","model","ModelType","salesorder","jsx","YesNoButton","checked_by","delivery_date","DateColumn","LinkColumn","rowActions","useCallback","shipped","hasChangeRole","UserRoles","sales_order","color","icon","IconTruckDelivery","onClick","open","RowEditAction","tooltip","RowCancelAction","hasDeleteRole","RowViewAction","modelType","modelId","hasViewRole","tableActions","AddItemButton","hasAddRole","tableFilters","name","label","description","jsxs","Fragment","modal","InvenTreeTable","apiUrl","salesordershipment","enableSelection","enableReports","params","order_detail"],"mappings":"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"}