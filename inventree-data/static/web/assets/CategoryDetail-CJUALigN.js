import{r as i,j as e,aw as O,ab as t,S as Z,aj as se,N as P,ay as ie,b0 as oe,ag as E,ao as h,aO as v,an as A,bh as le,aD as M,bc as x,b9 as ne,aa as ce,b5 as de,d as me,ap as ue}from"./index-DjOBj_Ai.js";import{A as pe}from"./AdminButton-B8c0S9L9.js";import{S as fe}from"./StarredToggleButton-C6zYUy0m.js";import{I as _e,D as L,a as be}from"./InstanceDetail-DPGTPy9_.js";import{u as Y,I as H,A as ge,R as xe,O as he,E as ye,D as je}from"./InvenTreeTable-C-s5lvnS.js";import{c as W,j as N,q as ke,Q as Ce,A as R,k as Fe,m as Pe,e as ve}from"./Filter-CpWhllKn.js";import{N as Ie}from"./NavigationTree-DO_Tzr1I.js";import{P as Te}from"./PageDetail-1HLwiKVO.js";import{P as Se}from"./PanelGroup-_Eigw1UV.js";import{u as we,p as D}from"./ImportPartWizard-ANfVbVcJ.js";import{u as Re}from"./UseInstance-BYH4ds5B.js";import{a as z,A as Ae,J as Me,z as Q,a1 as De,y as Oe,ar as Ee,k as Ne,aw as $e}from"./ThemeContext-BjJu0IKI.js";import{Y as J}from"./YesNoButton-CYsvXLSb.js";import{u as Be}from"./DesktopAppView-D6tHFi_e.js";import{P as Ke,D as X}from"./ColumnRenderers-BCeqgJNS.js";import{u as Ve}from"./use-hover-CbuFBCOT.js";import qe from"./PartCategoryTemplateTable-D8QNErbJ.js";import{P as Ge}from"./PartTable-CwFhRBB8.js";import{S as Le}from"./StockItemTable-D_Czm6nE.js";import{I as Qe}from"./IconCategory-BJ3ZMbyK.js";import{I as Ue}from"./IconListCheck-ByTzoI8l.js";import"./ActionButton-D4nRdKaB.js";import"./index-_kfXKtfq.js";import"./formatters-Dkpc25sQ.js";import"./ModelType-BxY4rynO.js";import"./GenericErrorPage-BWQWzpn2.js";import"./NotFound-BksZ8Fp_.js";import"./PermissionDenied-CPiNkqvu.js";import"./IconChevronDown-I6OOyduR.js";import"./QRCode-BL-P7mX-.js";import"./browser-JUP5PmmS.js";import"./IconDotsVertical-CGvw5eIR.js";import"./IconTags-Bukq1non.js";import"./IconChevronRight-BBTCuiZt.js";import"./PageTitle-CaObz4lR.js";import"./PluginUIFeature-DWPwHUQS.js";import"./RemoteComponent-CrOPmrx3.js";import"./OrderPartsWizard-CtcPC0ec.js";import"./CompanyForms-BrBn0vUb.js";import"./IconAt-B6wo_srX.js";import"./IconUsers-DgSduCbv.js";import"./IconAddressBook-0_3zwfXJ.js";import"./ImporterForms-bhuZRzA9.js";import"./UseStatusCodes-BH1R2YPA.js";import"./IconCircleDashedCheck-FiF_1OHY.js";import"./UsePlugins-eh-Mb5PQ.js";import"./UseStockAdjustActions-B7uQUwuU.js";const ee={"=":"",">":"_gt",">=":"_gte","<":"_lt","<=":"_lte","!=":"_ne","~":"_icontains"};function Ze(a){const s=i.useMemo(()=>a.filters["="]??"",[a.filters]);return e.jsx(O,{"aria-label":`filter-${a.template.name}`,data:[{value:"true",label:t._({id:"c+xCSz"})},{value:"false",label:t._({id:"ocUvR+"})}],value:s,clearable:!0,defaultValue:s,onClear:()=>{a.clearFilter(a.template.pk,""),a.closeFilter()},onChange:o=>a.setFilter(a.template.pk,o??"","="),placeholder:t._({id:"jf/x3i"}),clearButtonProps:{"aria-label":`clear-filter-${a.template.name}`}})}function Ye(a){const s=i.useMemo(()=>a.filters["="]??"",[a.filters]);return e.jsx(O,{"aria-label":`filter-${a.template.name}`,data:a.template.choices.split(",").map(o=>o.trim()),value:s,defaultValue:s,onChange:o=>a.setFilter(a.template.pk,o??"","="),onClear:()=>{a.clearFilter(a.template.pk,""),a.closeFilter()},clearButtonProps:{"aria-label":`clear-filter-${a.template.name}`},placeholder:t._({id:"jf/x3i"}),searchable:!0,clearable:!0})}function U({props:a,value:s,operator:o,readonly:g}){const y=i.useMemo(()=>{let n=t._({id:"0AYT5C"});return a.template.units&&(n+=` [${a.template.units}]`),n},[a.template.units]),[u,r]=i.useState(o);return i.useEffect(()=>{r(o)},[o]),e.jsxs(P,{gap:"xs",wrap:"nowrap",children:[e.jsx("div",{onMouseDown:n=>n.stopPropagation(),style:{width:75},children:e.jsx(O,{onClick:n=>{n?.stopPropagation()},"aria-label":`filter-${a.template.name}-operator`,data:Object.keys(ee),value:u,searchable:!1,clearable:!1,defaultValue:"=",onChange:n=>{r(n??"=")},size:"sm",disabled:g,width:75})}),e.jsx(ie,{"aria-label":`filter-${a.template.name}`,placeholder:y,defaultValue:s,onKeyDown:n=>{n.key==="Enter"&&(a.setFilter(a.template.pk,n.currentTarget.value||"",u),a.closeFilter())},rightSection:g&&e.jsx(oe.ClearButton,{onClick:n=>{n.stopPropagation(),a.clearFilter(a.template.pk,u),a.closeFilter()},"aria-label":`clear-filter-${a.template.name}`})})]})}function He(a){return e.jsxs(Z,{gap:"xs",children:[Object.keys(a.filters).map(s=>e.jsx(U,{props:a,value:a.filters[s]??"",operator:s,readonly:!0})),e.jsx(se,{}),e.jsx(U,{props:a,value:"",operator:"="})]})}function We(a){return i.useMemo(()=>a.template.checkbox?e.jsx(Ze,{...a}):a.template.choices?e.jsx(Ye,{...a}):e.jsx(He,{...a}),[a])}function ze({record:a,template:s,canEdit:o}){const{hovered:g,ref:y}=Ve(),u=i.useMemo(()=>a.parameters?.find(f=>f.template==s.pk),[a,s]),r=[],n=i.useMemo(()=>{let f=u?.data;return s?.checkbox&&f!=null&&(f=e.jsx(J,{value:u.data})),f},[u,s]);if(s.units&&u&&u.data_numeric&&u.data_numeric!=u.data){const f=ke(u.data_numeric,{digits:15});r.push(`${f} [${s.units}]`)}return g&&o&&r.push(t._({id:"cwMTjO"})),e.jsx("div",{children:e.jsx(P,{grow:!0,ref:y,justify:"space-between",children:e.jsx(P,{grow:!0,children:e.jsx(Ce,{value:n??"-",extra:r,icon:g&&o?"edit":"info",title:s.name})})})})}function Je({categoryId:a}){const s=Be(),o=Y("parametric-parts"),g=E(),y=z(),u=Ae({queryKey:["category-parameters",a],queryFn:async()=>s.get(A(h.part_parameter_template_list),{params:{category:a}}).then(c=>c.data),refetchOnMount:!0}),[r,n]=i.useState({}),f=i.useCallback((c,l)=>{const m=`parameter_${c}`;if(!l){n(d=>{const p={...d};return Object.keys(p).forEach(_=>{_==m&&delete p[_]}),p});return}n(d=>{const p={...d},_=p[m]||{};return _[l]!==void 0&&delete _[l],{...p,[m]:_}}),o.refreshTable()},[n,o.refreshTable]),S=i.useCallback((c,l,m)=>{const d=`parameter_${c}`,p=l?.toString().trim()??"";p.length>0&&(n(_=>{const q={..._},G=q[d]||{};return G[m]=p,{...q,[d]:G}}),o.refreshTable())},[n,f,o.refreshTable]),k=i.useMemo(()=>{const c={};return Object.keys(r).forEach(l=>{const m=r[l];Object.keys(m).forEach(d=>{const p=`${l}${ee[d]||""}`,_=m[d];c[p]=_})}),c},[r]),[j,I]=i.useState(0),[w,b]=i.useState(0),[F,C]=i.useState(0),T=we({editTemplate:!1}),$=W({url:h.part_parameter_list,title:t._({id:"iwRvX8"}),fields:i.useMemo(()=>({...T}),[T]),focus:"data",onFormSuccess:c=>{K(j,c)},initialData:{part:j,template:w}}),B=N({url:h.part_parameter_list,title:t._({id:"ZqLOh/"}),pk:F,fields:i.useMemo(()=>({...T}),[T]),focus:"data",onFormSuccess:c=>{K(j,c)}}),K=i.useCallback((c,l)=>{const m=o.records,d=m.findIndex(_=>_.pk==c);if(d<0){o.refreshTable();return}const p=m[d].parameters.findIndex(_=>_.pk==l.pk);p<0?m[d].parameters.push(l):m[d].parameters[p]=l,o.updateRecord(m[d])},[o.records,o.updateRecord]),V=i.useMemo(()=>(u?.data||[]).map(l=>{let m=l.name;l.units&&(m+=` [${l.units}]`);const d=r[`parameter_${l.pk}`]||{};return{accessor:`parameter_${l.pk}`,title:m,sortable:!0,extra:{template:l.pk},render:p=>e.jsx(ze,{record:p,template:l,canEdit:g.hasChangeRole(v.part)}),filtering:Object.keys(d).length>0,filter:({close:p})=>e.jsx(We,{template:l,filters:r[`parameter_${l.pk}`]||{},setFilter:S,clearFilter:f,closeFilter:p})}}),[g,u.data,r]),te=i.useCallback((c,l)=>{b(c),I(l.pk);const m=l.parameters?.find(d=>d.template==c);m?(C(m.pk),B.open()):$.open()},[]),ae=i.useMemo(()=>[{name:"active",label:t._({id:"F6pfE9"}),description:t._({id:"xqUGVc"})},{name:"locked",label:t._({id:"G2fuEb"}),description:t._({id:"tB/dWJ"})},{name:"assembly",label:t._({id:"WL36Yh"}),description:t._({id:"IxF0Eq"})}],[]),re=i.useMemo(()=>[...[Ke({part:"",switchable:!1}),X({defaultVisible:!1}),{accessor:"IPN",sortable:!0,defaultVisible:!1},{accessor:"total_in_stock",sortable:!0}],...V],[V]);return e.jsxs(e.Fragment,{children:[$.modal,B.modal,e.jsx(H,{url:A(h.part_list),tableState:o,columns:re,props:{enableDownload:!0,tableFilters:ae,params:{category:a,cascade:!0,category_detail:!0,parameters:!0,...k},onCellClick:({event:c,record:l,index:m,column:d,columnIndex:p})=>{if(le(c),d?.accessor?.toString()?.startsWith("parameter_"))te(d.extra.template,l);else if(l?.pk){const _=M(x.part,l.pk);ne(_,y,c)}}}})]})}function Xe({parentId:a}){const s=Y("partcategory"),o=E(),g=i.useMemo(()=>[{accessor:"name",sortable:!0,switchable:!1,render:b=>e.jsxs(P,{gap:"xs",wrap:"nowrap",justify:"space-between",children:[e.jsxs(P,{gap:"xs",wrap:"nowrap",children:[b.icon&&e.jsx(R,{name:b.icon}),b.name]}),e.jsx(P,{gap:"xs",justify:"flex-end",wrap:"nowrap",children:b.starred&&e.jsx(ce,{label:t._({id:"mUyvRx"}),children:e.jsx(Me,{color:"green",size:16})})})]})},X({}),{accessor:"pathstring",sortable:!1},{accessor:"structural",sortable:!0,defaultVisible:!1,render:b=>e.jsx(J,{value:b.structural})},{accessor:"part_count",sortable:!0}],[]),y=i.useMemo(()=>[{name:"cascade",label:t._({id:"NgZniC"}),description:t._({id:"Tt3/Pp"})},{name:"structural",label:t._({id:"PRKZBP"}),description:t._({id:"kHkg2b"})},{name:"starred",label:t._({id:"7VIaU3"}),description:t._({id:"mcDc03"})}],[]),u=D({create:!0}),r=W({url:h.category_list,title:t._({id:"sIMwJx"}),fields:u,focus:"name",initialData:{parent:a},follow:!0,modelType:x.partcategory,table:s}),[n,f]=i.useState(-1),S=D({create:!1}),k=N({url:h.category_list,pk:n,title:t._({id:"7fjpj0"}),fields:S,onFormSuccess:b=>s.updateRecord(b)}),j=Fe({url:h.category_list,items:s.selectedIds,title:t._({id:"H52WlQ"}),fields:{parent:{}},onFormSuccess:s.refreshTable}),I=i.useMemo(()=>{const b=o.hasAddRole(v.part_category),F=o.hasChangeRole(v.part_category);return[e.jsx(ge,{tooltip:t._({id:"O/o81A"}),icon:e.jsx(Q,{icon:"category"}),disabled:!s.hasSelectedRecords,actions:[{name:t._({id:"OORNPU"}),icon:e.jsx(Q,{icon:"category"}),tooltip:t._({id:"rB20aK"}),hidden:!F,disabled:!s.hasSelectedRecords,onClick:()=>{j.open()}}]}),e.jsx(Pe,{tooltip:t._({id:"5LuNgu"}),onClick:()=>r.open(),hidden:!b},"add-part-category")]},[o,s.hasSelectedRecords]),w=i.useCallback(b=>{const F=o.hasChangeRole(v.part_category);return[xe({hidden:!F,onClick:()=>{f(b.pk),k.open()}})]},[o]);return e.jsxs(e.Fragment,{children:[r.modal,k.modal,j.modal,e.jsx(H,{url:A(h.category_list),tableState:s,columns:g,props:{enableDownload:!0,enableSelection:!0,params:{parent:a,top_level:a===void 0?!0:void 0},tableFilters:y,tableActions:I,rowActions:w,modelType:x.partcategory}})]})}function Zt(){const{id:a}=De(),s=i.useMemo(()=>Number.isNaN(Number.parseInt(a||""))?void 0:a,[a]),o=z(),g=E(),[y,u]=i.useState(!1),{instance:r,refreshInstance:n,instanceQuery:f}=Re({endpoint:h.category_list,hasPrimaryKey:!0,pk:s,params:{path_detail:!0}}),S=i.useMemo(()=>{if(s&&f.isFetching)return e.jsx(de,{});const C=[{type:"text",name:"name",label:t._({id:"6YtxFj"}),copy:!0,value_formatter:()=>e.jsxs(P,{gap:"xs",children:[r.icon&&e.jsx(R,{name:r.icon}),r.name]})},{type:"text",name:"pathstring",label:t._({id:"I6gXOa"}),icon:"sitemap",copy:!0,hidden:!s},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"link",name:"parent",model_field:"name",icon:"location",label:t._({id:"o8hZ41"}),model:x.partcategory,hidden:!r?.parent},{type:"boolean",name:"starred",icon:"notification",label:t._({id:"7VIaU3"})}],T=[{type:"text",name:"part_count",label:t._({id:"pmRbKZ"}),icon:"part",value_formatter:()=>r?.part_count||"0"},{type:"text",name:"subcategories",label:t._({id:"7lonqg"}),icon:"sitemap",hidden:!r?.subcategories},{type:"boolean",name:"structural",label:t._({id:"PRKZBP"}),icon:"sitemap"},{type:"link",name:"parent_default_location",label:t._({id:"XLVNTv"}),model:x.stocklocation,hidden:!r.parent_default_location||r.default_location},{type:"link",name:"default_location",label:t._({id:"QC5Msb"}),model:x.stocklocation,hidden:!r.default_location}];return e.jsxs(_e,{children:[s&&r?.pk?e.jsx(L,{item:r,fields:C}):e.jsx(me,{children:t._({id:"PFKWrQ"})}),s&&r?.pk&&e.jsx(L,{item:r,fields:T})]})},[r,f]),k=N({url:h.category_list,pk:s,title:t._({id:"7fjpj0"}),fields:D({}),onFormSuccess:n}),j=i.useMemo(()=>[{value:"false",display_name:t._({id:"y6iD6w"})},{value:"true",display_name:t._({id:"lzGbCT"})}],[]),I=ve({url:h.category_list,pk:s,title:t._({id:"2tjyh5"}),fields:{delete_parts:{label:t._({id:"PJYQQn"}),description:t._({id:"ZqK0DP"}),choices:j,required:!0,field_type:"choice"},delete_child_categories:{label:t._({id:"QgH9YK"}),description:t._({id:"ISGGrw"}),choices:j,required:!0,field_type:"choice"}},onFormSuccess:()=>{r.parent?o(M(x.partcategory,r.parent)):o("/part/")}}),w=i.useMemo(()=>[e.jsx(pe,{model:x.partcategory,id:r.pk},"admin"),e.jsx(fe,{instance:r,model:x.partcategory,successFunction:()=>{n()}},"starred_change"),e.jsx(he,{tooltip:t._({id:"O/o81A"}),actions:[ye({hidden:!s||!g.hasChangeRole(v.part_category),tooltip:t._({id:"7fjpj0"}),onClick:()=>k.open()}),je({hidden:!s||!g.hasDeleteRole(v.part_category),tooltip:t._({id:"2tjyh5"}),onClick:()=>I.open()})]},"category-actions")],[s,g,r.pk,r.starred]),b=i.useMemo(()=>[{name:"details",label:t._({id:"wp9B4i"}),icon:e.jsx(Oe,{}),content:S},{name:"subcategories",label:s?t._({id:"7lonqg"}):t._({id:"2GkbLI"}),icon:e.jsx(Ee,{}),content:e.jsx(Xe,{parentId:s})},{name:"parts",label:t._({id:"pmRbKZ"}),icon:e.jsx(Qe,{}),content:e.jsx(Ge,{props:{params:{category:s}}})},{name:"stockitem",label:t._({id:"Jbck4N"}),icon:e.jsx(Ne,{}),hidden:!s,content:e.jsx(Le,{params:{category:s},allowAdd:!1,tableName:"category-stockitems"})},{name:"category_parameters",label:t._({id:"6r/kUX"}),icon:e.jsx(Ue,{}),hidden:!s||!r.pk,content:e.jsx(qe,{categoryId:r?.pk})},{name:"parameters",label:t._({id:"TxrNvj"}),icon:e.jsx($e,{}),content:e.jsx(Je,{categoryId:s})}],[r,s]),F=i.useMemo(()=>[{name:t._({id:"pmRbKZ"}),url:"/part"},...(r.path??[]).map(C=>({name:C.name,url:M(x.partcategory,C.pk),icon:C.icon?e.jsx(R,{name:C.icon}):void 0}))],[r]);return e.jsxs(e.Fragment,{children:[k.modal,I.modal,e.jsx(be,{query:f,requiredRole:v.part_category,children:e.jsxs(Z,{gap:"xs",children:[e.jsx(ue,{visible:f.isFetching}),e.jsx(Ie,{modelType:x.partcategory,title:t._({id:"2GkbLI"}),endpoint:h.category_tree,opened:y,onClose:()=>{u(!1)},selectedId:r?.pk}),e.jsx(Te,{title:r?.name??s?t._({id:"QXANxH"}):t._({id:"pmRbKZ"}),subtitle:r?.description,icon:r?.icon&&e.jsx(R,{name:r?.icon}),breadcrumbs:F,breadcrumbAction:()=>{u(!0)},actions:w,editAction:k.open,editEnabled:!!r?.pk&&g.hasChangePermission(x.partcategory)}),e.jsx(Se,{pageKey:"partcategory",panels:b,model:x.partcategory,instance:r,reloadInstance:n,id:r.pk??null})]})})]})}export{Zt as default};
//# sourceMappingURL=CategoryDetail-CJUALigN.js.map
