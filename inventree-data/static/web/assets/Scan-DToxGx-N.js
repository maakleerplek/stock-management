import{r as p,K as Q,ag as V,ab as c,j as e,aE as B,av as U,aC as E,e as v,an as F,c9 as R,ao as q,Q as D,N as j,c as b,d as N,ac as H,cC as L,al as O,c8 as T,$ as M,S as C,aj as A,aq as Z}from"./index-DjOBj_Ai.js";import{R as G,d as P}from"./Filter-CpWhllKn.js";import{a as W,a6 as J,ac as K,aO as X,S as y,an as Y}from"./ThemeContext-BjJu0IKI.js";import{P as $}from"./PageTitle-CaObz4lR.js";import{A as ee}from"./ActionButton-D4nRdKaB.js";import{u as se,d as te,I as ae}from"./InvenTreeTable-C-s5lvnS.js";import{I as ne}from"./IconAlertCircle-drog1GMj.js";import"./DesktopAppView-D6tHFi_e.js";import"./IconChevronDown-I6OOyduR.js";import"./index-_kfXKtfq.js";import"./QRCode-BL-P7mX-.js";import"./browser-JUP5PmmS.js";import"./IconDotsVertical-CGvw5eIR.js";import"./IconTags-Bukq1non.js";function oe(d=[]){const[f,o]=p.useState(d);return[f,{setState:o,append:(...s)=>o(t=>[...t,...s]),prepend:(...s)=>o(t=>[...s,...t]),insert:(s,...t)=>o(i=>[...i.slice(0,s),...t,...i.slice(s)]),pop:()=>o(s=>{const t=[...s];return t.pop(),t}),shift:()=>o(s=>{const t=[...s];return t.shift(),t}),apply:s=>o(t=>t.map((i,n)=>s(i,n))),applyWhere:(s,t)=>o(i=>i.map((n,h)=>s(n,h)?t(n,h):n)),remove:(...s)=>o(t=>t.filter((i,n)=>!s.includes(n))),reorder:({from:s,to:t})=>o(i=>{const n=[...i],h=i[s];return n.splice(s,1),n.splice(t,0,h),n}),swap:({from:s,to:t})=>o(i=>{const n=[...i],h=n[s],z=n[t];return n.splice(t,1,h),n.splice(s,1,z),n}),setItem:(s,t)=>o(i=>{const n=[...i];return n[s]=t,n}),setItemProp:(s,t,i)=>o(n=>{const h=[...n];return h[s]={...h[s],[t]:i},h}),filter:s=>{o(t=>t.filter(s))}}]}/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M4 17v-10l7 10v-10",key:"svg-0"}],["path",{d:"M15 17h5",key:"svg-1"}],["path",{d:"M17.5 10m-2.5 0a2.5 3 0 1 0 5 0a2.5 3 0 1 0 -5 0",key:"svg-2"}]],ie=Q("outline","number","Number",ce);function re({records:d,onItemsSelected:f,onItemsDeleted:o}){const g=W(),x=V(),m=se("barcode-scan-results","id"),S=p.useMemo(()=>[{accessor:"instance",title:c._({id:"HX5SVx"}),sortable:!1,switchable:!1,render:r=>r.instance?e.jsx(G,{model:r.model,instance:r.instance}):"-"},{accessor:"model",title:c._({id:"scu3wk"}),sortable:!1},{accessor:"barcode",title:c._({id:"ap+FLU"}),sortable:!1},{accessor:"timestamp",title:c._({id:"8TMaZI"}),sortable:!1,render:r=>r.timestamp?.toLocaleString()}],[]),k=p.useCallback(r=>{const a=[];return r.model&&r.pk&&r.instance&&a.push(te({title:c._({id:"Go4fl6"}),modelId:r.instance?.pk,modelType:r.model,navigate:g,hidden:!x.hasViewPermission(r.model)})),a},[]),I=p.useMemo(()=>[e.jsx(ee,{disabled:!m.hasSelectedRecords,icon:e.jsx(J,{}),color:"red",tooltip:c._({id:"QZQ+5V"}),onClick:()=>{o(m.selectedIds),m.clearSelectedRecords()}})],[m.hasSelectedRecords,m.selectedIds]);return p.useEffect(()=>{f(m.selectedIds)},[m.selectedIds]),e.jsx(e.Fragment,{children:e.jsx(ae,{tableState:m,tableData:d,columns:S,props:{enableFilters:!1,enableSelection:!0,enablePagination:!1,enableSearch:!1,enableRefresh:!1,rowActions:k,tableActions:I}})})}function ye(){const[d,f]=oe([]),[o,g]=K({key:"scan-history",defaultValue:[]}),[x,m]=p.useState([]),S=p.useCallback(a=>{if(!a.model||!a.pk)return;if(d.find(l=>l.model==a.model&&l.pk==a.pk)){B("duplicate-barcode"),U({id:"duplicate-barcode",title:c._({id:"euc6Ns"}),message:c._({id:"6IETQS"}),color:"orange"});return}const u=E[a.model];v.get(F(u.api_endpoint,a.pk)).then(l=>{a.instance=l.data,f.append(a)}).catch(l=>{R({error:l,title:c._({id:"DFEq8c"}),message:c._({id:"beMwe+"})})})},[v,d]),k=p.useCallback(a=>{v.post(F(q.barcode),{barcode:a}).then(u=>{const l=u?.data??{};let w=!1;for(const _ of Object.keys(E))l[_]?.pk&&(w=!0,S({id:D(),barcode:a,data:l,timestamp:P().toDate(),source:"scan",model:_,pk:l[_]?.pk}));w||f.append({id:D(),barcode:a,data:l,timestamp:P().toDate(),source:"scan"})}).catch(u=>{R({error:u,message:c._({id:"I3WmwV"}),title:c._({id:"72IS8c"}),field:"error"})})},[S]);p.useEffect(()=>{d.length!==0&&g(d)},[d]),p.useEffect(()=>{f.setState(o)},[o]);const I=p.useMemo(()=>d.filter(a=>x.includes(a.id)),[x,d]),r=p.useMemo(()=>{const a=new Set(I.map(u=>u.model));return a.size===0?e.jsxs(j,{gap:0,children:[e.jsx(X,{color:"orange"}),e.jsx(b,{id:"dQStih"})]}):a.size>1?e.jsxs(j,{gap:0,children:[e.jsx(ne,{color:"orange"}),e.jsx(b,{id:"Oik3bo"})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{fz:"sm",c:"dimmed",children:e.jsx(b,{id:"9dx+P4"})}),e.jsx(j,{children:e.jsx(H,{onClick:L,title:c._({id:"wBMjJ2"}),variant:"default",children:e.jsx(ie,{})})})]})},[I]);return e.jsxs(e.Fragment,{children:[e.jsx($,{title:c._({id:"kSFUZe"})}),e.jsx(j,{justify:"space-between",children:e.jsx(j,{justify:"left",children:e.jsx(y,{size:"xl",children:e.jsx(b,{id:"kSFUZe"})})})}),e.jsx(O,{h:"md"}),e.jsxs(T,{maw:"100%",children:[e.jsxs(T.Col,{span:4,children:[e.jsx(M,{p:"sm",shadow:"xs",children:e.jsxs(C,{gap:"xs",children:[e.jsx(y,{size:"lg",children:c._({id:"n5kv5D"})}),e.jsx(A,{}),e.jsx(Y,{onScan:k})]})}),e.jsx(M,{p:"sm",shadow:"xs",children:e.jsxs(C,{gap:"xs",children:[e.jsx(y,{size:"lg",children:c._({id:"bwRvnp"})}),e.jsx(A,{}),x.length===0?e.jsx(Z,{title:c._({id:"65vtJ8"}),color:"blue",children:e.jsx(b,{id:"mB/UHi"})}):e.jsxs(e.Fragment,{children:[e.jsx(N,{children:e.jsx(b,{id:"sQhVFe",values:{0:x.length}})}),r]})]})})]}),e.jsx(T.Col,{span:8,children:e.jsx(M,{p:"sm",shadow:"xs",children:e.jsxs(C,{gap:"xs",children:[e.jsx(j,{justify:"space-between",children:e.jsx(y,{size:"lg",children:c._({id:"Ku9qqT"})})}),e.jsx(A,{}),e.jsx(re,{records:d,onItemsSelected:a=>{m(a)},onItemsDeleted:a=>{const u=d.filter(l=>!a.includes(l.id));f.setState(u),g(u)}})]})})})]})]})}export{ye as default};
//# sourceMappingURL=Scan-DToxGx-N.js.map
